@using System.Dynamic;
@using System.IO
@using global::Core.Entities.Views;

@inject IMediator Mediator
@using Application.Queries;
@using MediatR
@using global::Core.Entities;
@using global::Core.EntityModels;
@using global::Core.Repositories.Query;
@inject AC.SD.Core.Services.ToastService toastService
@inject ILocalStorageService<ApplicationUser> _localStorageService
@inject IJSRuntime JS;
@inject NavigationManager NavigationManager
@using Newtonsoft.Json.Linq;
@using Newtonsoft.Json;
@implements IAsyncDisposable
@inject ClipboardService ClipboardService
@using System.Collections.ObjectModel
@rendermode @(new  InteractiveServerRenderMode(prerender: false))
@using Microsoft.Extensions.Configuration;
@inject IConfiguration Configuration
@using DocumentFormat.OpenXml
@using DocumentFormat.OpenXml.Packaging
@using DocumentFormat.OpenXml.Spreadsheet
@using Microsoft.AspNetCore.Hosting
@inject IWebHostEnvironment _hostingEnvironment
<style scoped>
    .ui-state-highlight {
        background-color: rgba(var(--bs-primary-rgb), .3);
    }

    .ui-state-hover {
        background: rgba(var(--bs-primary-rgb), .3);
    }

    .ui-draggable-dragging {
        box-shadow: 0 2px 6px 0 rgb(0 0 0 / 12%);
    }

    .dxbl-grid .dxbl-grid-table > tbody > tr[data-visible-index] {
        cursor: pointer;
    }

</style>
<div class="card w-100" style="margin-bottom:10px;">
    <div class="card-body p-0">
        <DxMenu CollapseItemsToHamburgerMenu="true"
                CollapseItemToIconMode="MenuCollapseItemToIconMode.Sequentially"
                DisplayMode="MenuDisplayMode.Auto">
            <Items>
                @if (isBackDisabled == true)
                {
                    <DxMenuItem Text="Back" IconCssClass="fa fa-reply" Click="@backUrl" />
                }
                <DxMenuItem Text="Add" IconCssClass="fa fa-add" Click="@addNew" Enabled="@AddEnabled" />
                <DxMenuItem Text="Edit" IconCssClass="fa fa-pencil" Click="@addEdit" Enabled="@EditEnabled" />
                <DxMenuItem Text="Delete" IconCssClass="fa fa-remove" Click="@addDetailDelete" Enabled="@DeleteEnabled" />
                <DxMenuItem Text="More" IconCssClass="fa fa-list">
                    <Items>
                        <DxMenuItem Text="SW Library Doc" IconCssClass="fa fa-file" Click="@addDetailFile" Enabled="@fileEnabled" />
                        <DxMenuItem Text="Email" IconCssClass="fa fa-envelope" Click="@addDetailEmailCreate" Enabled="@emailEnabled" />
                        <DxMenuItem Text="@LockedName" IconCssClass="@fafaunlock" Click="@OpenLock" Enabled="@isLocked" />
                        <DxMenuItem Text="Approval Level Entry" IconCssClass="fa fa-check" Click="@OpenApprovalForm" Enabled="@isApprovalEnabled" />
                        <DxMenuItem Text="Print Form" IconCssClass="fa fa-print" Click="@openPrintForm" Enabled="@EditEnabled" />
                        <DxMenuItem Text="Mail Merge" IconCssClass="fa fa-link" Click="@OpenMailMergeUrl" Enabled="@AddEnabled" />
                        <DxMenuItem Text="Audit Trail" IconCssClass="fa fa-history" Click="@addAuditTrail" Enabled="@EditEnabled" />
                        <DxMenuItem Text="Export" IconCssClass="fa fa-file-excel" Click="@getExcel" />
                    </Items>
                </DxMenuItem>
                <DxMenuItem Text="OData" IconCssClass="fa fa-link">
                    <Items>
                        <DxMenuItem Text="Copy Link" IconCssClass="fa fa-external-link-square" Click="@OpenOneOdataUrl" Enabled="@AddEnabled" />
                        <DxMenuItem Text="Empty Attr List" IconCssClass="fa fa-external-link" Click="@OpenEmptyOdataUrl" Enabled="@AddEnabled" />
                        @* <DxMenuItem Text="Filter DropDown List" IconCssClass="fa fa-external-link" Click="@OpenFilterDropDownOdataUrl" Enabled="@AddEnabled" /> *@
                        <DxMenuItem Text="OData Url" IconCssClass="fa fa-external-link" Click="@OpenOdataUrl" Enabled="@AddEnabled" />
                        @*  <DxMenuItem Text="OData Url 1" IconCssClass="fa fa-external-link" Click="@OpenOdataUrl1" Enabled="@AddEnabled" /> *@
                        <DxMenuItem Text="OData Url Paging" IconCssClass="fa fa-external-link" Click="@OpenOdataUrlPaging" Enabled="@AddEnabled" />
                    </Items>
                </DxMenuItem>
                <DxMenuItem Position="ItemPosition.End" title="Sync" IconCssClass="fa fa-refresh" Click="@(() => OnSyncTable())" />
                <DxMenuItem Position="ItemPosition.End" title="Search And Filter" IconCssClass="fa fa-filter" Click="@(() => OnFileProfiltefilter())" id=@($"flyout-overview-target-container-FilterDocuments") />
            </Items>
        </DxMenu>
    </div>
</div>
<div class="demo-breadcrumbs-container theme-blazing-berry">
    <div class="breadcrumb">
        <div class="demo-breadcrumbs sidebar-hidden">
            <!--!-->

            <div class="items">
                <a href="javascript:void(0);">@_dynamicForm?.Name</a>
            </div>
        </div>
    </div>
</div>
<DxLoadingPanel @bind-Visible="PanelVisible"
                IsContentBlocked="true"
                ApplyBackgroundShading="true"
                IndicatorAreaVisible="false"
                Text="Fetching Data...">
    <DxGrid @ref="Grid"
            Data="Items" @key="@myKey"
            EditMode="GridEditMode.EditForm" ShowGroupPanel="true" ShowGroupedColumns="true" ShowSearchBox="true"
            KeyFieldName="DynamicFormDataId"
            FilterMenuButtonDisplayMode="GridFilterMenuButtonDisplayMode.Always"
            ColumnResizeMode="GridColumnResizeMode.NextColumn"
            PagerNavigationMode="PagerNavigationMode.InputBox"
            style="height: calc(100vh - 260px);"
            CssClass="w-100"
            PageSize="20"
            FocusedRowEnabled="true"
            AllowSelectRowByClick="true"
            RowClick="OnRowclick"
            CustomizeElement="Grid_CustomizeElement"
            AutoExpandAllGroupRows="true"
            SelectionMode="GridSelectionMode.Multiple"
            SelectAllCheckboxMode="GridSelectAllCheckboxMode.AllPages"
            VirtualScrollingEnabled="true"
            RowDoubleClick="OnRowDoubleClick">

        <Columns>
            @if (dataColumnNames != null && dataColumnNames.Count() > 0)
            {

                foreach (var s in dataColumnNames)
                {
                    if (s.IsDynamicGrid == true)
                    {
                        <DxGridDataColumn Caption="@s.Text" Visible="@s.IsVisible" MinWidth="40">
                            <CellDisplayTemplate>
                                @{
                                    dynamic item = (ExpandoObject)context.DataItem;
                                }
                                <i class="fa fa-wpforms" aria-hidden="true" style="padding:5px;margin-right: 5px;color:black" onclick="@(() => openFormGridList(s, (ExpandoObject)context.DataItem))"></i>

                            </CellDisplayTemplate>
                        </DxGridDataColumn>
                    }
                    else
                    {
                        if (s.Value == "IsFileprofileTypeDocument")
                        {
                            <DxGridDataColumn Caption="" Visible="@s.IsVisible" MinWidth="40">
                                <CellDisplayTemplate>
                                    @{
                                        dynamic item = (ExpandoObject)context.DataItem;
                                        var items = (int?)item.IsFileprofileTypeDocument;
                                        var isDraft = (bool?)item.IsDraft;
                                        var isLocked = (bool?)item.IsLocked;
                                        var lockedUser = (string?)item.LockedUser;
                                    }
                                    @if (items > 0)
                                    {
                                        <i class="fa fa-paperclip" aria-hidden="true" style="padding:5px;margin-right: 5px;color:black" title="@items"></i>
                                    }
                                    @if (isDraft != null)
                                    {
                                        var emailName = isDraft == true ? "Draft" : "View Email";
                                        <i class="fa fa-envelope" aria-hidden="true" style="padding:5px;margin-right: 5px;color:black" title="@emailName"></i>
                                    }
                                    @if (isLocked == true)
                                    {
                                        <i class="fa fa-lock" aria-hidden="true" style="padding:5px;margin-right: 5px;color:black" title="Locked By:@lockedUser"></i>
                                    }
                                </CellDisplayTemplate>
                            </DxGridDataColumn>
                        }
                        else
                        {
                            if (s.Value == "ModifiedDate")
                            {
                                <DxGridDataColumn FieldName="@s.Value" Caption="@s.Text" MinWidth="180" Visible="@s.IsVisible" SortMode="DevExpress.Blazor.GridColumnSortMode.Custom">
                                    <CellDisplayTemplate>
                                        @{
                                            dynamic item = (ExpandoObject)context.DataItem;
                                            DateTime? items = (DateTime?)item.ModifiedDate;
                                        }
                                        @(items != null ? Application.Common.Helper.Helper.FormatDateTime(items) : null)
                                    </CellDisplayTemplate>
                                </DxGridDataColumn>
                            }
                            else
                            {
                                if (s.ControlType == "DateEdit")
                                {
                                    <DxGridDataColumn FieldName="@s.Value" Caption="@s.Text" MinWidth="180" Visible="@s.IsVisible" SortMode="DevExpress.Blazor.GridColumnSortMode.Custom">
                                        <CellDisplayTemplate>
                                            @{
                                                DateTime? items = null;
                                                dynamic item = (ExpandoObject)context.DataItem;
                                                if (!string.IsNullOrEmpty(s.Value))
                                                {
                                                    var listName = ((IDictionary<String, Object>)item)[s.Value];
                                                    if (listName == null || listName == "")
                                                    {
                                                    }
                                                    else
                                                    {
                                                        items = (DateTime?)listName;
                                                    }
                                                }
                                            }
                                            @(items != null ? Application.Common.Helper.Helper.FormatDate(items) : null)
                                        </CellDisplayTemplate>
                                    </DxGridDataColumn>
                                }
                                else if (s.ControlType == "GroupCheckBox")
                                {
                                    <DxGridDataColumn FieldName="@s.Value" Caption="@s.Text" MinWidth="180" Visible="@s.IsVisible" SortMode="DevExpress.Blazor.GridColumnSortMode.Custom">
                                        <CellDisplayTemplate>
                                            @{
                                                string? items = string.Empty;
                                                dynamic item = (ExpandoObject)context.DataItem;
                                                if (!string.IsNullOrEmpty(s.Value))
                                                {
                                                    var listName = ((IDictionary<String, Object>)item)[s.Value];
                                                    if (listName == null || listName == "")
                                                    {
                                                    }
                                                    else
                                                    {
                                                        items = (string?)listName;
                                                    }
                                                }
                                            }
                                            @((MarkupString)items)
                                        </CellDisplayTemplate>
                                    </DxGridDataColumn>
                                }
                                else
                                {
                                    if (s.ControlType == "Upload Image")
                                    {
                                        <DxGridDataColumn Caption="@s.Text" Visible="@s.IsVisible" MinWidth="40">
                                            <CellDisplayTemplate>
                                                @{
                                                    dynamic item = (ExpandoObject)context.DataItem;
                                                }
                                                <i class="fa fa-video" aria-hidden="true" style="padding:5px;margin-right: 5px;color:black" onclick="@(() => openUploadImageFormGridList1(s, (ExpandoObject)context.DataItem))"></i>

                                            </CellDisplayTemplate>
                                        </DxGridDataColumn>
                                    }
                                    else
                                    {
                                        if (s.Value == "ProfileNo")
                                        {
                                            <DxGridDataColumn FieldName="@s.Value" Caption="@s.Text" MinWidth="180" Visible="@s.IsVisible" SortIndex="0" SortOrder="GridColumnSortOrder.Descending" />
                                        }
                                        else
                                        {
                                            <DxGridDataColumn FieldName="@s.Value" Caption="@s.Text" MinWidth="180" Visible="@s.IsVisible" SortMode="DevExpress.Blazor.GridColumnSortMode.Custom" />
                                        }
                                    }
                                }
                            }

                        }
                    }
                }
            }
        </Columns>
        <TotalSummary>
            <DxGridSummaryItem SummaryType="GridSummaryItemType.Count" FieldName="ProfileNo" />
        </TotalSummary>
    </DxGrid>
</DxLoadingPanel>



<DxPopup @bind-Visible="@Blukdeletepopup"
         ShowFooter="true"
         HeaderText="Delete"
         ShowCloseButton="true"
         Closed="EulaPopupClosed"
         Width="300px">
    <BodyContentTemplate>
        <p>
            Do you want to delete
        </p>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton style="margin-right: 10px;" RenderStyle="ButtonRenderStyle.Primary" Text="NO" Click="Context.CloseCallback" />
        <DxButton RenderStyle="ButtonRenderStyle.Secondary" Text="Yes" Click="((e) => bulkDelete())" />
    </FooterContentTemplate>
</DxPopup>
<DxPopup @bind-Visible="@PopupUpload"
         HeaderText="Upload Documents"
         CloseOnOutsideClick="false"
         ShowCloseButton="true"
         ShowFooter="false"
         Closed="EulaPopupClosed"
         Width="1500px">
    <BodyContentTemplate>
        <UploadDoumentDynamicFiles @ref="refUploadDoumentDynamicFiles" _applicationUser="@applicationUser" _dynamicformData="@_selectedItems" FileProfileTypeId="@FileProfileTypeId" RevokeBack="BackUpload"></UploadDoumentDynamicFiles>
    </BodyContentTemplate>
</DxPopup>

<DxPopup @bind-Visible="@createEmailpopup"
         ShowFooter="true"
         ShowCloseButton="true"
         HeaderText="Create Email"
         Closed="EulaPopupClosed"
         Width="1000px">
    <BodyContentTemplate>
        @* <p>
        Are you sure create Email?
        </p> *@
        <DynamicFormDataEmailAddSubContent @ref="refDynamicFormDataEmailAddSubContent" SessionId="@_selectedItems.SessionId"></DynamicFormDataEmailAddSubContent>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton style="margin-right: 10px;" RenderStyle="ButtonRenderStyle.Primary" Text="NO" Click="Context.CloseCallback" />
        <DxButton RenderStyle="ButtonRenderStyle.Secondary" Text="Yes" Click="createEmailYes" />

    </FooterContentTemplate>
</DxPopup>
<DxPopup @bind-Visible="@PopupDynamicFormGridLists"
         HeaderText="Dynamic Form Grid List"
         CloseOnOutsideClick="false"
         ShowCloseButton="true"
         ShowFooter="false"
         Closed="EulaPopupClosed"
         Width="1000px">
    <BodyContentTemplate>
        <AC.SD.Core.Pages.Attribute.DynamicFormGridLists @ref="refDynamicFormGridLists" DynamicFormSectionGridAttributeId="@DynamicFormSectionGridAttributeIds" DynamicFormDataGridId="@DynamicFormDataGridId" IsShow="false" MainSessionId="@MainSessionId" SessionId="@DynamicFormSessionId"></AC.SD.Core.Pages.Attribute.DynamicFormGridLists>
    </BodyContentTemplate>
</DxPopup>
<DxPopup @bind-Visible="@lockpopup"
         ShowFooter="true"
         HeaderText="@LockedName"
         ShowCloseButton="true"
         Closed="EulaPopupLockClosed"
         Width="300px">
    <BodyContentTemplate>
        <p>
            Do you want to @LockedName this record?
        </p>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton style="margin-right: 10px;" RenderStyle="ButtonRenderStyle.Primary" Text="NO" Click="Context.CloseCallback" />
        <DxButton RenderStyle="ButtonRenderStyle.Secondary" Text="Yes" Click="((e) => bulkLock())" />
    </FooterContentTemplate>
</DxPopup>
<DxPopup @bind-Visible="@PopupApprovalForm"
         HeaderText="Approval Form"
         CloseOnOutsideClick="false"
         ShowCloseButton="true"
         ShowFooter="false"
         Closed="EulaPopupClosed"
         Width="1000px">
    <BodyContentTemplate>
        <DynamicFormApprovedFormList @ref="refDynamicFormApprovedFormList" _applicationUser="@applicationUser" _dynamicformData="@_selectedItems" RevokeBack="BackApprovalForm"></DynamicFormApprovedFormList>
    </BodyContentTemplate>
</DxPopup>
<DxPopup @bind-Visible="@createAuditpopup"
         ShowFooter="true"
         ShowCloseButton="true"
         HeaderText="Audit Trail"
         Closed="EulaPopupClosed"
         Width="1500px">
    <BodyContentTemplate>
        <DynamicFormsAuditTrail @ref="refDynamicFormsAuditTrail" SessionId="@_selectedItems.SessionId"></DynamicFormsAuditTrail>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton RenderStyle="ButtonRenderStyle.Primary" Text="Close" Click="Context.CloseCallback" />
    </FooterContentTemplate>
</DxPopup>
<DxPopup @bind-Visible="@OdataAttrListpopup"
         ShowFooter="true"
         ShowCloseButton="true"
         HeaderText="Odata Attribute"
         Closed="EulaPopupClosed"
         Width="1500px">
    <BodyContentTemplate>
        <DynamicFormOdataAttrLists @ref="refDynamicFormOdataAttrLists" SessionId="_dynamicForm?.SessionID" dynamicFormId="@_dynamicForm?.ID"></DynamicFormOdataAttrLists>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton RenderStyle="ButtonRenderStyle.Primary" Text="Close" Click="Context.CloseCallback" />
    </FooterContentTemplate>
</DxPopup>
<DxFlyout @bind-IsOpen=IsFilterOpen
          PositionTarget=@($"#flyout-overview-target-container-FilterDocuments")
          RestrictionTarget="#Navigation-Flyout-Customization"
          AnimationType="FlyoutAnimationType.Fade"
          HeaderVisible="true"
          HeaderText="Search Form"
          FooterVisible="true"
          FooterCssClass="custom-flyout-footer"
          CloseOnOutsideClick="false"
          MinWidth="500" MinHeight="200" MaxWidth="1000px" MaxHeight="800"
          PreventCloseOnPositionTargetClick="true">
    <BodyContentTemplate Context="PopupContext">
        <DxFormLayout CssClass="w-100">
            <DxFormLayoutItem Caption="" ColSpanMd="12">
                <DxRadioGroup Items="@RadioButtonOptions"
                              Value="@dynamicFormSearch.FilterType"
                              ValueExpression="@(() => dynamicFormSearch.FilterType)"
                              ValueChanged="@((string value) => OnTemplateUploadRadioGroupValueChanged(value))"
                              Layout="RadioGroupLayout.Horizontal"
                              CssClass="dx-demo-radio-group" />
            </DxFormLayoutItem>
            <DxFormLayoutItem Caption="From" ColSpanMd="12" Visible="@filterEnabled">
                <DxDateEdit NullText="Select a From Date..." @bind-Date="@dynamicFormSearch.StartDate" Mask="dd-MMMM-yyyy" ClearButtonDisplayMode="DataEditorClearButtonDisplayMode.Auto" CssClass="cw-320" />
            </DxFormLayoutItem>
            <DxFormLayoutItem Caption="To" ColSpanMd="12" Visible="@filterEnabled">
                <DxDateEdit NullText="Select a To Date..." @bind-Date="@dynamicFormSearch.EndDate" Mask="dd-MMMM-yyyy" ClearButtonDisplayMode="DataEditorClearButtonDisplayMode.Auto" CssClass="cw-320" />
            </DxFormLayoutItem>
        </DxFormLayout>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton style="margin-right: 10px;" RenderStyle="ButtonRenderStyle.Success" Text="Search" Click=@(() => OnFilterDocuments()) />
        <DxButton style="margin-right: 10px;" RenderStyle="ButtonRenderStyle.Primary" Text="Clear" Click=@(() => OnClearFilterDocuments()) />
        <DxButton RenderStyle="ButtonRenderStyle.Secondary" Text="Close" Click=@(() => OnCloseFilterDocuments()) />

    </FooterContentTemplate>
</DxFlyout>
<DxPopup @bind-Visible="@SyncTablepopup"
         ShowFooter="true"
         HeaderText="Sync"
         ShowCloseButton="true"
         Width="500px">
    <BodyContentTemplate>
        <p>
            Are you sure Sync Table from DyanmicForm?
            <table>
                <tr><th>Table Name:</th><th style="font-weight:bold;">@tableName</th></tr>
            </table>
        </p>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton style="margin-right: 10px;" RenderStyle="ButtonRenderStyle.Primary" Text="NO" Click="Context.CloseCallback" />
        <DxButton RenderStyle="ButtonRenderStyle.Secondary" Text="Yes" Click="((e) => OnSyncTables())" />
    </FooterContentTemplate>
</DxPopup>
<DxPopup @bind-Visible="@imageUploadPopup"
         ShowFooter="true"
         ShowCloseButton="true"
         HeaderText="Image List"
         CloseOnOutsideClick="false"
         CloseOnEscape="false"
         Width="1000px">
    <BodyContentTemplate>
        <AC.SD.Core.Pages.Attribute.DynamicFormUploadImageList @ref="refDynamicFormUploadImageList" _dynamicformData="@_filterdynamicformData" RevokeBack="backImageUpload" dynamicFormSectionAttribute="@_filterDynamicFormSectionAttribute"></AC.SD.Core.Pages.Attribute.DynamicFormUploadImageList>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton style="margin-right: 10px;" RenderStyle="ButtonRenderStyle.Primary" Text="Close" Click="Context.CloseCallback" />
    </FooterContentTemplate>
</DxPopup>
@code {
    DynamicFormSectionAttribute _filterDynamicFormSectionAttribute = new DynamicFormSectionAttribute();
    DynamicFormData _filterdynamicformData = new DynamicFormData();
    string? tableName { get; set; }
    bool SyncTablepopup { get; set; } = false; bool imageUploadPopup { get; set; } = false;
    bool filterEnabled { get; set; } = false; bool filterClicked { get; set; } = false;
    bool createAuditpopup { get; set; } = false; bool OdataAttrListpopup { get; set; } = false;
    bool isBackDisabled { get; set; } = true;
    private AC.SD.Core.Pages.Attribute.DynamicFormUploadImageList refDynamicFormUploadImageList { get; set; }
    private DynamicFormOdataAttrLists refDynamicFormOdataAttrLists { get; set; }
    private DynamicFormsAuditTrail refDynamicFormsAuditTrail { get; set; }
    private DynamicFormDataEmailAddSubContent refDynamicFormDataEmailAddSubContent { get; set; }
    private UploadDoumentDynamicFiles refUploadDoumentDynamicFiles { get; set; }
    private DynamicFormApprovedFormList refDynamicFormApprovedFormList { get; set; }
    private AC.SD.Core.Pages.Attribute.DynamicFormGridLists refDynamicFormGridLists { get; set; }
    private IDisposable? DynamicFormPage5;
    Guid myKey { get; set; } = Guid.NewGuid();
    [Parameter]
    public Guid? SessionId { get; set; }
    [Parameter]
    public Guid? FormSessionId { get; set; }
    IGrid? Grid { get; set; }
    bool PanelVisible { get; set; } = true;
    bool createEmailpopup { get; set; } = false; bool PopupDynamicFormGridLists { get; set; } = false;
    private DynamicForm _dynamicForm; public long? FileProfileTypeId { get; set; }
    private DocumentsModel _documentsDmsData;
    public ApplicationUser? applicationUser { get; private set; }
    private DynamicFormData _selectedItems;
    bool EditEnabled { get; set; } = false; bool PopupUpload { get; set; } = false; bool AddEnabled { get; set; } = false; bool lockpopup { get; set; } = false; bool PopupApprovalForm { get; set; } = false;
    bool DeleteEnabled { get; set; } = false; bool isApprovalEnabled { get; set; } = false;
    bool Blukdeletepopup { get; set; } = false; bool AddOneEnabled { get; set; } = false;
    bool fileEnabled { get; set; } = false; bool emailEnabled { get; set; } = false;
    private List<DynamicFormData> _dynamicformDataList;
    private AttributeHeaderListModel _AttributeHeader;
    private List<DropDownOptionsModel> dataColumnNames = new List<DropDownOptionsModel>(); private List<DropDownOptionsModel> dataColumnNamesSync = new List<DropDownOptionsModel>();
    private List<object>? _dynamicformObjectDataList = new List<object>();
    private static int colRowNameWidthInPx = 200;
    private static int colDataWidthInPx = 100;
    public List<DynamicFormSectionAttribute> _dynamicFormSectionAttributeList { get; set; }
    private string colDataWidth = $"{colDataWidthInPx}px";
    private string colRowNameWidth = $"{colRowNameWidthInPx}px";
    //private List<AttributeDetails>? PlantDependencySubAttributeDetails { get; set; } = new List<AttributeDetails>();
    ObservableCollection<object> Items { get; set; } = new ObservableCollection<object>();
    bool ReInitializeDragging { get; set; }
    DotNetObjectReference<DynamicFormList> DotNetHelper { get; set; }
    IJSObjectReference JsModule { get; set; }
    bool isLocked { get; set; } = false; string? LockedName { get; set; } = "Lock"; string? fafaunlock { get; set; } = "fa fa-lock";
    public Guid? DynamicFormSessionId { get; set; }
    public Guid? MainSessionId { get; set; }
    public long? DynamicFormDataGridId { get; set; }
    public long? DynamicFormSectionGridAttributeIds { get; set; }
    private List<DynamicFormSection>? _dynamicFormSectionData; private string? DocumentViewUrl; bool IsFilterOpen { get; set; } = false;
    IEnumerable<string> RadioButtonOptions = new[] { "Last 7 Days", "Last One Month", "Set Filter" };
    private List<DynamicFormSectionAttributesList>? _dynamicFormSectionAttributesList;
    DynamicFormSearch dynamicFormSearch = new DynamicFormSearch();
    protected override async Task OnInitializedAsync()
    {
        DocumentViewUrl = Configuration["DocumentsUrl:DocumentViewer"];
        applicationUser = await _localStorageService.GetItem<ApplicationUser>("user");
        dynamicFormSearch.FilterType = "Last 7 Days";
    }
    async Task OnFilterDocuments()
    {
        filterClicked = true;
        await UpdateDataAsync();
    }
    async Task OnClearFilterDocuments()
    {
        filterClicked = false;
        dynamicFormSearch.FilterType = null;
        filterEnabled = false;
        dynamicFormSearch.StartDate = null;
        dynamicFormSearch.EndDate = null;
        await OnTemplateUploadRadioGroupValueChanged("Last 7 Days");
        await UpdateDataAsync();
        StateHasChanged();
    }
    void OnCloseFilterDocuments()
    {
        IsFilterOpen = false;
        StateHasChanged();
    }
    void OnFileProfiltefilter()
    {
        IsFilterOpen = true; StateHasChanged();
    }
    async Task OnTemplateUploadRadioGroupValueChanged(string? value)
    {
        dynamicFormSearch.FilterType = value;
        filterEnabled = false;
        dynamicFormSearch.StartDate = null;
        dynamicFormSearch.EndDate = null;
        if (value == "Last 7 Days")
        {
            var resultData = await Mediator.Send(new GetDynamicFormDataOneByDataId(_dynamicForm?.ID));
            if (resultData != null)
            {
                dynamicFormSearch.StartDate = resultData.ModifiedDate.Value.AddDays(-6);
                dynamicFormSearch.EndDate = resultData.ModifiedDate;
            }
            else
            {
                dynamicFormSearch.StartDate = DateTime.Today.AddDays(-7);
                dynamicFormSearch.EndDate = DateTime.Today.AddDays(-1);
            }
        }
        if (value == "Last One Month")
        {
            var resultData = await Mediator.Send(new GetDynamicFormDataOneByDataId(_dynamicForm?.ID));
            if (resultData != null)
            {
                var today = resultData.ModifiedDate.Value.Date;
                var firstDayOfMonth = new DateTime(today.Year, today.Month, 1);
                dynamicFormSearch.StartDate = firstDayOfMonth;
                dynamicFormSearch.EndDate = firstDayOfMonth.AddMonths(1).AddDays(-1);
            }
            else
            {
                var today = DateTime.Today;
                var month = new DateTime(today.Year, today.Month, 1);
                dynamicFormSearch.StartDate = month.AddMonths(-1);
                dynamicFormSearch.EndDate = month.AddDays(-1);
            }
        }
        if (value == "Set Filter")
        {
            filterEnabled = true;
            dynamicFormSearch.StartDate = null;
            dynamicFormSearch.EndDate = null;
        }
        StateHasChanged();
    }
    private ValueTask OnLocationChanging(LocationChangingContext context)
    {
        if (context.TargetLocation == "/counter")
        {
            context.PreventNavigation();
        }

        return ValueTask.CompletedTask;
    }
    public void clearData()
    {
        DynamicFormPage5?.Dispose();
        refUploadDoumentDynamicFiles?.DisposeAsync();
        refDynamicFormApprovedFormList?.DisposeAsync();
        refDynamicFormGridLists?.DisposeAsync();
        _dynamicForm = null;
        _documentsDmsData = null;
        _selectedItems = null;
        _dynamicformDataList?.Clear();
        _AttributeHeader = null;
        dataColumnNames?.Clear();
        _dynamicformObjectDataList?.Clear();
        _dynamicFormSectionAttributeList?.Clear();
        //PlantDependencySubAttributeDetails?.Clear();
        Items?.Clear();
    }
    async Task openPrintForm()
    {
        string str = NavigationManager.Uri;
        string rep1 = str.Replace(NavigationManager.BaseUri, "").ToLower();
        string[] UrlList = rep1.Split("/");
        string names = "DynamicMasterSetupList";
        if (UrlList.Count() > 0 && UrlList[0] != null && UrlList[0].ToLower() == names.ToLower())
        {
            var url = NavigationManager.BaseUri + "DynamicMasterSetupList/dynamicPrintForm/" + SessionId + "/" + _selectedItems.SessionId;
            await JS.InvokeVoidAsync("window.open", url, "_blank");
        }
        else
        {
            string names1 = "dynamicFormMenuList";
            if (UrlList.Count() > 0 && UrlList[0] != null && UrlList[0].ToLower() == names1.ToLower())
            {
                var url = NavigationManager.BaseUri + "DynamicMasterSetupList/dynamicPrintForm/" + SessionId + "/" + _selectedItems.SessionId;
                await JS.InvokeVoidAsync("window.open", url, "_blank");
            }
            else
            {
                var url = NavigationManager.BaseUri + "DynamicMasterSetupList/dynamicPrintForm/" + SessionId + "/" + _selectedItems.SessionId;
                await JS.InvokeVoidAsync("window.open", url, "_blank");
            }

        }
    }
    public async ValueTask DisposeAsync()
    {
        // System.GC.Collect();
        clearData();
        //  GC.SuppressFinalize(this);
    }
    protected override async Task OnParametersSetAsync()
    {
        if (applicationUser != null)
        {
            var dynamicForms = Task.Factory.StartNew(() => Mediator.Send(new GetAllDynamicFormList(SessionId, -1)));
            await Task.WhenAll(dynamicForms);
            _dynamicForm = await dynamicForms.Result;
            await OnTemplateUploadRadioGroupValueChanged("Last 7 Days");
            await UpdateDataAsync();
        }
        base.OnParametersSet();
    }
    async Task onshowLoading()
    {
        await JS.InvokeAsync<string>("showLoading");
    }
    async Task onhideLoading()
    {
        await JS.InvokeAsync<string>("hideLoading");
    }
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {

            DynamicFormPage5 = NavigationManager.RegisterLocationChangingHandler(OnLocationChanging);
            JsModule = await JS.InvokeAsync<IJSObjectReference>("import", "./_content/AC.SD.Core/js/Within.js");

            DotNetHelper = DotNetObjectReference.Create(this);
            await JsModule.InvokeVoidAsync("setDotNetHelper", DotNetHelper);
            await JsModule.InvokeVoidAsync("initialize");
        }
        else
        {
            if (ReInitializeDragging)
            {
                ReInitializeDragging = false;
                await JsModule.InvokeVoidAsync("initialize");
            }
        }
    }
    async Task UpdateDataAsync()
    {
        try
        {
            string str = NavigationManager.Uri;
            string rep1 = str.Replace(NavigationManager.BaseUri, "").ToLower();
            string[] UrlList = rep1.Split("/");
            string names = "dynamicFormMenuList".ToLower();
            if (UrlList.Count() > 0 && UrlList[0] != null && UrlList[0].ToLower() == names.ToLower())
            {
                isBackDisabled = false;
            }
            PanelVisible = true;
            //await onshowLoading();
            _selectedItems = null; FileProfileTypeId = null;
            dataColumnNames = new List<DropDownOptionsModel>(); AddEnabled = true; Items = new ObservableCollection<object>(); isLocked = false; AddOneEnabled = false;
            EditEnabled = false; DeleteEnabled = false; fileEnabled = false; _dynamicformObjectDataList = new List<object>(); emailEnabled = false; isApprovalEnabled = false;
            dataColumnNames.Add(new DropDownOptionsModel() { Value = "DynamicFormDataId", Text = "DynamicFormDataId", Type = "Form", IsVisible = false });
            dataColumnNames.Add(new DropDownOptionsModel() { Value = "IsFileprofileTypeDocument", Text = "IsFileprofileTypeDocument", Type = "Form" });
            dataColumnNames.Add(new DropDownOptionsModel() { Value = "SortOrderByNo", Text = "No", Type = "Form" });
            dataColumnNames.Add(new DropDownOptionsModel() { Value = "ProfileNo", Text = "Profile No", Type = "Form" });
            if (SessionId != null)
            {
                _dynamicformObjectDataList = new List<object>(); Items = new ObservableCollection<object>();
                var PlantDependencySubAttributeDetails = new List<AttributeDetails>();
                if (_dynamicForm != null)
                {
                    if (_dynamicForm != null)
                    {
                        _dynamicformObjectDataList = new List<object>(); Items = new ObservableCollection<object>();
                        var _AttributeHeaders = Task.Factory.StartNew(() => Mediator.Send(new GetAllAttributeNameList(_dynamicForm, applicationUser.UserID, false, true, true)));
                        await Task.WhenAll(_AttributeHeaders);
                        _AttributeHeader = await _AttributeHeaders.Result;
                        if (_AttributeHeader != null && _AttributeHeader.DynamicFormSectionAttribute != null && _AttributeHeader.DynamicFormSectionAttribute.Count > 0)
                        {
                            List<string?> dataSourceTableIds = new List<string?>() { "Plant" };
                            var DataSourceTablelists = _AttributeHeader.DynamicFormSectionAttribute.Where(w => w.AttributeHeaderDataSource.Count > 0).SelectMany(a => a.AttributeHeaderDataSource.Select(s => s.DataSourceTable)).ToList().Distinct().ToList();
                            dataSourceTableIds.AddRange(DataSourceTablelists); List<long?> ApplicationMasterIds = new List<long?>(); List<long?> ApplicationMasterParentIds = new List<long?>();
                            ApplicationMasterIds = _AttributeHeader.DynamicFormSectionAttribute.Where(w => w.ApplicationMaster.Count > 0).SelectMany(a => a.ApplicationMaster.Select(s => (long?)s.ApplicationMasterId)).ToList().Distinct().ToList();
                            ApplicationMasterParentIds = _AttributeHeader.DynamicFormSectionAttribute.Where(w => w.ApplicationMasterParents.Count > 0).SelectMany(a => a.ApplicationMasterParents.Select(s => (long?)s.ApplicationMasterParentCodeId)).ToList().Distinct().ToList();
                            if (ApplicationMasterIds.Count > 0)
                            {
                                dataSourceTableIds.Add("ApplicationMaster");
                            }
                            if (ApplicationMasterParentIds != null && ApplicationMasterParentIds.Count > 0)
                            {
                                dataSourceTableIds.Add("ApplicationMasterParent");
                            }
                            var PlantDependencySubAttributeDetailss = Task.Factory.StartNew(() => Mediator.Send(new GetDataSourceDropDownList(null, dataSourceTableIds, null, ApplicationMasterIds, ApplicationMasterParentIds != null ? ApplicationMasterParentIds : new List<long?>())));
                            await Task.WhenAll(PlantDependencySubAttributeDetailss);
                            PlantDependencySubAttributeDetails = await PlantDependencySubAttributeDetailss.Result;
                            _dynamicFormSectionAttributeList = _AttributeHeader.DynamicFormSectionAttribute;
                            _AttributeHeader.DynamicFormSectionAttribute.ForEach(a =>
                            {
                                if (a.DataSourceTable == "ApplicationMaster")
                                {
                                    if (a.ApplicationMaster.Count() > 0)
                                    {
                                        a.ApplicationMaster.ForEach(ab =>
                                        {
                                            var nameData = a.DynamicFormSectionAttributeId + "_" + ab.ApplicationMasterCodeId + "_AppMaster";
                                            dataColumnNames.Add(new DropDownOptionsModel() { IsMultiple = a.IsMultiple, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = a.ControlType, Value = nameData, Text = ab.ApplicationMasterName, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo, IsVisible = a.IsDisplayTableHeader.Value });
                                            if (a.ControlTypeId == 2702 && a.DropDownTypeId == "Data Source" && a.DataSourceTable == "ApplicationMaster" && a.IsDynamicFormGridDropdown == true)
                                            {
                                                var appendDependency = a.DynamicFormSectionAttributeId + "_" + ab.ApplicationMasterCodeId + "_" + a.GridDropDownDynamicFormID + "_GridAppMaster";
                                                dataColumnNames.Add(new DropDownOptionsModel() { IsMultiple = a.IsMultiple, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = a.ControlType, Value = appendDependency, Text = a.GridDropDownDynamicFormName, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo, IsVisible = a.IsDisplayTableHeader.Value });
                                            }
                                        });
                                    }
                                }
                                else if (a.ControlType == "GroupCheckBox")
                                {
                                    dataColumnNames.Add(new DropDownOptionsModel() { IsMultiple = a.IsMultiple, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = a.ControlType, IsDynamicGrid = a.ControlTypeId == 2712 ? true : false, Value = a.DynamicAttributeName, Text = a.DisplayName, Type = "DynamicForm", Id = a.DynamicFormSectionAttributeId, IsVisible = a.IsDisplayTableHeader.Value, OrderBy = a.GridDisplaySeqNo });

                                    var _attributeGroupCheckBoxes = _AttributeHeader.AttributeGroupCheckBoxes.Where(s => s.AttributeId == a.AttributeId).ToList();
                                    if (_attributeGroupCheckBoxes.Count() > 0)
                                    {
                                        _attributeGroupCheckBoxes.ForEach(z =>
                                        {
                                            if (z.IsTextBox == true)
                                            {
                                                if (z.SubAttributeHeaders.Count() > 0)
                                                {
                                                    z.SubAttributeHeaders.ForEach(w =>
                                                    {
                                                        if (w.DataSourceTable == "ApplicationMaster" && w.SubApplicationMaster != null && w.SubApplicationMaster.Count() > 0)
                                                        {
                                                            w.SubApplicationMaster.ForEach(ab =>
                                                            {
                                                                var appendAppMaster = a.DynamicFormSectionAttributeId + "_" + w.SubDynamicAttributeName + "_" + ab.ApplicationMasterCodeId + "_SubAppMaster";
                                                                dataColumnNames.Add(new DropDownOptionsModel() { IsMultiple = w.IsMultiple, IsSubForm = true, AttributeDetailID = w.AttributeID, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = w.ControlType, Value = appendAppMaster, Text = ab.ApplicationMasterName, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo, IsVisible = a.IsDisplayTableHeader.Value });

                                                            });
                                                        }
                                                        else
                                                        {
                                                            var nameData = a.DynamicFormSectionAttributeId + "_" + w.SubDynamicAttributeName;
                                                            dataColumnNames.Add(new DropDownOptionsModel() { IsMultiple = w.IsMultiple, IsSubForm = true, AttributeDetailID = w.AttributeID, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = w.ControlType, Value = nameData, Text = w.Description, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo, IsVisible = a.IsDisplayTableHeader.Value });

                                                        }
                                                    });
                                                }
                                            }
                                            else
                                            {

                                            }
                                        });

                                    }

                                }
                                else if (a.DataSourceTable == "ApplicationMasterParent")
                                {
                                    if (a.ApplicationMasterParents.Count() > 0)
                                    {
                                        a.ApplicationMasterParents.ForEach(ab =>
                                        {
                                            var nameData = a.DynamicFormSectionAttributeId + "_" + ab.ApplicationMasterParentCodeId + "_AppMasterPar";
                                            dataColumnNames.Add(new DropDownOptionsModel() { IsMultiple = a.IsMultiple, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = a.ControlType, Value = nameData, Text = ab.ApplicationMasterName, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo, IsVisible = a.IsDisplayTableHeader.Value });
                                            RemoveApplicationMasterParentSingleItem(ab, a, dataColumnNames);
                                            if (a.ControlTypeId == 2702 && a.DropDownTypeId == "Data Source" && a.DataSourceTable == "ApplicationMasterParent" && a.IsDynamicFormGridDropdown == true)
                                            {
                                                var appendDependency = a.DynamicFormSectionAttributeId + "_" + ab.ApplicationMasterParentCodeId + "_" + a.GridDropDownDynamicFormID + "_GridAppMaster";
                                                dataColumnNames.Add(new DropDownOptionsModel() { IsMultiple = a.IsMultiple, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = a.ControlType, Value = appendDependency, Text = a.GridDropDownDynamicFormName, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo, IsVisible = a.IsDisplayTableHeader.Value });
                                            }
                                        });
                                    }
                                }
                                else if (a.ControlType == "CheckBox" || a.ControlType == "Radio" || a.ControlType == "RadioGroup")
                                {

                                    dataColumnNames.Add(new DropDownOptionsModel() { DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = a.ControlType, IsDynamicGrid = a.ControlTypeId == 2712 ? true : false, Value = a.DynamicAttributeName, Text = a.DisplayName, Type = "DynamicForm", Id = a.DynamicFormSectionAttributeId, IsVisible = a.IsDisplayTableHeader.Value, OrderBy = a.GridDisplaySeqNo });
                                    if (a.ControlType == "Radio" || a.ControlType == "RadioGroup")
                                    {
                                        var attrDetails = _AttributeHeader.AttributeDetails.Where(mm => mm.AttributeID == a.AttributeId && mm.DropDownTypeId == null).ToList();
                                        if (attrDetails.Count() > 0)
                                        {
                                            attrDetails.ForEach(q =>
                                            {
                                                if (q.SubAttributeHeaders.Count() > 0)
                                                {
                                                    q.SubAttributeHeaders.ForEach(w =>
                                                    {
                                                        var nameData = a.DynamicFormSectionAttributeId + "_" + w.SubDynamicAttributeName;
                                                        dataColumnNames.Add(new DropDownOptionsModel() { IsMultiple = w.IsMultiple, IsSubForm = true, AttributeDetailID = w.AttributeID, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = w.ControlType, Value = nameData, Text = w.Description, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo, IsVisible = false });
                                                        if (w.DataSourceTable == "ApplicationMaster" && w.SubApplicationMaster != null && w.SubApplicationMaster.Count() > 0)
                                                        {
                                                            w.SubApplicationMaster.ForEach(ab =>
                                                            {
                                                                var appendAppMaster = a.DynamicFormSectionAttributeId + "_" + w.SubDynamicAttributeName + "_" + ab.ApplicationMasterCodeId + "_SubAppMaster";
                                                                dataColumnNames.Add(new DropDownOptionsModel() { IsMultiple = w.IsMultiple, IsSubForm = true, AttributeDetailID = w.AttributeID, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = w.ControlType, Value = appendAppMaster, Text = ab.ApplicationMasterName, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo, IsVisible = false });

                                                            });
                                                        }
                                                    });
                                                }
                                            });
                                        }
                                    }
                                    else
                                    {
                                        if (a.SubAttributeHeaders.Count() > 0)
                                        {
                                            a.SubAttributeHeaders.ForEach(w =>
                                            {
                                                var nameData = a.DynamicFormSectionAttributeId + "_" + w.SubDynamicAttributeName;
                                                dataColumnNames.Add(new DropDownOptionsModel() { IsMultiple = w.IsMultiple, IsSubForm = true, AttributeDetailID = w.AttributeID, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = w.ControlType, Value = nameData, Text = w.Description, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo, IsVisible = false });
                                                if (w.DataSourceTable == "ApplicationMaster" && w.SubApplicationMaster != null && w.SubApplicationMaster.Count() > 0)
                                                {
                                                    w.SubApplicationMaster.ForEach(ab =>
                                                    {
                                                        var appendAppMaster = a.DynamicFormSectionAttributeId + "_" + w.SubDynamicAttributeName + "_" + ab.ApplicationMasterCodeId + "_SubAppMaster";
                                                        dataColumnNames.Add(new DropDownOptionsModel() { IsMultiple = w.IsMultiple, IsSubForm = true, AttributeDetailID = w.AttributeID, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = w.ControlType, Value = appendAppMaster, Text = ab.ApplicationMasterName, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo, IsVisible = false });

                                                    });
                                                }

                                            });
                                        }
                                    }
                                }
                                else
                                {
                                    dataColumnNames.Add(new DropDownOptionsModel() { IsMultiple = a.IsMultiple, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = a.ControlType, IsDynamicGrid = a.ControlTypeId == 2712 ? true : false, Value = a.DynamicAttributeName, Text = a.DisplayName, Type = "DynamicForm", Id = a.DynamicFormSectionAttributeId, IsVisible = a.IsDisplayTableHeader.Value, OrderBy = a.GridDisplaySeqNo });

                                }
                                if (a.ControlType == "ComboBox" && a.IsPlantLoadDependency == true && a.AttributeHeaderDataSource.Count() > 0 && PlantDependencySubAttributeDetails != null && PlantDependencySubAttributeDetails.Count() > 0)
                                {
                                    a.AttributeHeaderDataSource.ForEach(dd =>
                                    {
                                        var nameData = a.DynamicFormSectionAttributeId + "_" + dd.AttributeHeaderDataSourceId + "_" + dd.DataSourceTable + "_Dependency";
                                        dataColumnNames.Add(new DropDownOptionsModel() { IsMultiple = a.IsDependencyMultiple, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = a.ControlType, Value = nameData, Text = dd.DisplayName, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo, IsVisible = a.IsDisplayTableHeader.Value });
                                    });
                                }

                            });
                            var isSet = dataColumnNames.Where(w => w.Type == "DynamicForm" && w.OrderBy > 0).ToList();
                            if (isSet.Count() > 0)
                            {
                                dataColumnNames = dataColumnNames.OrderBy(o => o.OrderBy).ToList();
                            }
                            if (_dynamicForm != null)
                            {
                                if (_dynamicForm.IsApproval == true)
                                {
                                    dataColumnNames.Add(new DropDownOptionsModel() { Value = "CurrentUserName", Text = "Current User", Type = "Form" });
                                }
                            }
                            dataColumnNames.Add(new DropDownOptionsModel() { Value = "ModifiedBy", Text = "Modified By", Type = "Form" });
                            dataColumnNames.Add(new DropDownOptionsModel() { Value = "ModifiedDate", Text = "Modified Date", Type = "Form" });
                            if (_dynamicForm != null)
                            {
                                if (_dynamicForm.IsApproval == true)
                                {
                                    dataColumnNames.Add(new DropDownOptionsModel() { Value = "StatusName", Text = "Status", Type = "Form" });
                                }
                            }
                        }
                        else
                        {
                            if (_dynamicForm != null)
                            {
                                if (_dynamicForm.IsApproval == true)
                                {
                                    dataColumnNames.Add(new DropDownOptionsModel() { Value = "CurrentUserName", Text = "Current User", Type = "Form" });
                                }
                            }
                            dataColumnNames.Add(new DropDownOptionsModel() { Value = "ModifiedBy", Text = "Modified By", Type = "Form" });
                            dataColumnNames.Add(new DropDownOptionsModel() { Value = "ModifiedDate", Text = "Modified Date", Type = "Form" });
                            if (_dynamicForm != null)
                            {
                                if (_dynamicForm.IsApproval == true)
                                {
                                    dataColumnNames.Add(new DropDownOptionsModel() { Value = "StatusName", Text = "Status", Type = "Form" });
                                }
                            }
                        }
                        _dynamicformObjectDataList = new List<object>(); Items = new ObservableCollection<object>();
                        if (_dynamicForm != null)
                        {
                            await loadDynamicFormDataLists();
                            if (_dynamicformDataList != null && _dynamicformDataList.Count() > 0)
                            {
                                _dynamicformObjectDataList = loadItems(_dynamicformDataList, _AttributeHeader, PlantDependencySubAttributeDetails);
                                _selectedItems = _dynamicformDataList.FirstOrDefault();
                                FileProfileTypeId = _selectedItems.FileProfileTypeId;
                            }
                        }


                    }
                    else
                    {
                        dataColumnNames.Add(new DropDownOptionsModel() { Value = "ModifiedBy", Text = "ModifiedBy", Type = "Form" });
                        dataColumnNames.Add(new DropDownOptionsModel() { Value = "ModifiedDate", Text = "ModifiedDate", Type = "Form" });
                    }
                }
                else
                {
                    AddEnabled = false;
                }
                if (_dynamicformObjectDataList != null && _dynamicformObjectDataList.Count() > 0)
                {
                    Items = new ObservableCollection<object>(_dynamicformObjectDataList);
                }
            }
            else
            {

            }
            PanelVisible = false;
            StateHasChanged();
        }
        catch (Exception ex)
        {

        }
    }
    async Task loadDynamicFormDataLists()
    {
        var _dynamicformDataLists = Task.Factory.StartNew(() => Mediator.Send(new GetDynamicFormDataById(_dynamicForm.ID, 0, -1, null, null, dynamicFormSearch)));
        await Task.WhenAll(_dynamicformDataLists);
        _dynamicformDataList = await _dynamicformDataLists.Result;
    }
    private List<object> loadItems(List<DynamicFormData> dynamicFormDatas, AttributeHeaderListModel attributeHeaderListModels, List<AttributeDetails> PlantDependencySubAttributeDetails)
    {
        List<object>? _dynamicformObjectDataLists = new List<object>();
        if (dynamicFormDatas != null && dynamicFormDatas.Count > 0)
        {
            if (FormSessionId != null)
            {
                dynamicFormDatas = dynamicFormDatas.Where(w => w.SessionId == FormSessionId).ToList();
            }
            dynamicFormDatas.ForEach(s =>
            {
                dynamic jsonObj = new object();
                if (IsValidJson(s.DynamicFormItem))
                {
                    jsonObj = JsonConvert.DeserializeObject(s.DynamicFormItem);
                }
                IDictionary<string, object> objectData = new ExpandoObject();
                objectData["SortOrderByNo"] = s.SortOrderByNo;
                objectData["DynamicFormDataId"] = s.DynamicFormDataId;
                objectData["ProfileNo"] = s.ProfileNo;
                objectData["SessionId"] = s.SessionId;
                objectData["ScreenID"] = s.ScreenID;
                objectData["DynamicFormId"] = s.DynamicFormId;
                objectData["Name"] = s.Name;
                objectData["ModifiedBy"] = s.ModifiedBy;
                objectData["ModifiedDate"] = s.ModifiedDate;
                objectData["CurrentUserName"] = s.CurrentUserName;
                objectData["StatusName"] = s.StatusName;
                objectData["IsDynamicFormDataGrid"] = s.IsDynamicFormDataGrid;
                objectData["IsFileprofileTypeDocument"] = s.IsFileprofileTypeDocument;
                objectData["DynamicFormSectionGridAttributeId"] = s.DynamicFormSectionGridAttributeId;
                objectData["DynamicFormDataGridId"] = s.DynamicFormDataGridId;
                objectData["GridSortOrderByNo"] = s.GridSortOrderByNo;
                objectData["IsDraft"] = s.IsDraft;
                objectData["IsLocked"] = s.IsLocked;
                objectData["LockedUserId"] = s.LockedUserId;
                objectData["LockedUser"] = s.LockedUser;
                if (attributeHeaderListModels != null && attributeHeaderListModels.DynamicFormSectionAttribute != null && attributeHeaderListModels.DynamicFormSectionAttribute.Count > 0)
                {
                    attributeHeaderListModels.DynamicFormSectionAttribute.ForEach(s =>
                    {
                        string attrName = s.DynamicAttributeName;
                        var Names = jsonObj.ContainsKey(attrName);
                        if (Names == true)
                        {
                            if (s.ControlTypeId == 2712)
                            {
                                objectData[attrName] = s.DynamicFormSessionId;
                            }
                            else
                            {
                                if (s.DataSourceTable == "ApplicationMaster")
                                {
                                    objectData[attrName] = string.Empty;
                                    if (s.ApplicationMaster != null && s.ApplicationMaster.Count() > 0)
                                    {
                                        s.ApplicationMaster.ForEach(ab =>
                                    {
                                        var nameData = s.DynamicFormSectionAttributeId + "_" + ab.ApplicationMasterCodeId + "_AppMaster";
                                        var SubNamess = jsonObj.ContainsKey(nameData);
                                        if (SubNamess == true)
                                        {
                                            var itemValue = jsonObj[nameData];
                                            if (itemValue is JArray)
                                            {
                                                List<long?> listData = itemValue.ToObject<List<long?>>();
                                                if (s.IsMultiple == true || s.ControlType == "TagBox")
                                                {
                                                    var listName = PlantDependencySubAttributeDetails != null ? PlantDependencySubAttributeDetails.Where(a => listData.Contains(a.AttributeDetailID) && a.AttributeDetailName != null && a.ApplicationMasterId == ab.ApplicationMasterId && a.DropDownTypeId == s.DataSourceTable).Select(s => s.AttributeDetailName).ToList() : new List<string?>();
                                                    objectData[nameData] = listName != null && listName.Count > 0 ? string.Join(",", listName) : string.Empty;
                                                    objectData[nameData + "_UId"] = listData;
                                                }
                                                else
                                                {
                                                    objectData[nameData + "_UId"] = null;
                                                    objectData[nameData] = string.Empty;
                                                }
                                            }
                                            else
                                            {
                                                if (s.ControlType == "ComboBox")
                                                {
                                                    long? values = itemValue == null ? -1 : (long)itemValue;
                                                    var listss = PlantDependencySubAttributeDetails != null ? PlantDependencySubAttributeDetails.Where(v => v.DropDownTypeId == s.DataSourceTable && v.AttributeDetailID == values).FirstOrDefault()?.AttributeDetailName : string.Empty;
                                                    objectData[nameData] = listss;
                                                    objectData[nameData + "_UId"] = values;
                                                }
                                                else
                                                {
                                                    if (s.ControlType == "ListBox" && s.IsMultiple == false)
                                                    {
                                                        long? values = itemValue == null ? -1 : (long)itemValue;
                                                        var listss = PlantDependencySubAttributeDetails != null ? PlantDependencySubAttributeDetails.Where(v => v.DropDownTypeId == s.DataSourceTable && v.AttributeDetailID == values).FirstOrDefault()?.AttributeDetailName : string.Empty;
                                                        objectData[nameData] = listss;
                                                        objectData[nameData + "_UId"] = values;
                                                    }
                                                    else
                                                    {
                                                        objectData[nameData] = string.Empty;
                                                        objectData[nameData + "_UId"] = null;
                                                    }
                                                }
                                            }

                                            if (s.ControlTypeId == 2702 && s.DropDownTypeId == "Data Source" && s.DataSourceTable == "ApplicationMaster" && s.IsDynamicFormGridDropdown == true)
                                            {
                                                var collection = attributeHeaderListModels.DropDownOptionsGridListModel.ObjectData;
                                                var appendDependency = s.DynamicFormSectionAttributeId + "_" + ab.ApplicationMasterCodeId + "_" + s.GridDropDownDynamicFormID + "_GridAppMaster";
                                                var displayNames = string.Empty;
                                                if (collection != null)
                                                {
                                                    var itemDepExits = jsonObj.ContainsKey(appendDependency);
                                                    if (itemDepExits == true)
                                                    {
                                                        var itemDepValue = jsonObj[appendDependency];
                                                        if (s.IsDynamicFormGridDropdownMultiple == true)
                                                        {
                                                            if (itemDepValue is JArray)
                                                            {
                                                                List<long?> listData = itemDepValue.ToObject<List<long?>>();

                                                                if (listData != null && listData.Count > 0)
                                                                {
                                                                    listData.ForEach(l =>
                                                                    {
                                                                        if (collection != null)
                                                                        {
                                                                            foreach (var v in (collection as IEnumerable<ExpandoObject>))
                                                                            {
                                                                                dynamic eod = v;
                                                                                if ((long?)eod.AttributeDetailID == l)
                                                                                {
                                                                                    displayNames += eod.AttributeDetailName + ",";
                                                                                }
                                                                            }
                                                                        }
                                                                    });
                                                                }
                                                                objectData[appendDependency + "_UId"] = listData;
                                                                displayNames = displayNames.TrimEnd(',');

                                                            }
                                                        }
                                                        else
                                                        {
                                                            long? valuesDep = itemDepValue == null ? -1 : (long)itemDepValue;
                                                            foreach (var v in (collection as IEnumerable<ExpandoObject>))
                                                            {
                                                                dynamic eod = v;
                                                                if ((long?)eod.AttributeDetailID == valuesDep)
                                                                {
                                                                    displayNames += eod.AttributeDetailName;
                                                                }
                                                            }
                                                            objectData[appendDependency + "_UId"] = itemDepValue;
                                                        }
                                                    }
                                                }

                                                objectData[appendDependency] = displayNames;
                                            }
                                        }
                                    });
                                    }
                                }
                                else if (s.DataSourceTable == "ApplicationMasterParent")
                                {
                                    var collection = attributeHeaderListModels.DropDownOptionsGridListModel.ObjectData;
                                    objectData[attrName] = string.Empty;
                                    List<string?> nameDatas = new List<string?>();
                                    s.ApplicationMasterParents.ForEach(ab =>
                                    {
                                        nameDatas.Add(s.DynamicFormSectionAttributeId + "_" + ab.ApplicationMasterParentCodeId + "_AppMasterPar");
                                        RemoveApplicationMasterParentSingleNameItem(ab, s, nameDatas);
                                        if (s.ControlTypeId == 2702 && s.DropDownTypeId == "Data Source" && s.DataSourceTable == "ApplicationMasterParent" && s.IsDynamicFormGridDropdown == true)
                                        {
                                            var appendDependency = s.DynamicFormSectionAttributeId + "_" + ab.ApplicationMasterParentCodeId + "_" + s.GridDropDownDynamicFormID + "_GridAppMaster";
                                            var displayNames = string.Empty;
                                            if (collection != null)
                                            {
                                                var itemDepExits = jsonObj.ContainsKey(appendDependency);
                                                if (itemDepExits == true)
                                                {
                                                    var itemDepValue = jsonObj[appendDependency];
                                                    if (s.IsDynamicFormGridDropdownMultiple == true)
                                                    {
                                                        if (itemDepValue is JArray)
                                                        {
                                                            List<long?> listData = itemDepValue.ToObject<List<long?>>();

                                                            if (listData != null && listData.Count > 0)
                                                            {
                                                                listData.ForEach(l =>
                                                                {
                                                                    if (collection != null)
                                                                    {
                                                                        foreach (var v in (collection as IEnumerable<ExpandoObject>))
                                                                        {
                                                                            dynamic eod = v;
                                                                            if ((long?)eod.AttributeDetailID == l)
                                                                            {
                                                                                displayNames += eod.AttributeDetailName + ",";
                                                                            }
                                                                        }
                                                                    }
                                                                });
                                                            }
                                                            objectData[appendDependency + "_UId"] = listData;
                                                            displayNames = displayNames.TrimEnd(',');

                                                        }
                                                    }
                                                    else
                                                    {
                                                        long? valuesDep = itemDepValue == null ? -1 : (long)itemDepValue;
                                                        foreach (var v in (collection as IEnumerable<ExpandoObject>))
                                                        {
                                                            dynamic eod = v;
                                                            if ((long?)eod.AttributeDetailID == valuesDep)
                                                            {
                                                                displayNames += eod.AttributeDetailName;
                                                            }
                                                        }
                                                        objectData[appendDependency + "_UId"] = valuesDep;
                                                    }
                                                }
                                            }
                                            objectData[appendDependency] = displayNames;
                                        }

                                    });
                                    if (nameDatas != null && nameDatas.Count() > 0)
                                    {
                                        nameDatas.ForEach(n =>
                                        {
                                            loadApplicationMasterParentData(jsonObj, s, n, objectData, PlantDependencySubAttributeDetails);
                                        });
                                    }
                                }
                                else
                                {
                                    var itemValue = jsonObj[attrName];
                                    var collection = attributeHeaderListModels.DropDownOptionsGridListModel.ObjectData;
                                    if (itemValue is JArray)
                                    {
                                        List<long?> listData = itemValue.ToObject<List<long?>>();
                                        if (s.DataSourceTable == "DynamicGrid")
                                        {
                                            List<DropDownOptionsModel?> gridlistss = new List<DropDownOptionsModel?>();
                                            gridlistss = attributeHeaderListModels.DropDownOptionsGridListModel.DropDownGridOptionsModel.Where(ax => ax.DynamicFormId == s.DynamicFormGridDropDownId).FirstOrDefault()?.DropDownOptionsModels;

                                            string displayNames = string.Empty;

                                            if (listData != null && listData.Count > 0)
                                            {
                                                listData.ForEach(l =>
                                                {
                                                    if (collection != null)
                                                    {
                                                        foreach (var v in (collection as IEnumerable<ExpandoObject>))
                                                        {
                                                            dynamic eod = v;
                                                            var vv = eod.DynamicFormId;
                                                            string listone = string.Empty;
                                                            if (gridlistss != null && gridlistss.Count() > 0)
                                                            {
                                                                var g1 = gridlistss.OrderBy(o => o.OrderBy).ToList();
                                                                g1.ForEach(q =>
                                                           {
                                                               var byName = (IDictionary<string, object>)v;
                                                               if (q.Value != null)
                                                               {
                                                                   if (byName.ContainsKey(q.Value))
                                                                   {
                                                                       var names = (string)byName[q.Value]?.ToString();
                                                                       listone += names + "|";
                                                                   }
                                                               }
                                                           });
                                                            }
                                                            eod.DisplayItemsQuery = listone;
                                                            if ((long?)eod.AttributeDetailID == l)
                                                            {
                                                                displayNames += eod.DisplayItemsQuery + ",";
                                                            }
                                                        }
                                                    }
                                                });
                                            }
                                            objectData[attrName + "_UId"] = listData;
                                            objectData[attrName] = displayNames.TrimEnd(',');
                                        }
                                        else
                                        {
                                            List<string?> listName = new List<string?>();
                                            if (attributeHeaderListModels != null)
                                            {
                                                var nameList = attributeHeaderListModels.AttributeDetails.Where(a => listData.Contains(a.AttributeDetailID) && a.AttributeDetailName != null && a.DropDownTypeId == s.DataSourceTable).ToList();
                                                if (nameList != null && nameList.Count() > 0)
                                                {
                                                    nameList.ForEach(n =>
                                                    {
                                                        if (s.DataSourceTable == "Employee")
                                                        {
                                                            listName.Add((n?.AttributeDetailName + "|" + n?.Description + "|" + n?.DesignationName + "|" + n?.DepartmentName).TrimEnd('|'));
                                                        }
                                                        else if (s.DataSourceTable == "RawMatPurch")
                                                        {
                                                            listName.Add((n?.AttributeDetailName + "|" + n?.QcRefNo).TrimEnd('|'));
                                                        }
                                                        else if (s.DataSourceTable == "ReleaseProdOrderLine")
                                                        {
                                                            listName.Add((n?.AttributeDetailName + "|" + n?.ReplanRefNo).TrimEnd('|'));
                                                        }
                                                        else if (s.DataSourceTable == "FinishedProdOrderLine" || s.DataSourceTable == "FinishedProdOrderLineProductionInProgress" || s.DataSourceTable == "Location")
                                                        {
                                                            listName.Add(n?.NameList);
                                                        }
                                                        else
                                                        {
                                                            listName.Add((n?.AttributeDetailName + "|" + n?.Description).TrimEnd('|'));
                                                        }
                                                    });
                                                }
                                            }
                                            objectData[attrName + "_UId"] = listData;
                                            objectData[attrName] = listName != null && listName.Count > 0 ? (string.Join(",", listName)).TrimEnd(',') : string.Empty;
                                        }
                                    }
                                    else
                                    {
                                        List<AttributeHeader> SubAttrsHeader = new List<AttributeHeader>();
                                        if (s.ControlType == "ComboBox" || s.ControlType == "Radio" || s.ControlType == "RadioGroup")
                                        {
                                            long? Svalues = itemValue == null ? null : (long)itemValue;
                                            if (Svalues != null)
                                            {
                                                if (s.DataSourceTable == "DynamicGrid")
                                                {
                                                    List<DropDownOptionsModel?> gridlistss = new List<DropDownOptionsModel?>();
                                                    gridlistss = attributeHeaderListModels.DropDownOptionsGridListModel.DropDownGridOptionsModel.Where(ax => ax.DynamicFormId == s.DynamicFormGridDropDownId).FirstOrDefault()?.DropDownOptionsModels;
                                                    var displayNames = string.Empty;
                                                    if (collection != null)
                                                    {
                                                        foreach (var v in (collection as IEnumerable<ExpandoObject>))
                                                        {
                                                            dynamic eod = v;
                                                            var vv = eod.DynamicFormId;
                                                            var AttributeDetailIds = eod.AttributeDetailID;
                                                            string listone = string.Empty;
                                                            if (gridlistss != null && gridlistss.Count() > 0)
                                                            {
                                                                var g1 = gridlistss.OrderBy(o => o.OrderBy).ToList();
                                                                g1.ForEach(q =>
                                                           {
                                                               var byName = (IDictionary<string, object>)v;
                                                               if (q.Value != null)
                                                               {
                                                                   if (byName.ContainsKey(q.Value))
                                                                   {
                                                                       var names = (string)byName[q.Value]?.ToString();
                                                                       listone += names + "|";
                                                                   }
                                                               }
                                                           });
                                                            }
                                                            eod.DisplayItemsQuery = listone;
                                                            if ((long?)eod.AttributeDetailID == Svalues)
                                                            {
                                                                displayNames += eod.DisplayItemsQuery;
                                                            }
                                                        }
                                                    }
                                                    objectData[attrName + "_UId"] = Svalues;
                                                    objectData[attrName] = displayNames;
                                                }
                                                else
                                                {
                                                    List<string?> listName = new List<string?>();
                                                    if (attributeHeaderListModels != null)
                                                    {
                                                        var nameList = attributeHeaderListModels.AttributeDetails.Where(a => a.AttributeDetailID == Svalues && a.AttributeDetailName != null && a.DropDownTypeId == s.DataSourceTable).ToList();
                                                        if (nameList != null && nameList.Count() > 0)
                                                        {
                                                            nameList.ForEach(n =>
                                                            {
                                                                if (s.DataSourceTable == "Employee")
                                                                {
                                                                    listName.Add((n?.AttributeDetailName + "|" + n?.Description + "|" + n?.DesignationName + "|" + n?.DepartmentName).TrimEnd('|'));
                                                                }
                                                                else if (s.DataSourceTable == "RawMatPurch")
                                                                {
                                                                    listName.Add((n?.AttributeDetailName + "|" + n?.QcRefNo).TrimEnd('|'));
                                                                }
                                                                else if (s.DataSourceTable == "ReleaseProdOrderLine")
                                                                {
                                                                    listName.Add((n?.AttributeDetailName + "|" + n?.ReplanRefNo).TrimEnd('|'));
                                                                }
                                                                else if (s.DataSourceTable == "FinishedProdOrderLine" || s.DataSourceTable == "FinishedProdOrderLineProductionInProgress" || s.DataSourceTable == "Location")
                                                                {
                                                                    listName.Add(n?.NameList);
                                                                }
                                                                else
                                                                {
                                                                    listName.Add((n?.AttributeDetailName + "|" + n?.Description).TrimEnd('|'));
                                                                }
                                                            });
                                                        }
                                                    }
                                                    objectData[attrName + "_UId"] = Svalues;
                                                    objectData[attrName] = listName != null && listName.Count > 0 ? (string.Join(",", listName)).TrimEnd(',') : string.Empty;
                                                }
                                            }
                                            else
                                            {
                                                objectData[attrName + "_UId"] = null;
                                                objectData[attrName] = string.Empty;
                                            }
                                            // if (Svalues > 0)
                                            // {
                                            //     var attrDetails = _AttributeHeader.AttributeDetails.Where(mm => mm.AttributeDetailID == Svalues && mm.DropDownTypeId == null).FirstOrDefault()?.SubAttributeHeaders;
                                            //     if (attrDetails != null && attrDetails.Count > 0)
                                            //     {
                                            //         SubAttrsHeader = attrDetails;
                                            //     }
                                            // }
                                            var attrDetails = attributeHeaderListModels.AttributeDetails.Where(mm => mm.AttributeID == s.AttributeId && mm.DropDownTypeId == null).ToList();
                                            if (attrDetails != null && attrDetails.Count > 0)
                                            {
                                                attrDetails.ForEach(u =>
                                            {
                                                if (u.SubAttributeHeaders != null && u.SubAttributeHeaders.Count() > 0)
                                                {
                                                    loadSubHeaders(u.SubAttributeHeaders, s, jsonObj, objectData, attributeHeaderListModels);
                                                }
                                            });
                                            }
                                            if (s.ControlType == "ComboBox" && s.IsPlantLoadDependency == true && s.AttributeHeaderDataSource.Count() > 0 && PlantDependencySubAttributeDetails != null && PlantDependencySubAttributeDetails.Count() > 0)
                                            {

                                                s.AttributeHeaderDataSource.ForEach(dd =>
                                                {
                                                    var nameData = s.DynamicFormSectionAttributeId + "_" + dd.AttributeHeaderDataSourceId + "_" + dd.DataSourceTable + "_Dependency";
                                                    var itemDepExits = jsonObj.ContainsKey(nameData);
                                                    if (itemDepExits == true)
                                                    {
                                                        var itemDepValue = jsonObj[nameData];
                                                        if (s.IsDependencyMultiple == true)
                                                        {
                                                            if (itemDepValue is JArray)
                                                            {
                                                                List<long?> listData = itemDepValue.ToObject<List<long?>>();
                                                                List<string?> listName = new List<string?>();
                                                                if (PlantDependencySubAttributeDetails != null)
                                                                {
                                                                    var nameList = PlantDependencySubAttributeDetails.Where(a => listData.Contains(a.AttributeDetailID) && a.DropDownTypeId == dd.DataSourceTable).ToList();
                                                                    if (nameList != null && nameList.Count() > 0)
                                                                    {
                                                                        nameList.ForEach(n =>
                                                                        {
                                                                            if (s.DataSourceTable == "Employee")
                                                                            {
                                                                                listName.Add((n?.AttributeDetailName + "|" + n?.Description + "|" + n?.DesignationName + "|" + n?.DepartmentName).TrimEnd('|'));
                                                                            }
                                                                            else if (s.DataSourceTable == "RawMatPurch")
                                                                            {
                                                                                listName.Add((n?.AttributeDetailName + "|" + n?.QcRefNo).TrimEnd('|'));
                                                                            }
                                                                            else if (s.DataSourceTable == "ReleaseProdOrderLine")
                                                                            {
                                                                                listName.Add((n?.AttributeDetailName + "|" + n?.ReplanRefNo).TrimEnd('|'));
                                                                            }
                                                                            else if (s.DataSourceTable == "FinishedProdOrderLine" || s.DataSourceTable == "FinishedProdOrderLineProductionInProgress" || s.DataSourceTable == "Location")
                                                                            {
                                                                                listName.Add(n?.NameList);
                                                                            }
                                                                            else
                                                                            {
                                                                                listName.Add((n?.AttributeDetailName + "|" + n?.Description).TrimEnd('|'));
                                                                            }
                                                                        });
                                                                    }
                                                                }
                                                                objectData[nameData + "_UId"] = listData;
                                                                objectData[nameData] = listName != null && listName.Count > 0 ? (string.Join(",", listName)).TrimEnd(',') : string.Empty;
                                                            }
                                                            else
                                                            {
                                                                objectData[nameData + "_UId"] = null;
                                                                objectData[nameData] = string.Empty;
                                                            }
                                                        }
                                                        else
                                                        {
                                                            long? valuesDep = itemDepValue == null ? -1 : (long)itemDepValue;
                                                            var nameList = PlantDependencySubAttributeDetails.Where(v => dd.DataSourceTable == v.DropDownTypeId && v.AttributeDetailID == valuesDep).ToList();
                                                            List<string?> listName = new List<string?>();
                                                            if (nameList != null && nameList.Count() > 0)
                                                            {
                                                                nameList.ForEach(n =>
                                                                {
                                                                    if (s.DataSourceTable == "Employee")
                                                                    {
                                                                        listName.Add((n?.AttributeDetailName + "|" + n?.Description + "|" + n?.DesignationName + "|" + n?.DepartmentName).TrimEnd('|'));
                                                                    }
                                                                    else if (s.DataSourceTable == "RawMatPurch")
                                                                    {
                                                                        listName.Add((n?.AttributeDetailName + "|" + n?.QcRefNo).TrimEnd('|'));
                                                                    }
                                                                    else if (s.DataSourceTable == "ReleaseProdOrderLine")
                                                                    {
                                                                        listName.Add((n?.AttributeDetailName + "|" + n?.ReplanRefNo).TrimEnd('|'));
                                                                    }
                                                                    else if (s.DataSourceTable == "FinishedProdOrderLine" || s.DataSourceTable == "FinishedProdOrderLineProductionInProgress" || s.DataSourceTable == "Location")
                                                                    {
                                                                        listName.Add(n?.NameList);
                                                                    }
                                                                    else
                                                                    {
                                                                        listName.Add((n?.AttributeDetailName + "|" + n?.Description).TrimEnd('|'));
                                                                    }
                                                                });
                                                            }
                                                            objectData[nameData + "_UId"] = valuesDep;
                                                            objectData[nameData] = listName != null && listName.Count > 0 ? (string.Join(",", listName)).TrimEnd(',') : string.Empty;
                                                        }
                                                    }
                                                    else
                                                    {
                                                        objectData[nameData + "_UId"] = null;
                                                        objectData[nameData] = string.Empty;
                                                    }

                                                });
                                            }
                                        }
                                        else if (s.ControlType == "ListBox" && s.IsMultiple == false)
                                        {
                                            long? Svalues = itemValue == null ? null : (long)itemValue;
                                            if (Svalues != null)
                                            {
                                                List<string?> listName = new List<string?>();
                                                var nameList = attributeHeaderListModels.AttributeDetails.Where(a => a.AttributeDetailID == Svalues && a.DropDownTypeId == s.DataSourceTable).ToList();
                                                if (nameList != null && nameList.Count() > 0)
                                                {
                                                    nameList.ForEach(n =>
                                                    {
                                                        if (s.DataSourceTable == "Employee")
                                                        {
                                                            listName.Add((n?.AttributeDetailName + "|" + n?.Description + "|" + n?.DesignationName + "|" + n?.DepartmentName).TrimEnd('|'));
                                                        }
                                                        else if (s.DataSourceTable == "RawMatPurch")
                                                        {
                                                            listName.Add((n?.AttributeDetailName + "|" + n?.QcRefNo).TrimEnd('|'));
                                                        }
                                                        else if (s.DataSourceTable == "ReleaseProdOrderLine")
                                                        {
                                                            listName.Add((n?.AttributeDetailName + "|" + n?.ReplanRefNo).TrimEnd('|'));
                                                        }
                                                        else if (s.DataSourceTable == "FinishedProdOrderLine" || s.DataSourceTable == "FinishedProdOrderLineProductionInProgress" || s.DataSourceTable == "Location")
                                                        {
                                                            listName.Add(n?.NameList);
                                                        }
                                                        else
                                                        {
                                                            listName.Add((n?.AttributeDetailName + "|" + n?.Description).TrimEnd('|'));
                                                        }
                                                    });

                                                }
                                                objectData[attrName + "_UId"] = Svalues;
                                                objectData[attrName] = listName != null && listName.Count > 0 ? (string.Join(",", listName)).TrimEnd(',') : string.Empty;
                                            }
                                            else
                                            {
                                                objectData[attrName + "_UId"] = null;
                                                objectData[attrName] = string.Empty;
                                            }
                                        }
                                        else if (s.ControlType == "DateEdit")
                                        {
                                            DateTime? values = itemValue == null ? null : (DateTime)itemValue;
                                            objectData[attrName] = values;
                                        }
                                        else if (s.ControlType == "TimeEdit")
                                        {
                                            TimeSpan? values = itemValue == null ? null : (TimeSpan)itemValue;
                                            objectData[attrName] = values;
                                        }
                                        else if (s.ControlType == "SpinEdit")
                                        {
                                            if (s.IsSpinEditType == "decimal")
                                            {
                                                decimal? values = itemValue == null ? null : (decimal)itemValue;
                                                objectData[attrName] = values;
                                            }
                                            else
                                            {
                                                int? values = itemValue == null ? null : (int)itemValue;
                                                objectData[attrName] = values;
                                            }
                                        }
                                        else if (s.ControlType == "GroupCheckBox")
                                        {
                                            string valuesData = string.Empty;
                                            valuesData += "<ul>";
                                            var _attributeGroupCheckBoxes = attributeHeaderListModels.AttributeGroupCheckBoxes.Where(g => g.AttributeId == s.AttributeId).ToList();
                                            if (_attributeGroupCheckBoxes.Count() > 0)
                                            {
                                                _attributeGroupCheckBoxes.ForEach(r =>
                                                {
                                                    var nameData = s.DynamicFormSectionAttributeId + "_" + s.AttributeId + "_" + r.AttributeGroupCheckBoxId + "_GroupCheckBox";
                                                    var NamesA = jsonObj.ContainsKey(nameData);
                                                    var itemValueA = jsonObj[nameData];
                                                    if (r.IsTextBox == true)
                                                    {
                                                        loadSubHeaders(r.SubAttributeHeaders, s, jsonObj, objectData, attributeHeaderListModels);
                                                    }
                                                    else
                                                    {
                                                        if (NamesA == true)
                                                        {
                                                            bool? valuesA = itemValueA == null ? false : (bool?)itemValueA;
                                                            if (valuesA == true)
                                                            {
                                                                valuesData += "<li>" + r.Value + "</li>";
                                                            }
                                                        }
                                                        else
                                                        {
                                                            //objectData[nameData] = r.Value.TrimEnd(',');
                                                        }

                                                    }
                                                });
                                                valuesData += "</ul>";
                                                objectData[attrName] = valuesData.TrimEnd(',');
                                            }

                                        }
                                        else if (s.ControlType == "CheckBox")
                                        {
                                            bool? values = itemValue == null ? false : (bool)itemValue;
                                            objectData[attrName] = values;
                                            if (values == true)
                                            {
                                                SubAttrsHeader = s.SubAttributeHeaders;
                                            }
                                        }
                                        else
                                        {
                                            objectData[attrName] = (string)itemValue;
                                        }
                                        loadSubHeaders(SubAttrsHeader, s, jsonObj, objectData, attributeHeaderListModels);
                                    }

                                }
                            }
                        }
                        else
                        {
                            if (s.ControlTypeId == 2712)
                            {
                                objectData[attrName] = s.DynamicFormSessionId;
                            }
                            else
                            {
                                if (s.ControlType == "GroupCheckBox")
                                {
                                    var _attributeGroupCheckBoxes = attributeHeaderListModels.AttributeGroupCheckBoxes.Where(g => g.AttributeId == s.AttributeId).ToList();
                                    if (_attributeGroupCheckBoxes.Count() > 0)
                                    {
                                        _attributeGroupCheckBoxes.ForEach(r =>
                                        {
                                            var nameData = s.DynamicFormSectionAttributeId + "_" + s.AttributeId + "_" + r.AttributeGroupCheckBoxId + "_GroupCheckBox";
                                            var NamesA = jsonObj.ContainsKey(nameData);
                                            var itemValueA = jsonObj[nameData];
                                            if (r.IsTextBox == true)
                                            {
                                                loadSubHeaders(r.SubAttributeHeaders, s, jsonObj, objectData, attributeHeaderListModels);
                                            }
                                            else
                                            {


                                            }
                                        });
                                        objectData[attrName] = string.Empty;
                                    }
                                }
                                if (s.ControlType == "ComboBox" && s.IsPlantLoadDependency == true && s.AttributeHeaderDataSource.Count() > 0)
                                {
                                    objectData[attrName] = string.Empty;
                                    s.AttributeHeaderDataSource.ForEach(dd =>
                                    {
                                        var nameData = s.DynamicFormSectionAttributeId + "_" + dd.AttributeHeaderDataSourceId + "_" + dd.DataSourceTable + "_Dependency";
                                        objectData[nameData] = string.Empty;
                                    });
                                }
                                else
                                {
                                    if (s.ControlType == "CheckBox" || s.ControlType == "Radio" || s.ControlType == "RadioGroup")
                                    {
                                        if (s.ControlType == "CheckBox")
                                        {
                                            objectData[attrName] = false;
                                            loadSubHeaders(s.SubAttributeHeaders, s, jsonObj, objectData, attributeHeaderListModels);
                                        }
                                        else
                                        {
                                            objectData[attrName] = string.Empty;
                                            var attrDetails = attributeHeaderListModels.AttributeDetails.Where(mm => mm.AttributeID == s.AttributeId && mm.DropDownTypeId == null).ToList();
                                            if (attrDetails != null && attrDetails.Count > 0)
                                            {
                                                attrDetails.ForEach(u =>
                                                {
                                                    if (u.SubAttributeHeaders != null && u.SubAttributeHeaders.Count() > 0)
                                                    {
                                                        loadSubHeaders(u.SubAttributeHeaders, s, jsonObj, objectData, attributeHeaderListModels);
                                                    }
                                                });
                                            }
                                        }
                                    }
                                    else
                                    {
                                        if (s.DataSourceTable == "ApplicationMasterParent")
                                        {
                                            objectData[attrName] = string.Empty;
                                            List<string?> nameDatas = new List<string?>();
                                            s.ApplicationMasterParents.ForEach(ab =>
                                            {
                                                nameDatas.Add(s.DynamicFormSectionAttributeId + "_" + ab.ApplicationMasterParentCodeId + "_AppMasterPar");
                                                RemoveApplicationMasterParentSingleNameItem(ab, s, nameDatas);
                                                if (s.ControlTypeId == 2702 && s.DropDownTypeId == "Data Source" && s.DataSourceTable == "ApplicationMasterParent" && s.IsDynamicFormGridDropdown == true)
                                                {
                                                    var appendDependency = s.DynamicFormSectionAttributeId + "_" + ab.ApplicationMasterParentCodeId + "_" + s.GridDropDownDynamicFormID + "_GridAppMaster";
                                                    objectData[appendDependency] = string.Empty;
                                                }
                                            });
                                            if (nameDatas != null && nameDatas.Count() > 0)
                                            {
                                                nameDatas.ForEach(n =>
                                            {
                                                objectData[n] = string.Empty;
                                            });
                                            }

                                        }
                                        else if (s.DataSourceTable == "ApplicationMaster")
                                        {
                                            objectData[attrName] = string.Empty;
                                            if (s.ApplicationMaster.Count() > 0)
                                            {
                                                s.ApplicationMaster.ForEach(ab =>
                                                {
                                                    var nameData = s.DynamicFormSectionAttributeId + "_" + ab.ApplicationMasterCodeId + "_AppMaster";
                                                    objectData[nameData] = string.Empty;
                                                    if (s.ControlTypeId == 2702 && s.DropDownTypeId == "Data Source" && s.DataSourceTable == "ApplicationMaster" && s.IsDynamicFormGridDropdown == true)
                                                    {
                                                        var appendDependency = s.DynamicFormSectionAttributeId + "_" + ab.ApplicationMasterCodeId + "_" + s.GridDropDownDynamicFormID + "_GridAppMaster";
                                                        objectData[appendDependency] = string.Empty;
                                                    }
                                                });
                                            }
                                        }
                                        else
                                        {
                                            if (s.ControlTypeId == 2710)
                                            {
                                                objectData[attrName] = false;
                                            }
                                            else
                                            {
                                                objectData[attrName] = string.Empty;
                                            }
                                        }
                                    }
                                }
                            }
                        }


                    });
                }
                _dynamicformObjectDataLists.Add(objectData);
            });
        }
        return _dynamicformObjectDataLists;
    }
    void loadSubHeaders(List<AttributeHeader>? SubAttrsHeader, DynamicFormSectionAttribute dynamicFormSectionAttribute, dynamic jsonObjs, IDictionary<string, object> objectData, AttributeHeaderListModel attributeHeaderListModels)
    {
        if (SubAttrsHeader != null && SubAttrsHeader.Count > 0)
        {
            SubAttrsHeader.ForEach(d =>
            {
                var subAttrName = dynamicFormSectionAttribute.DynamicFormSectionAttributeId + "_" + d.SubDynamicAttributeName;
                var SubNamess = jsonObjs.ContainsKey(subAttrName);
                if (SubNamess == true)
                {
                    var itemValues = jsonObjs[subAttrName];
                    if (itemValues is JArray)
                    {
                        var values = (JArray)itemValues;
                        List<long?> listDatas = values.ToObject<List<long?>>();
                        if (d.DataSourceTable == "DynamicGrid")
                        {
                            List<DropDownOptionsModel?> gridlistss = new List<DropDownOptionsModel?>();
                            gridlistss = attributeHeaderListModels.DropDownOptionsGridListModel.DropDownGridOptionsModel.Where(ax => ax.DynamicFormId == d.DynamicFormId).FirstOrDefault()?.DropDownOptionsModels;

                            string displayNames = string.Empty;

                            if (listDatas != null && listDatas.Count > 0)
                            {
                                var collection = attributeHeaderListModels.DropDownOptionsGridListModel.ObjectData;
                                listDatas.ForEach(l =>
                                {
                                    if (collection != null)
                                    {
                                        foreach (var v in (collection as IEnumerable<ExpandoObject>))
                                        {
                                            dynamic eod = v;
                                            var vv = eod.DynamicFormId;
                                            string listone = string.Empty;
                                            if (gridlistss != null && gridlistss.Count() > 0)
                                            {
                                                var g1 = gridlistss.OrderBy(o => o.OrderBy).ToList();
                                                g1.ForEach(q =>
                                           {
                                               var byName = (IDictionary<string, object>)v;
                                               if (q.Value != null)
                                               {
                                                   if (byName.ContainsKey(q.Value))
                                                   {
                                                       var names = (string)byName[q.Value]?.ToString();
                                                       listone += names + "|";
                                                   }
                                               }
                                           });
                                            }
                                            eod.DisplayItemsQuery = listone;
                                            if ((long?)eod.AttributeDetailID == l)
                                            {
                                                displayNames += eod.DisplayItemsQuery + ",";
                                            }
                                        }
                                    }
                                });
                            }
                            objectData[subAttrName + "_UId"] = listDatas;
                            objectData[subAttrName] = displayNames.TrimEnd(',');

                        }
                        else
                        {
                            if (d.IsMultiple == true || d.ControlType == "TagBox")
                            {
                                var ValueSet = string.Empty;
                                if (listDatas != null && listDatas.Count > 0 && d.SubAttributeDetails != null && d.SubAttributeDetails.Count > 0)
                                {
                                    var nameList = d.SubAttributeDetails.Where(a => listDatas.Contains(a.AttributeDetailID) && a.AttributeDetailName != null && a.DropDownTypeId == d.DataSourceTable).ToList();
                                    List<string?> listName = new List<string?>();
                                    if (nameList != null && nameList.Count() > 0)
                                    {
                                        nameList.ForEach(n =>
                                        {
                                            if (d.DataSourceTable == "Employee")
                                            {
                                                listName.Add((n?.AttributeDetailName + "|" + n?.Description + "|" + n?.DesignationName + "|" + n?.DepartmentName).TrimEnd('|'));
                                            }
                                            else if (d.DataSourceTable == "RawMatPurch")
                                            {
                                                listName.Add((n?.AttributeDetailName + "|" + n?.QcRefNo).TrimEnd('|'));
                                            }
                                            else if (d.DataSourceTable == "ReleaseProdOrderLine")
                                            {
                                                listName.Add((n?.AttributeDetailName + "|" + n?.ReplanRefNo).TrimEnd('|'));
                                            }
                                            else if (d.DataSourceTable == "FinishedProdOrderLine" || d.DataSourceTable == "FinishedProdOrderLineProductionInProgress" || d.DataSourceTable == "Location")
                                            {
                                                listName.Add(n?.NameList);
                                            }
                                            else
                                            {
                                                listName.Add((n?.AttributeDetailName + "|" + n?.Description).TrimEnd('|'));
                                            }
                                        });

                                    }
                                    ValueSet = listName != null && listName.Count > 0 ? (string.Join(",", listName)).TrimEnd(',') : string.Empty;
                                }
                                objectData[subAttrName + "_UId"] = listDatas;
                                objectData[subAttrName] = ValueSet;
                            }
                        }
                    }
                    else if (d.ControlType == "ListBox" && d.IsMultiple == false)
                    {
                        var ValueSet = string.Empty;
                        long? values = itemValues == null ? null : (long)itemValues;
                        if (values > 0 && d.SubAttributeDetails != null && d.SubAttributeDetails.Count > 0)
                        {
                            var nameList = d.SubAttributeDetails.Where(a => a.AttributeDetailID == values && a.AttributeDetailName != null && a.DropDownTypeId == d.DataSourceTable).ToList();
                            List<string?> listName = new List<string?>();
                            if (nameList != null && nameList.Count() > 0)
                            {
                                nameList.ForEach(n =>
                                {
                                    if (d.DataSourceTable == "Employee")
                                    {
                                        listName.Add((n?.AttributeDetailName + "|" + n?.Description + "|" + n?.DesignationName + "|" + n?.DepartmentName).TrimEnd('|'));
                                    }
                                    else if (d.DataSourceTable == "RawMatPurch")
                                    {
                                        listName.Add((n?.AttributeDetailName + "|" + n?.QcRefNo).TrimEnd('|'));
                                    }
                                    else if (d.DataSourceTable == "ReleaseProdOrderLine")
                                    {
                                        listName.Add((n?.AttributeDetailName + "|" + n?.ReplanRefNo).TrimEnd('|'));
                                    }
                                    else if (d.DataSourceTable == "FinishedProdOrderLine" || d.DataSourceTable == "FinishedProdOrderLineProductionInProgress" || d.DataSourceTable == "Location")
                                    {
                                        listName.Add(n?.NameList);
                                    }
                                    else
                                    {
                                        listName.Add((n?.AttributeDetailName + "|" + n?.Description).TrimEnd('|'));
                                    }
                                });

                            }
                            ValueSet = listName != null && listName.Count > 0 ? (string.Join(",", listName)).TrimEnd(',') : string.Empty;
                        }
                        objectData[subAttrName + "_UId"] = values;
                        objectData[subAttrName] = ValueSet;
                    }
                    else
                    {
                        if (d.ControlType == "TextBox" || d.ControlType == "Memo")
                        {
                            var values = (string)itemValues;
                            objectData[subAttrName] = values;
                        }
                        else if (d.ControlType == "QR Code")
                        {
                            var values = (string)itemValues;
                            objectData[subAttrName] = values;
                        }
                        else if (d.ControlType == "ComboBox" || d.ControlType == "Radio" || d.ControlType == "RadioGroup")
                        {
                            long? values = itemValues == null ? null : (long)itemValues;
                            var ValueSet = string.Empty;
                            if (values > 0)
                            {
                                if (d.DataSourceTable == "DynamicGrid")
                                {
                                    List<DropDownOptionsModel?> gridlistss = new List<DropDownOptionsModel?>();
                                    gridlistss = attributeHeaderListModels.DropDownOptionsGridListModel.DropDownGridOptionsModel.Where(ax => ax.DynamicFormId == d.DynamicFormId).FirstOrDefault()?.DropDownOptionsModels;
                                    var displayNames = string.Empty;
                                    var collection = attributeHeaderListModels.DropDownOptionsGridListModel.ObjectData;
                                    if (collection != null)
                                    {
                                        foreach (var v in (collection as IEnumerable<ExpandoObject>))
                                        {
                                            dynamic eod = v;
                                            var vv = eod.DynamicFormId;
                                            var AttributeDetailIds = eod.AttributeDetailID;
                                            string listone = string.Empty;
                                            if (gridlistss != null && gridlistss.Count() > 0)
                                            {
                                                var g1 = gridlistss.OrderBy(o => o.OrderBy).ToList();
                                                g1.ForEach(q =>
                                           {
                                               var byName = (IDictionary<string, object>)v;
                                               if (q.Value != null)
                                               {
                                                   if (byName.ContainsKey(q.Value))
                                                   {
                                                       var names = (string)byName[q.Value]?.ToString();
                                                       listone += names + "|";
                                                   }
                                               }
                                           });
                                            }
                                            eod.DisplayItemsQuery = listone;
                                            if ((long?)eod.AttributeDetailID == values)
                                            {
                                                displayNames += eod.DisplayItemsQuery;
                                            }
                                        }
                                    }
                                    ValueSet = displayNames.TrimEnd(',');
                                }
                                else
                                {
                                    if (d.SubAttributeDetails != null && d.SubAttributeDetails.Count > 0)
                                    {
                                        var nameList = d.SubAttributeDetails.Where(a => a.AttributeDetailID == values && a.AttributeDetailName != null && a.DropDownTypeId == d.DataSourceTable).ToList();

                                        List<string?> listName = new List<string?>();
                                        if (nameList != null && nameList.Count() > 0)
                                        {
                                            nameList.ForEach(n =>
                                            {
                                                if (d.DataSourceTable == "Employee")
                                                {
                                                    listName.Add((n?.AttributeDetailName + "|" + n?.Description + "|" + n?.DesignationName + "|" + n?.DepartmentName).TrimEnd('|'));
                                                }
                                                else if (d.DataSourceTable == "RawMatPurch")
                                                {
                                                    listName.Add((n?.AttributeDetailName + "|" + n?.QcRefNo).TrimEnd('|'));
                                                }
                                                else if (d.DataSourceTable == "ReleaseProdOrderLine")
                                                {
                                                    listName.Add((n?.AttributeDetailName + "|" + n?.ReplanRefNo).TrimEnd('|'));
                                                }
                                                else if (d.DataSourceTable == "FinishedProdOrderLine" || d.DataSourceTable == "FinishedProdOrderLineProductionInProgress" || d.DataSourceTable == "Location")
                                                {
                                                    listName.Add(n?.NameList);
                                                }
                                                else
                                                {
                                                    listName.Add((n?.AttributeDetailName + "|" + n?.Description).TrimEnd('|'));
                                                }
                                            });

                                        }
                                        ValueSet = listName != null && listName.Count > 0 ? (string.Join(",", listName)).TrimEnd(',') : string.Empty;
                                    }
                                }
                            }
                            objectData[subAttrName + "_UId"] = values;
                            objectData[subAttrName] = ValueSet;

                        }
                        else if (d.ControlType == "CheckBox")
                        {
                            bool? values = itemValues == null ? false : (bool)itemValues;
                            objectData[subAttrName] = values;

                        }
                        else if (d.ControlType == "DateEdit")
                        {
                            DateTime? values = itemValues == null ? null : (DateTime)itemValues;
                            objectData[subAttrName] = values;

                        }
                        else if (d.ControlType == "TimeEdit")
                        {
                            TimeSpan? values = itemValues == null ? null : (TimeSpan)itemValues;
                            objectData[subAttrName] = values;
                        }
                        else if (d.ControlType == "SpinEdit")
                        {
                            if (d.IsAttributeSpinEditType == "decimal")
                            {
                                decimal? values = itemValues == null ? null : (decimal)itemValues;
                                objectData[subAttrName] = values;
                            }
                            else
                            {
                                int? values = itemValues == null ? null : (int)itemValues;
                                objectData[subAttrName] = values;
                            }
                        }
                    }
                    if (d.DataSourceTable == "ApplicationMaster" && d.SubApplicationMaster != null && d.SubApplicationMaster.Count() > 0)
                    {
                        d.SubApplicationMaster.ForEach(ab =>
                        {
                            var appendAppMaster = dynamicFormSectionAttribute.DynamicFormSectionAttributeId + "_" + d.SubDynamicAttributeName + "_" + ab.ApplicationMasterCodeId + "_SubAppMaster";
                            var SubNamesss = jsonObjs.ContainsKey(appendAppMaster);
                            if (SubNamesss == true)
                            {
                                var itemValues = jsonObjs[appendAppMaster];
                                if (itemValues is JArray)
                                {
                                    var values = (JArray)itemValues;
                                    List<long?> listDatas = values.ToObject<List<long?>>();
                                    if (d.IsMultiple == true || d.ControlType == "TagBox")
                                    {
                                        var ValueSet = string.Empty;
                                        if (listDatas != null && listDatas.Count > 0 && d.SubAttributeDetails != null && d.SubAttributeDetails.Count > 0)
                                        {
                                            var listName = d.SubAttributeDetails.Where(a => listDatas.Contains(a.AttributeDetailID) && a.AttributeDetailName != null && a.DropDownTypeId == d.DataSourceTable).Select(s => s.AttributeDetailName).ToList();
                                            ValueSet = listName != null && listName.Count > 0 ? string.Join(",", listName) : string.Empty;
                                        }
                                        objectData[appendAppMaster + "_UId"] = listDatas;
                                        objectData[appendAppMaster] = ValueSet;
                                    }
                                }
                                else
                                {
                                    if (d.ControlType == "ComboBox")
                                    {
                                        long? values = itemValues == null ? null : (long)itemValues;
                                        var ValueSet = string.Empty;
                                        if (values > 0 && d.SubAttributeDetails != null && d.SubAttributeDetails.Count > 0)
                                        {
                                            var listName = d.SubAttributeDetails.Where(a => a.AttributeDetailID == values && a.AttributeDetailName != null && a.DropDownTypeId == d.DataSourceTable).Select(s => s.AttributeDetailName).ToList();
                                            ValueSet = listName != null && listName.Count > 0 ? string.Join(",", listName) : string.Empty;
                                        }
                                        objectData[appendAppMaster + "_UId"] = values;
                                        objectData[appendAppMaster] = ValueSet;
                                    }
                                    else
                                    {
                                        if (d.ControlType == "ListBox" && d.IsMultiple == false)
                                        {
                                            long? values = itemValues == null ? null : (long)itemValues;
                                            var ValueSet = string.Empty;
                                            if (values > 0 && d.SubAttributeDetails != null && d.SubAttributeDetails.Count > 0)
                                            {
                                                var listName = d.SubAttributeDetails.Where(a => a.AttributeDetailID == values && a.AttributeDetailName != null && a.DropDownTypeId == d.DataSourceTable).Select(s => s.AttributeDetailName).ToList();
                                                ValueSet = listName != null && listName.Count > 0 ? string.Join(",", listName) : string.Empty;
                                            }
                                            objectData[appendAppMaster + "_UId"] = values;
                                            objectData[appendAppMaster] = ValueSet;
                                        }
                                        else
                                        {
                                            objectData[appendAppMaster + "_UId"] = null;
                                            objectData[appendAppMaster] = string.Empty;
                                        }
                                    }
                                }
                            }
                            else
                            {
                                objectData[appendAppMaster] = string.Empty;
                            }
                        });
                    }
                }
                else
                {
                    if (d.DataSourceTable == "ApplicationMaster" && d.SubApplicationMaster != null && d.SubApplicationMaster.Count() > 0)
                    {
                        objectData[subAttrName] = string.Empty;
                        d.SubApplicationMaster.ForEach(ab =>
                        {
                            var appendAppMaster = dynamicFormSectionAttribute.DynamicFormSectionAttributeId + "_" + d.SubDynamicAttributeName + "_" + ab.ApplicationMasterCodeId + "_SubAppMaster";
                            objectData[appendAppMaster] = string.Empty;
                        });
                    }
                    else
                    {
                        objectData[subAttrName] = d.ControlType == "CheckBox" ? false : string.Empty;
                    }
                }

            });
        }
    }

    void loadApplicationMasterParentData(dynamic jsonObj, DynamicFormSectionAttribute s, string nameData, IDictionary<string, object> objectData, List<AttributeDetails> PlantDependencySubAttributeDetails)
    {

        var SubNamess = jsonObj.ContainsKey(nameData);
        if (SubNamess == true)
        {
            var itemValue = jsonObj[nameData];
            if (itemValue is JArray)
            {
                List<long?> listData = itemValue.ToObject<List<long?>>();
                if (s.IsMultiple == true || s.ControlType == "TagBox")
                {
                    var listName = PlantDependencySubAttributeDetails != null ? PlantDependencySubAttributeDetails.Where(a => listData.Contains(a.AttributeDetailID) && a.AttributeDetailName != null && a.DropDownTypeId == s.DataSourceTable).Select(s => s.AttributeDetailName).ToList() : new List<string?>();
                    objectData[nameData + "_UId"] = listData;
                    objectData[nameData] = listName != null && listName.Count > 0 ? string.Join(",", listName) : string.Empty;
                }
                else
                {
                    objectData[nameData + "_UId"] = null;
                    objectData[nameData] = string.Empty;
                }
            }
            else
            {
                if (s.ControlType == "ComboBox")
                {
                    long? values = itemValue == null ? -1 : (long)itemValue;
                    var listss = PlantDependencySubAttributeDetails != null ? PlantDependencySubAttributeDetails.Where(v => v.DropDownTypeId == s.DataSourceTable && v.AttributeDetailID == values).FirstOrDefault()?.AttributeDetailName : string.Empty;
                    objectData[nameData] = listss;
                    objectData[nameData + "_UId"] = values;
                }
                else
                {
                    if (s.ControlType == "ListBox" && s.IsMultiple == false)
                    {
                        long? values = itemValue == null ? -1 : (long)itemValue;
                        var listss = PlantDependencySubAttributeDetails != null ? PlantDependencySubAttributeDetails.Where(v => v.DropDownTypeId == s.DataSourceTable && v.AttributeDetailID == values).FirstOrDefault()?.AttributeDetailName : string.Empty;
                        objectData[nameData] = listss;
                        objectData[nameData + "_UId"] = values;
                    }
                    else
                    {
                        objectData[nameData + "_UId"] = null;
                        objectData[nameData] = string.Empty;
                    }
                }
            }
        }
        else
        {
            objectData[nameData] = string.Empty;
        }


    }
    void RemoveApplicationMasterParentSingleItem(ApplicationMasterParent applicationMasterParent, DynamicFormSectionAttribute dynamicFormSectionAttribute, List<DropDownOptionsModel> dataColumnNames)
    {
        if (applicationMasterParent != null)
        {
            var listss = _AttributeHeader.ApplicationMasterParent.FirstOrDefault(f => f.ParentId == applicationMasterParent.ApplicationMasterParentCodeId);
            if (listss != null)
            {
                var nameData = dynamicFormSectionAttribute.DynamicFormSectionAttributeId + "_" + listss.ApplicationMasterParentCodeId + "_AppMasterPar";
                dataColumnNames.Add(new DropDownOptionsModel() { IsMultiple = dynamicFormSectionAttribute.IsMultiple, DynamicFormSectionAttributeId = dynamicFormSectionAttribute.DynamicFormSectionAttributeId, ControlType = dynamicFormSectionAttribute.ControlType, Value = nameData, Text = listss.ApplicationMasterName, Type = "DynamicForm", OrderBy = dynamicFormSectionAttribute.GridDisplaySeqNo, IsVisible = dynamicFormSectionAttribute.IsDisplayTableHeader.Value });
                RemoveApplicationMasterParentSingleItem(listss, dynamicFormSectionAttribute, dataColumnNames);
            }
        }
    }
    void RemoveApplicationMasterParentSingleNameItem(ApplicationMasterParent applicationMasterParent, DynamicFormSectionAttribute dynamicFormSectionAttribute, List<string?> dataColumnNames)
    {
        if (applicationMasterParent != null)
        {
            var listss = _AttributeHeader.ApplicationMasterParent.FirstOrDefault(f => f.ParentId == applicationMasterParent.ApplicationMasterParentCodeId);
            if (listss != null)
            {
                var nameData = dynamicFormSectionAttribute.DynamicFormSectionAttributeId + "_" + listss.ApplicationMasterParentCodeId + "_AppMasterPar";
                dataColumnNames.Add(nameData);
                RemoveApplicationMasterParentSingleNameItem(listss, dynamicFormSectionAttribute, dataColumnNames);
            }
        }
    }
    private static bool IsValidJson(string strInput)
    {
        if (string.IsNullOrWhiteSpace(strInput)) { return false; }
        strInput = strInput.Trim();
        if ((strInput.StartsWith("{") && strInput.EndsWith("}")) || //For object
            (strInput.StartsWith("[") && strInput.EndsWith("]"))) //For array
        {
            try
            {
                var obj = JToken.Parse(strInput);
                return true;
            }
            catch (JsonReaderException jex)
            {
                //Exception in parsing json
                return false;
            }
            catch (Exception ex) //some other exception
            {
                return false;
            }
        }
        else
        {
            return false;
        }
    }
    async Task addAuditTrail()
    {
        createAuditpopup = true;
        // string str = NavigationManager.Uri;
        // string rep1 = str.Replace(NavigationManager.BaseUri, "").ToLower();
        // string[] UrlList = rep1.Split("/");
        // string names = "DynamicMasterSetupList";
        // if (UrlList.Count() > 0 && UrlList[0] != null && UrlList[0].ToLower() == names.                                                            ())
        // {
        //     var url = NavigationManager.BaseUri + "DynamicMasterSetupList/dynamicFormsaudittrail/ " + _selectedItems.SessionId;
        //     await JS.InvokeVoidAsync("window.open", url, "_blank");
        // }
        // else
        // {
        //     string names1 = "dynamicFormMenuList";
        //     if (UrlList.Count() > 0 && UrlList[0] != null && UrlList[0].ToLower() == names1.ToLower())
        //     {
        //         var url = NavigationManager.BaseUri + "dynamicFormMenuList/dynamicFormsaudittrail/" + _selectedItems.SessionId;
        //         await JS.InvokeVoidAsync("window.open", url, "_blank");
        //     }
        //     else
        //     {
        //         var url = NavigationManager.BaseUri + "DynamicMasterSetup/dynamicFormsaudittrail/" + _selectedItems.SessionId;
        //         await JS.InvokeVoidAsync("window.open", url, "_blank");
        //     }

        // }
    }
    void Grid_CustomizeElement(GridCustomizeElementEventArgs e)
    {
        if (e.ElementType == GridElementType.DataRow && e.VisibleIndex % 2 == 1)
        {
            e.CssClass = "alt-item";
        }
        if (e.ElementType == GridElementType.DataRow)
        {
            e.Attributes["data-visible-index"] = e.VisibleIndex;
        }
    }
    async void OnRowclick(GridRowClickEventArgs e)
    {
        var UniqueId = e.Grid.GetRowValue(e.VisibleIndex, "DynamicFormDataId");
        _selectedItems = _dynamicformDataList.FirstOrDefault(f => f.DynamicFormDataId == (long?)UniqueId);
        FileProfileTypeId = _selectedItems?.FileProfileTypeId;
        //await DynamicFormOnDms();
        EditEnabled = true; LockedName = "Lock"; isLocked = true; fafaunlock = "fa fa-lock"; AddOneEnabled = true;
        DeleteEnabled = true; fileEnabled = true; emailEnabled = true; isApprovalEnabled = false;
        if (_selectedItems.IsApproval == true)
        {
            isApprovalEnabled = true;
        }
        if (_selectedItems.IsLocked == true && _selectedItems.LockedUserId > 0)
        {
            LockedName = "UnLock"; fafaunlock = "fa fa-unlock";
            if (_selectedItems.LockedUserId != applicationUser.UserID)
            {
                isLocked = false;
                // EditEnabled = false;
                DeleteEnabled = false; fileEnabled = false; emailEnabled = false;
                if (_selectedItems.IsApproval == true)
                {
                    isApprovalEnabled = false;
                }
            }
        }
        if (_selectedItems.IsLocked == true)
        {
            DeleteEnabled = false;
        }
    }
    async Task OpenOneOdataUrl()
    {
        // if (_selectedItems != null && _selectedItems.SessionId != null)
        // {
        //     var url = NavigationManager.BaseUri + "api/DynamicForm/GetDynamicFormOneDataList?DynamicFormSessionId=" + _selectedItems.SessionId;
        //     await JS.InvokeVoidAsync("window.open", url, "_blank");
        // }
        if (_dynamicForm != null && _dynamicForm.SessionID != null)
        {
            var url = NavigationManager.BaseUri + "api/DynamicForm/GetDynamicFormDataList?DynamicFormSessionId=" + _dynamicForm.SessionID;
            await ClipboardService.WriteTextAsync(url);
            toastService.ShowToast("Copied", AC.SD.Core.Services.ToastLevel.Info);
        }
    }

    async Task OpenFilterDropDownOdataUrl()
    {
        if (_dynamicForm != null && _dynamicForm.SessionID != null)
        {
            var url = NavigationManager.BaseUri + "api/DynamicForm/GetDynamicFormDropdownList?DynamicFormSessionId=" + _dynamicForm.SessionID;
            await JS.InvokeVoidAsync("window.open", url, "_blank");
        }
    }
    async Task OpenEmptyOdataUrl()
    {
        if (_dynamicForm != null && _dynamicForm.SessionID != null)
        {
            // var url = NavigationManager.BaseUri + "api/DynamicForm/GetDynamicFormAttributeList?DynamicFormSessionId=" + _dynamicForm.SessionID;
            // await JS.InvokeVoidAsync("window.open", url, "_blank");
            OdataAttrListpopup = true;
        }
    }
    async Task OpenOdataUrl1()
    {
        if (_dynamicForm != null && _dynamicForm.SessionID != null)
        {
            var url = NavigationManager.BaseUri + "api/DynamicForm/GetDynamicFormDataListItem?DynamicFormSessionId=" + _dynamicForm.SessionID;
            await JS.InvokeVoidAsync("window.open", url, "_blank");
        }
    }
    async Task OpenOdataUrlPaging()
    {
        var url = NavigationManager.BaseUri + "api/DynamicForm/GetDynamicFormDataListPaging?DynamicFormSessionId=" + _dynamicForm.SessionID + "&&PageNo=1&&PageSize=50";
        await JS.InvokeVoidAsync("window.open", url, "_blank");
    }
    async Task OpenOdataUrl()
    {
        if (_dynamicForm != null && _dynamicForm.SessionID != null)
        {
            var url = NavigationManager.BaseUri + "api/DynamicForm/GetDynamicFormDataList?DynamicFormSessionId=" + _dynamicForm.SessionID;
            await JS.InvokeVoidAsync("window.open", url, "_blank");
        }
    }
    async Task DynamicFormOnDms()
    {
        fileEnabled = false;
        _documentsDmsData = await Mediator.Send(new GetDynamicFormDataBySessionIdForDMS(_selectedItems.SessionId));
        if (_documentsDmsData != null && _documentsDmsData.DocumentID > 0)
        {
            fileEnabled = true;
        }
        StateHasChanged();
    }
    void OpenLock()
    {
        if (_selectedItems != null)
        {
            var sectionLock = _selectedItems?.DynamicFormDataSectionLock.Count(dc => dc.IsLocked == true);
            if (sectionLock > 0)
            {
                toastService.ShowToast("Section Already Locked.", AC.SD.Core.Services.ToastLevel.Info);
            }
            else
            {
                lockpopup = true;
            }
        }
    }
    void EulaPopupLockClosed(PopupClosedEventArgs args)
    {
        lockpopup = false;
        InvokeAsync(UpdateDataAsync);
        StateHasChanged();
    }
    async Task bulkLock()
    {
        if (_selectedItems != null)
        {
            DynamicFormData dynamicFormData = new DynamicFormData();
            dynamicFormData.DynamicFormDataId = _selectedItems.DynamicFormDataId;
            dynamicFormData.IsLocked = _selectedItems.IsLocked == true ? null : true;
            if (dynamicFormData.IsLocked == true)
            {
                dynamicFormData.LockedUserId = applicationUser.UserID;
                dynamicFormData.LockedUser = applicationUser.UserName;
            }
            var result = await Mediator.Send(new UpdateDynamicFormLocked(dynamicFormData));
            if (result.DynamicFormDataId > 0)
            {
                LockedName = "Lock"; fafaunlock = "fa fa-lock";
                if (dynamicFormData.IsLocked == true)
                {
                    _selectedItems.IsLocked = dynamicFormData.IsLocked;
                    _selectedItems.LockedUserId = applicationUser.UserID;
                    _selectedItems.LockedUser = applicationUser.UserName;
                    LockedName = "UnLock"; fafaunlock = "fa fa-unlock";
                }
                lockpopup = false;
                if (dynamicFormData.IsLocked == true)
                {
                    toastService.ShowToast("Lock successfully.", AC.SD.Core.Services.ToastLevel.Success);
                }
                else
                {
                    toastService.ShowToast("Unlock successfully.", AC.SD.Core.Services.ToastLevel.Success);
                }

            }
        }
        StateHasChanged();
    }
    void addDetailFile()
    {
        if (_selectedItems != null)
        {
            PopupUpload = true;
            // NavigationManager.NavigateTo("fileprofiletype/" + _documentsDmsData.FileProfileTypeSessionId + "/" + _selectedItems.SessionId);
        }
    }
    void OnRowDoubleClick(GridRowClickEventArgs e)
    {
        OnRowclick(e);
        string str = NavigationManager.Uri;
        string rep1 = str.Replace(NavigationManager.BaseUri, "").ToLower();
        string[] UrlList = rep1.Split("/");
        string names = "DynamicMasterSetupList";
        if (UrlList.Count() > 0 && UrlList[0] != null && UrlList[0].ToLower() == names.ToLower())
        {
            NavigationManager.NavigateTo("DynamicMasterSetupList/dynamicForms/" + SessionId + "/" + _selectedItems.SessionId);
        }
        else
        {
            string names1 = "dynamicFormMenuList";
            if (UrlList.Count() > 0 && UrlList[0] != null && UrlList[0].ToLower() == names1.ToLower())
            {
                NavigationManager.NavigateTo("dynamicFormMenuList/dynamicForms/" + SessionId + "/" + _selectedItems.SessionId);
            }
            else
            {
                NavigationManager.NavigateTo("DynamicMasterSetup/dynamicForms/" + SessionId + "/" + _selectedItems.SessionId);
            }

        }
    }
    void addNew()
    {
        string str = NavigationManager.Uri;
        string rep1 = str.Replace(NavigationManager.BaseUri, "").ToLower();
        string[] UrlList = rep1.Split("/");
        string names = "DynamicMasterSetupList";
        if (UrlList.Count() > 0 && UrlList[0] != null && UrlList[0].ToLower() == names.ToLower())
        {
            NavigationManager.NavigateTo("DynamicMasterSetupList/dynamicForms/" + SessionId);
        }
        else
        {
            string names1 = "dynamicFormMenuList";
            if (UrlList.Count() > 0 && UrlList[0] != null && UrlList[0].ToLower() == names1.ToLower())
            {
                NavigationManager.NavigateTo("dynamicFormMenuList/dynamicForms/" + SessionId);
            }
            else
            {
                NavigationManager.NavigateTo("DynamicMasterSetup/dynamicForms/" + SessionId);
            }

        }
    }
    async Task OpenMailMergeUrl()
    {
        string str = NavigationManager.Uri;
        string rep1 = str.Replace(NavigationManager.BaseUri, "").ToLower();
        string[] UrlList = rep1.Split("/");
        string names = "DynamicMasterSetupList";
        if (UrlList.Count() > 0 && UrlList[0] != null && UrlList[0].ToLower() == names.ToLower())
        {
            var url = NavigationManager.BaseUri + "DynamicMasterSetupList/dynamicFormMailMerge/" + SessionId;
            await JS.InvokeVoidAsync("window.open", url, "_blank");
        }
        else
        {
            string names1 = "dynamicFormMenuList";
            if (UrlList.Count() > 0 && UrlList[0] != null && UrlList[0].ToLower() == names1.ToLower())
            {
                var url = NavigationManager.BaseUri + "dynamicFormMenuList/dynamicFormMailMerge/" + SessionId;
                await JS.InvokeVoidAsync("window.open", url, "_blank");
            }
            else
            {
                var url = NavigationManager.BaseUri + "DynamicMasterSetup/dynamicFormMailMerge/" + SessionId;
                await JS.InvokeVoidAsync("window.open", url, "_blank");
            }
        }
    }
    async Task addDetailEmailCreate()
    {
        var _selectedItemsDAta = await Mediator.Send(new GetDynamicFormDataBySessionId(_selectedItems.SessionId));
        if (_selectedItemsDAta != null)
        {
            if (_selectedItemsDAta.IsDraft == null)
            {
                createEmailpopup = true;
            }
            if (_selectedItemsDAta.IsDraft == true)
            {
                var url = NavigationManager.BaseUri + "EmailDrafts";
                await JS.InvokeVoidAsync("window.open", url, "_blank");
            }
            if (_selectedItemsDAta.IsDraft == false)
            {
                var url = NavigationManager.BaseUri + "ViewEmail/" + _selectedItemsDAta.EmailTopicSessionId + "/Email";
                await JS.InvokeVoidAsync("window.open", url, "_blank");
            }
        }
    }
    async Task createEmailYes()
    {
        string str = NavigationManager.Uri;
        string rep1 = str.Replace(NavigationManager.BaseUri, "").ToLower();
        string[] UrlList = rep1.Split("/");
        string backurl = rep1 + "/" + _selectedItems.SessionId;
        string names1 = "dynamicFormMenuList";
        if (UrlList.Count() > 0 && UrlList[0] != null && UrlList[0].ToLower() == names1.ToLower())
        {
            backurl = "DynamicMasterSetupList/dynamicFormList/" + _selectedItems.SessionId;
        }
        if (_selectedItems != null)
        {
            var result = await refDynamicFormDataEmailAddSubContent?.saveEmailSubjectContent();
            if (result == true)
            {
                var insertData = new DynamicFormData
                {
                    AddedByUserID = applicationUser.UserID,
                    ModifiedByUserID = applicationUser.UserID,
                    AddedDate = DateTime.Now,
                    ModifiedDate = DateTime.Now,
                    SessionId = _selectedItems.SessionId,
                    ProfileNo = _selectedItems.ProfileNo,
                    StatusCodeID = 1,
                    DynamicFormDataId = _selectedItems.DynamicFormDataId,
                    BackUrl = backurl
                };
                var response = await Mediator.Send(new InsertCreateEmailFormData(insertData));
                if (response.DynamicFormDataId > 0)
                {
                    toastService.ShowToast("Email created successfully.", AC.SD.Core.Services.ToastLevel.Success);
                    createEmailpopup = false;
                    var url = NavigationManager.BaseUri + "CreateEmail/" + _selectedItems.SessionId;
                    await JS.InvokeVoidAsync("window.open", url, "_blank");
                    await UpdateDataAsync();
                }
            }
        }
        StateHasChanged();
    }
    void addEdit()
    {
        string str = NavigationManager.Uri;
        string rep1 = str.Replace(NavigationManager.BaseUri, "").ToLower();
        string[] UrlList = rep1.Split("/");
        string names = "DynamicMasterSetupList";
        if (UrlList.Count() > 0 && UrlList[0] != null && UrlList[0].ToLower() == names.ToLower())
        {
            NavigationManager.NavigateTo("DynamicMasterSetupList/dynamicForms/" + SessionId + "/" + _selectedItems.SessionId);
        }
        else
        {
            string names1 = "dynamicFormMenuList";
            if (UrlList.Count() > 0 && UrlList[0] != null && UrlList[0].ToLower() == names1.ToLower())
            {
                NavigationManager.NavigateTo("dynamicFormMenuList/dynamicForms/" + SessionId + "/" + _selectedItems.SessionId);
            }
            else
            {
                NavigationManager.NavigateTo("DynamicMasterSetup/dynamicForms/" + SessionId + "/" + _selectedItems.SessionId);
            }

        }

    }
    async Task addExport()
    {
        await Grid.ExportToXlsxAsync(_dynamicForm?.Name, new GridXlExportOptions()
        {
        });
    }
    void backUrl()
    {
        string str = NavigationManager.Uri;
        string rep1 = str.Replace(NavigationManager.BaseUri, "").ToLower();
        string[] UrlList = rep1.Split("/");
        string names = "DynamicMasterSetupList";
        if (UrlList.Count() > 0 && UrlList[0] != null && UrlList[0].ToLower() == names.ToLower())
        {
            NavigationManager.NavigateTo("DynamicMasterSetupList");
        }
        else
        {
            NavigationManager.NavigateTo("DynamicMasterSetup");

        }
    }
    void addDetailDelete()
    {
        Blukdeletepopup = true;
    }

    void EulaPopupClosed()
    {
        //BackUpload();
        PopupApprovalForm = false;
        PopupDynamicFormGridLists = false;
        Blukdeletepopup = false;
        createEmailpopup = false;
        createAuditpopup = false; OdataAttrListpopup = false;
        // await UpdateDataAsync();
    }
    void OpenApprovalForm()
    {
        PopupApprovalForm = true;
    }
    void BackApprovalForm()
    {
        InvokeAsync(UpdateDataAsync);
        PopupApprovalForm = false;
        StateHasChanged();
    }
    void openUploadImageFormGridList1(DropDownOptionsModel dropDownOptionsModel, object datas)
    {
        dynamic item = (ExpandoObject)datas;
        long? ids = (long?)item.DynamicFormDataId;
        _filterdynamicformData = _dynamicformDataList.FirstOrDefault(f => f.DynamicFormDataId == ids);
        _filterDynamicFormSectionAttribute = _AttributeHeader.DynamicFormSectionAttribute.FirstOrDefault(f => f.DynamicFormSectionAttributeId == dropDownOptionsModel.DynamicFormSectionAttributeId);
        imageUploadPopup = true;
    }
    void backImageUpload()
    {
        imageUploadPopup = false;
        StateHasChanged();
    }
    void openFormGridList(DropDownOptionsModel dropDownOptionsModel, object datas)
    {
        var values = dropDownOptionsModel.Value;
        if (!string.IsNullOrEmpty(values))
        {
            dynamic item = (ExpandoObject)datas;
            var DynamicFormSessionIds = (Guid?)((IDictionary<String, Object>)item)[values];
            if (DynamicFormSessionIds != null)
            {
                DynamicFormSessionId = DynamicFormSessionIds;
                MainSessionId = (Guid?)item.SessionId;
                DynamicFormDataGridId = (long?)item.DynamicFormDataId;
                DynamicFormSectionGridAttributeIds = dropDownOptionsModel.Id;
                PopupDynamicFormGridLists = true;
            }
        }
        StateHasChanged();
    }
    void BackUpload()
    {
        InvokeAsync(UpdateDataAsync);
        PopupUpload = false;
        StateHasChanged();

    }
    async Task bulkDelete()
    {
        try
        {
            var request = new DeleteDynamicFormData(_selectedItems);
            var result = await Mediator.Send(request);
            if (result.IsNotDelete == true)
            {
                toastService.ShowToast("The Selected Record Do not deleted", AC.SD.Core.Services.ToastLevel.Error);
            }
            else
            {
                Blukdeletepopup = false;
                toastService.ShowToast("Record deleted Successfully", AC.SD.Core.Services.ToastLevel.Success);
                await UpdateDataAsync();
            }
        }
        catch (Exception eq)
        {
        }
    }
    [JSInvokable]
    public async Task ReorderGridRows(int draggableRowVisibleIndex, int prevRowVisibleIndex, int nextRowVisibleIndex)
    {
        var hasPrevRow = prevRowVisibleIndex > -1;
        var hasNextRow = nextRowVisibleIndex > -1;

        var sourceItem = (dynamic)Grid.GetDataItem(draggableRowVisibleIndex);
        var hasSamePosition = hasPrevRow && draggableRowVisibleIndex == prevRowVisibleIndex + 1 || hasNextRow && draggableRowVisibleIndex == nextRowVisibleIndex - 1;
        if (hasSamePosition)
            return;

        var moveTop = false;
        if (!hasPrevRow || prevRowVisibleIndex <= draggableRowVisibleIndex)
            moveTop = true;
        var newVisibleIndex = moveTop ? nextRowVisibleIndex : prevRowVisibleIndex;

        var sourceItemIndex = Items.IndexOf(sourceItem);
        var newItemIndex = Items.IndexOf((object)Grid.GetDataItem(newVisibleIndex));
        // Items.Move(sourceItemIndex, newItemIndex);

        myKey = Guid.NewGuid();
        ReInitializeDragging = true;
        DynamicFormData dynamicFormData = new DynamicFormData();
        dynamicFormData.DynamicFormDataId = (long)sourceItem.DynamicFormDataId;
        dynamicFormData.DynamicFormId = (long?)sourceItem.DynamicFormId;
        dynamicFormData.SortOrderAnotherBy = sourceItemIndex + 1;
        dynamicFormData.SortOrderByNo = newItemIndex + 1;
        if (dynamicFormData.SortOrderByNo > 0)
        {
            var request = new UpdateDynamicFormDataSortOrder(dynamicFormData);
            await Mediator.Send(request);
            await UpdateDataAsync();
            toastService.ShowToast("Record Moved successfully.", AC.SD.Core.Services.ToastLevel.Success);
        }
        StateHasChanged();
    }

    private RenderFragment BuildDataColumns()
    {
        RenderFragment columns = b =>
        {
            int counter = 0;
            if (dataColumnNames != null && dataColumnNames.Count() > 0)
            {
                dataColumnNames.ForEach(s =>
                {
                    int count = 0;
                    b.OpenComponent(counter, typeof(DxGridDataColumn));
                    b.AddAttribute(count + 1, "FieldName", s.Value);
                    b.AddAttribute(count + 1, "AllowSort", true);
                    b.AddAttribute(count + 1, "SortMode", DevExpress.Blazor.GridColumnSortMode.Custom);
                    b.AddAttribute(count + 1, "Caption", s.Text);
                    b.AddAttribute(count + 1, "Visible", s.IsVisible);
                    // b.AddAttribute(count + 1, "CellDisplayTemplate ", (RenderFragment<GridDataColumnCellDisplayTemplateContext>)((context) => (a) =>
                    // {
                    //     a.OpenElement(count + 1, "div");
                    //     a.AddContent(count + 1, s.Text);
                    //     a.CloseElement();
                    // }));
                    b.CloseComponent();
                });
            }
        };

        return columns;
    }
    public async Task getExcel()
    {
        string guid = Guid.NewGuid().ToString();
        var fileName = _dynamicForm?.Name;
        string folderName = _hostingEnvironment.ContentRootPath + @"\AppUpload";
        string newFolderName = "ConvertExcel";
        string serverPath = System.IO.Path.Combine(folderName, newFolderName);
        if (!System.IO.Directory.Exists(serverPath))
        {
            System.IO.Directory.CreateDirectory(serverPath);
        }
        string FromLocation = folderName + @"\" + newFolderName + @"\" + guid + ".xlsx";
        using (SpreadsheetDocument spreadsheetDoc = SpreadsheetDocument.Create(FromLocation, SpreadsheetDocumentType.Workbook))
        {
            // Add a WorkbookPart to the document.
            WorkbookPart workbookpart = spreadsheetDoc.AddWorkbookPart();
            workbookpart.Workbook = new Workbook();
            Sheets sheets = spreadsheetDoc.WorkbookPart.Workbook.AppendChild<Sheets>(new Sheets());
            await addSectionEntry(spreadsheetDoc, workbookpart, sheets, 1, fileName);
        }
        FileStream stream = System.IO.File.OpenRead(FromLocation);
        var br = new BinaryReader(stream);
        Byte[] documentStream = br.ReadBytes((Int32)stream.Length);
        Stream streams = new MemoryStream(documentStream);
        stream.Close();
        await JS.InvokeVoidAsync("downloadFile", fileName + ".xlsx", documentStream, "");
        System.IO.File.Delete((string)FromLocation);
    }
    void headersAdd(Row headerRow, List<string> headersBy)
    {
        foreach (string column in headersBy)
        {
            Cell cellHeader = new Cell();
            cellHeader.DataType = CellValues.InlineString;
            Run run1 = new Run();
            run1.Append(new Text(column));

            RunProperties run1Properties = new RunProperties();
            run1Properties.Append(new Bold());
            run1.RunProperties = run1Properties;
            InlineString inlineString = new InlineString();
            inlineString.Append(run1);
            cellHeader.Append(inlineString);
            headerRow.AppendChild(cellHeader);
        }
    }
    public static string RemoveInvalidExcelChars(string? input)
    {
        if (string.IsNullOrEmpty(input))
            return input;

        // remove control chars except tab, newline, carriage return
        return new string(input.Where(c => (c == 0x9 || c == 0xA || c == 0xD) || (c >= 0x20)).ToArray());
    }
    private Cell addCellValues(string dataType, string? value)
    {
        if (!string.IsNullOrEmpty(value))
        {
            value = RemoveInvalidExcelChars(value);
        }
        Cell fileNamecell = new Cell();
        if (dataType == "Boolean")
        {
            fileNamecell.DataType = CellValues.Boolean;
            fileNamecell.CellValue = new CellValue(Convert.ToBoolean(value));
        }
        else if (dataType == "int")
        {
            fileNamecell.DataType = CellValues.Number;
            fileNamecell.CellValue = new CellValue(Convert.ToInt16(value));
        }
        else if (dataType == "long")
        {
            fileNamecell.DataType = CellValues.String;
            fileNamecell.CellValue = new CellValue(value);
        }
        else if (dataType == "Date")
        {
            fileNamecell.DataType = CellValues.String;
            if (value != null)
            {
                DateTime DateData = DateTime.Parse(value);
                fileNamecell.CellValue = new CellValue(DateData.ToString("dd-MMM-yyyy"));
            }
            else
            {
                fileNamecell.CellValue = new CellValue(string.Empty);
            }
        }
        else if (dataType == "DateTime")
        {
            fileNamecell.DataType = CellValues.String;
            if (value != null)
            {
                DateTime DateData = DateTime.Parse(value);
                fileNamecell.CellValue = new CellValue(DateData.ToString("dd-MMM-yyyy hh:mm tt"));
            }
            else
            {
                fileNamecell.CellValue = new CellValue(string.Empty);
            }
        }
        else
        {
            fileNamecell.DataType = CellValues.String;
            fileNamecell.CellValue = new CellValue(value);
        }
        return fileNamecell;
    }
    async Task addSectionEntry(SpreadsheetDocument spreadsheetDoc, WorkbookPart workbookpart, Sheets sheets, uint sheetId, string SheetDisName)
    {
        try
        {
            SheetData sheetData = new SheetData();

            Row titleRow = new Row { RowIndex = (UInt32)1 };
            List<string> headers = new List<string>();
            if (dataColumnNames != null && dataColumnNames.Count() > 0)
            {
                foreach (var s in dataColumnNames)
                {
                    if (s.IsVisible == true)
                    {
                        if (s.Value == "IsFileprofileTypeDocument")
                        {

                        }
                        else
                        {
                            headers.Add(s.Text);
                        }
                    }
                }
                if (_dynamicFormSectionData != null && _dynamicFormSectionData.Count() > 0)
                {
                    headers.Add("No Section. Default Upload");
                    _dynamicFormSectionData.ForEach(q =>
                    {
                        headers.Add(q.SectionName);
                    });
                }
            }
            headersAdd(titleRow, headers);

            // Append Row to SheetData
            sheetData.AppendChild(titleRow);

            if (Items != null && Items.Count() > 0)
            {
                foreach (var a in Items)
                {
                    dynamic item = (ExpandoObject)a;
                    var byName = (IDictionary<string, object>)a;
                    var _dynamicFormSectionList = await Mediator.Send(new GetDynamicFormSectionById(item.DynamicFormId, applicationUser.UserID, item.DynamicFormDataId));
                    Row row = new Row();
                    if (dataColumnNames != null && dataColumnNames.Count() > 0)
                    {
                        foreach (var s in dataColumnNames)
                        {
                            if (s.IsVisible == true)
                            {

                                if (s.IsDynamicGrid == true)
                                {

                                }
                                else
                                {
                                    if (s.Value == "IsFileprofileTypeDocument")
                                    {
                                    }
                                    else
                                    {
                                        if (s.Value == "ModifiedDate")
                                        {
                                            row.AppendChild(addCellValues("DateTime", (string?)byName[s.Value].ToString()));

                                        }
                                        else
                                        {
                                            if (s.ControlType == "DateEdit")
                                            {
                                                if (byName[s.Value] != null)
                                                {
                                                    row.AppendChild(addCellValues("Date", (string?)byName[s.Value].ToString()));
                                                }
                                                else
                                                {
                                                    row.AppendChild(addCellValues("Date", null));
                                                }
                                            }
                                            else
                                            {
                                                if (s.Value == "ProfileNo")
                                                {
                                                    if (byName[s.Value] != null)
                                                    {
                                                        row.AppendChild(addCellValues("String", (string?)byName[s.Value].ToString()));
                                                    }
                                                    else
                                                    {
                                                        row.AppendChild(addCellValues("String", null));
                                                    }

                                                }
                                                else
                                                {
                                                    if (byName[s.Value] != null)
                                                    {
                                                        row.AppendChild(addCellValues("String", (string?)byName[s.Value].ToString()));
                                                    }
                                                    else
                                                    {
                                                        row.AppendChild(addCellValues("String", null));
                                                    }
                                                }
                                            }
                                        }

                                    }
                                }

                            }
                        }
                        if (_dynamicFormSectionList != null && _dynamicFormSectionList.Count > 0)
                        {
                            _dynamicFormSectionList.ForEach(d =>
                            {
                                if (d.IsFileExits == "Yes")
                                {
                                    var url = DocumentViewUrl + "?url=" + d.UniqueSessionId;
                                    Cell cellHeader = new Cell();
                                    cellHeader.DataType = CellValues.InlineString;
                                    CellFormula cellFormula1 = new CellFormula() { Space = SpaceProcessingModeValues.Preserve };
                                    cellFormula1.Text = @"HYPERLINK(""" + url + @""", """ + d.FileName + @""")";

                                    cellHeader.CellFormula = cellFormula1;
                                    Run run1 = new Run();
                                    run1.Append(new Text(d.FileName));

                                    RunProperties run1Properties = new RunProperties();
                                    run1Properties.Append(new Bold());
                                    run1.RunProperties = run1Properties;
                                    InlineString inlineString = new InlineString();
                                    inlineString.Append(run1);
                                    cellHeader.Append(inlineString);
                                    row.AppendChild(cellHeader);
                                }
                                else
                                {
                                    row.AppendChild(addCellValues("String", null));
                                }
                            });
                        }
                    }
                    sheetData.AppendChild(row);
                }
            }
            // Set the AutoFilter property to a range that is the size of the data
            // within the worksheet
            char c = (char)((int)'A' + headers.Count - 1);
            AutoFilter autoFilter1 = new AutoFilter()
            { Reference = "A1:" + c + headers.Count + 1 };

            Worksheet sheet1 = new Worksheet();
            sheet1.Append(sheetData);
            sheet1.Append(autoFilter1);


            // Add a WorksheetPart to the WorkbookPart.
            WorksheetPart worksheetPart = workbookpart.AddNewPart<WorksheetPart>();
            worksheetPart.Worksheet = sheet1;
            var sheetdatas = worksheetPart.Worksheet.GetFirstChild<SheetData>();
            Columns columns = new Columns();
            columns.Append(new Column() { Min = 1, Max = 100, Width = 40, CustomWidth = true });
            worksheetPart.Worksheet.InsertBefore(columns, sheetdatas);
            // Add Sheets to the Workbook.


            // Append a new worksheet and associate it with the workbook.
            Sheet sheet = new Sheet()
            {
                Id = spreadsheetDoc.WorkbookPart.GetIdOfPart(worksheetPart),
                SheetId = sheetId,
                Name = SheetDisName
            };

            sheets.Append(sheet);
        }
        catch (Exception ex)
        {

        }
    }
    void OnSyncTable()
    {
        tableName = "DynamicForm_" + _dynamicForm?.ScreenID;
        SyncTablepopup = true;
    }
    void UpdateDataSyncDatas(AttributeHeaderListModel attributeHeaderListModel)
    {
        try
        {
            dataColumnNamesSync = new List<DropDownOptionsModel>();
            dataColumnNamesSync.Add(new DropDownOptionsModel() { Value = "DynamicFormDataId", Text = "DynamicFormDataId", Type = "Form" });
            dataColumnNamesSync.Add(new DropDownOptionsModel() { Value = "IsFileprofileTypeDocument", Text = "IsFileprofileTypeDocument", Type = "Form" });
            dataColumnNamesSync.Add(new DropDownOptionsModel() { Value = "SortOrderByNo", Text = "No", Type = "Form" });
            dataColumnNamesSync.Add(new DropDownOptionsModel() { Value = "ProfileNo", Text = "Profile No", Type = "Form" });
            if (SessionId != null)
            {
                if (_dynamicForm != null)
                {
                    if (_dynamicForm != null)
                    {
                        if (attributeHeaderListModel != null && attributeHeaderListModel.DynamicFormSectionAttribute != null && attributeHeaderListModel.DynamicFormSectionAttribute.Count > 0)
                        {
                            attributeHeaderListModel.DynamicFormSectionAttribute.ForEach(a =>
                            {
                                if (a.DataSourceTable == "ApplicationMaster")
                                {
                                    if (a.ApplicationMaster.Count() > 0)
                                    {
                                        a.ApplicationMaster.ForEach(ab =>
                                        {
                                            var nameData = a.DynamicFormSectionAttributeId + "_" + ab.ApplicationMasterCodeId + "_AppMaster";
                                            dataColumnNamesSync.Add(new DropDownOptionsModel() { IsMultiple = a.IsMultiple, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = a.ControlType, Value = nameData, Text = ab.ApplicationMasterName, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo });
                                            if (a.ControlTypeId == 2702 && a.DropDownTypeId == "Data Source" && a.DataSourceTable == "ApplicationMaster" && a.IsDynamicFormGridDropdown == true)
                                            {
                                                var appendDependency = a.DynamicFormSectionAttributeId + "_" + ab.ApplicationMasterCodeId + "_" + a.GridDropDownDynamicFormID + "_GridAppMaster";
                                                dataColumnNamesSync.Add(new DropDownOptionsModel() { IsMultiple = a.IsMultiple, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = a.ControlType, Value = appendDependency, Text = a.GridDropDownDynamicFormName, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo });
                                            }
                                        });
                                    }
                                }
                                else if (a.ControlType == "GroupCheckBox")
                                {
                                    dataColumnNamesSync.Add(new DropDownOptionsModel() { IsMultiple = a.IsMultiple, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = a.ControlType, IsDynamicGrid = a.ControlTypeId == 2712 ? true : false, Value = a.DynamicAttributeName, Text = a.DisplayName, Type = "DynamicForm", Id = a.DynamicFormSectionAttributeId, OrderBy = a.GridDisplaySeqNo });

                                    var _attributeGroupCheckBoxes = attributeHeaderListModel.AttributeGroupCheckBoxes.Where(s => s.AttributeId == a.AttributeId).ToList();
                                    if (_attributeGroupCheckBoxes.Count() > 0)
                                    {
                                        _attributeGroupCheckBoxes.ForEach(z =>
                                        {
                                            if (z.IsTextBox == true)
                                            {
                                                if (z.SubAttributeHeaders.Count() > 0)
                                                {
                                                    z.SubAttributeHeaders.ForEach(w =>
                                                    {
                                                        if (w.DataSourceTable == "ApplicationMaster" && w.SubApplicationMaster != null && w.SubApplicationMaster.Count() > 0)
                                                        {
                                                            w.SubApplicationMaster.ForEach(ab =>
                                                            {
                                                                var appendAppMaster = a.DynamicFormSectionAttributeId + "_" + w.SubDynamicAttributeName + "_" + ab.ApplicationMasterCodeId + "_SubAppMaster";
                                                                dataColumnNamesSync.Add(new DropDownOptionsModel() { IsMultiple = w.IsMultiple, IsSubForm = true, AttributeDetailID = w.AttributeID, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = w.ControlType, Value = appendAppMaster, Text = ab.ApplicationMasterName, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo });

                                                            });
                                                        }
                                                        else
                                                        {
                                                            var nameData = a.DynamicFormSectionAttributeId + "_" + w.SubDynamicAttributeName;
                                                            dataColumnNamesSync.Add(new DropDownOptionsModel() { IsMultiple = w.IsMultiple, IsSubForm = true, AttributeDetailID = w.AttributeID, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = w.ControlType, Value = nameData, Text = w.Description, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo });

                                                        }
                                                    });
                                                }
                                            }
                                            else
                                            {

                                            }
                                        });

                                    }

                                }
                                else if (a.DataSourceTable == "ApplicationMasterParent")
                                {
                                    if (a.ApplicationMasterParents.Count() > 0)
                                    {
                                        a.ApplicationMasterParents.ForEach(ab =>
                                        {
                                            var nameData = a.DynamicFormSectionAttributeId + "_" + ab.ApplicationMasterParentCodeId + "_AppMasterPar";
                                            dataColumnNamesSync.Add(new DropDownOptionsModel() { IsMultiple = a.IsMultiple, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = a.ControlType, Value = nameData, Text = ab.ApplicationMasterName, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo });
                                            RemoveApplicationMasterParentSingleItemSyncData(ab, a, dataColumnNamesSync);
                                            if (a.ControlTypeId == 2702 && a.DropDownTypeId == "Data Source" && a.DataSourceTable == "ApplicationMasterParent" && a.IsDynamicFormGridDropdown == true)
                                            {
                                                var appendDependency = a.DynamicFormSectionAttributeId + "_" + ab.ApplicationMasterParentCodeId + "_" + a.GridDropDownDynamicFormID + "_GridAppMaster";
                                                dataColumnNamesSync.Add(new DropDownOptionsModel() { IsMultiple = a.IsMultiple, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = a.ControlType, Value = appendDependency, Text = a.GridDropDownDynamicFormName, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo });
                                            }
                                        });
                                    }
                                }
                                else if (a.ControlType == "CheckBox" || a.ControlType == "Radio" || a.ControlType == "RadioGroup")
                                {

                                    dataColumnNamesSync.Add(new DropDownOptionsModel() { DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = a.ControlType, IsDynamicGrid = a.ControlTypeId == 2712 ? true : false, Value = a.DynamicAttributeName, Text = a.DisplayName, Type = "DynamicForm", Id = a.DynamicFormSectionAttributeId, OrderBy = a.GridDisplaySeqNo });
                                    if (a.ControlType == "Radio" || a.ControlType == "RadioGroup")
                                    {
                                        var attrDetails = attributeHeaderListModel.AttributeDetails.Where(mm => mm.AttributeID == a.AttributeId && mm.DropDownTypeId == null).ToList();
                                        if (attrDetails.Count() > 0)
                                        {
                                            attrDetails.ForEach(q =>
                                            {
                                                if (q.SubAttributeHeaders.Count() > 0)
                                                {
                                                    q.SubAttributeHeaders.ForEach(w =>
                                                    {
                                                        var nameData = a.DynamicFormSectionAttributeId + "_" + w.SubDynamicAttributeName;
                                                        dataColumnNamesSync.Add(new DropDownOptionsModel() { IsMultiple = w.IsMultiple, IsSubForm = true, AttributeDetailID = w.AttributeID, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = w.ControlType, Value = nameData, Text = w.Description, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo });
                                                        if (w.DataSourceTable == "ApplicationMaster" && w.SubApplicationMaster != null && w.SubApplicationMaster.Count() > 0)
                                                        {
                                                            w.SubApplicationMaster.ForEach(ab =>
                                                            {
                                                                var appendAppMaster = a.DynamicFormSectionAttributeId + "_" + w.SubDynamicAttributeName + "_" + ab.ApplicationMasterCodeId + "_SubAppMaster";
                                                                dataColumnNamesSync.Add(new DropDownOptionsModel() { IsMultiple = w.IsMultiple, IsSubForm = true, AttributeDetailID = w.AttributeID, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = w.ControlType, Value = appendAppMaster, Text = ab.ApplicationMasterName, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo });

                                                            });
                                                        }
                                                    });
                                                }
                                            });
                                        }
                                    }
                                    else
                                    {
                                        if (a.SubAttributeHeaders.Count() > 0)
                                        {
                                            a.SubAttributeHeaders.ForEach(w =>
                                            {
                                                var nameData = a.DynamicFormSectionAttributeId + "_" + w.SubDynamicAttributeName;
                                                dataColumnNamesSync.Add(new DropDownOptionsModel() { IsMultiple = w.IsMultiple, IsSubForm = true, AttributeDetailID = w.AttributeID, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = w.ControlType, Value = nameData, Text = w.Description, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo });
                                                if (w.DataSourceTable == "ApplicationMaster" && w.SubApplicationMaster != null && w.SubApplicationMaster.Count() > 0)
                                                {
                                                    w.SubApplicationMaster.ForEach(ab =>
                                                    {
                                                        var appendAppMaster = a.DynamicFormSectionAttributeId + "_" + w.SubDynamicAttributeName + "_" + ab.ApplicationMasterCodeId + "_SubAppMaster";
                                                        dataColumnNamesSync.Add(new DropDownOptionsModel() { IsMultiple = w.IsMultiple, IsSubForm = true, AttributeDetailID = w.AttributeID, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = w.ControlType, Value = appendAppMaster, Text = ab.ApplicationMasterName, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo });

                                                    });
                                                }

                                            });
                                        }
                                    }
                                }
                                else
                                {
                                    dataColumnNamesSync.Add(new DropDownOptionsModel() { IsMultiple = a.IsMultiple, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = a.ControlType, IsDynamicGrid = a.ControlTypeId == 2712 ? true : false, Value = a.DynamicAttributeName, Text = a.DisplayName, Type = "DynamicForm", Id = a.DynamicFormSectionAttributeId, OrderBy = a.GridDisplaySeqNo });

                                }
                                if (a.ControlType == "ComboBox" && a.IsPlantLoadDependency == true && a.AttributeHeaderDataSource.Count() > 0)
                                {
                                    a.AttributeHeaderDataSource.ForEach(dd =>
                                    {
                                        var nameData = a.DynamicFormSectionAttributeId + "_" + dd.AttributeHeaderDataSourceId + "_" + dd.DataSourceTable + "_Dependency";
                                        dataColumnNamesSync.Add(new DropDownOptionsModel() { IsMultiple = a.IsDependencyMultiple, DynamicFormSectionAttributeId = a.DynamicFormSectionAttributeId, ControlType = a.ControlType, Value = nameData, Text = dd.DisplayName, Type = "DynamicForm", OrderBy = a.GridDisplaySeqNo });
                                    });
                                }

                            });
                            var isSet = dataColumnNamesSync.Where(w => w.Type == "DynamicForm" && w.OrderBy > 0).ToList();
                            if (isSet.Count() > 0)
                            {
                                dataColumnNamesSync = dataColumnNamesSync.OrderBy(o => o.OrderBy).ToList();
                            }
                            if (_dynamicForm != null)
                            {
                                if (_dynamicForm.IsApproval == true)
                                {
                                    dataColumnNamesSync.Add(new DropDownOptionsModel() { Value = "CurrentUserName", Text = "Current User", Type = "Form" });
                                }
                            }
                            dataColumnNamesSync.Add(new DropDownOptionsModel() { Value = "ModifiedBy", Text = "Modified By", Type = "Form" });
                            dataColumnNamesSync.Add(new DropDownOptionsModel() { Value = "ModifiedDate", Text = "Modified Date", Type = "Form" });
                            if (_dynamicForm != null)
                            {
                                if (_dynamicForm.IsApproval == true)
                                {
                                    dataColumnNamesSync.Add(new DropDownOptionsModel() { Value = "StatusName", Text = "Status", Type = "Form" });
                                }
                            }
                        }
                        else
                        {
                            if (_dynamicForm != null)
                            {
                                if (_dynamicForm.IsApproval == true)
                                {
                                    dataColumnNamesSync.Add(new DropDownOptionsModel() { Value = "CurrentUserName", Text = "Current User", Type = "Form" });
                                }
                            }
                            dataColumnNamesSync.Add(new DropDownOptionsModel() { Value = "ModifiedBy", Text = "Modified By", Type = "Form" });
                            dataColumnNamesSync.Add(new DropDownOptionsModel() { Value = "ModifiedDate", Text = "Modified Date", Type = "Form" });
                            if (_dynamicForm != null)
                            {
                                if (_dynamicForm.IsApproval == true)
                                {
                                    dataColumnNamesSync.Add(new DropDownOptionsModel() { Value = "StatusName", Text = "Status", Type = "Form" });
                                }
                            }
                        }
                    }
                    else
                    {
                        dataColumnNamesSync.Add(new DropDownOptionsModel() { Value = "ModifiedBy", Text = "ModifiedBy", Type = "Form" });
                        dataColumnNamesSync.Add(new DropDownOptionsModel() { Value = "ModifiedDate", Text = "ModifiedDate", Type = "Form" });
                    }
                }
            }
            StateHasChanged();
        }
        catch (Exception ex)
        {

        }
    }
    void RemoveApplicationMasterParentSingleItemSyncData(ApplicationMasterParent applicationMasterParent, DynamicFormSectionAttribute dynamicFormSectionAttribute, List<DropDownOptionsModel> dataColumnNamesSync)
    {
        if (applicationMasterParent != null)
        {
            var listss = _AttributeHeader.ApplicationMasterParent.FirstOrDefault(f => f.ParentId == applicationMasterParent.ApplicationMasterParentCodeId);
            if (listss != null)
            {
                var nameData = dynamicFormSectionAttribute.DynamicFormSectionAttributeId + "_" + listss.ApplicationMasterParentCodeId + "_AppMasterPar";
                dataColumnNamesSync.Add(new DropDownOptionsModel() { IsMultiple = dynamicFormSectionAttribute.IsMultiple, DynamicFormSectionAttributeId = dynamicFormSectionAttribute.DynamicFormSectionAttributeId, ControlType = dynamicFormSectionAttribute.ControlType, Value = nameData, Text = listss.ApplicationMasterName, Type = "DynamicForm", OrderBy = dynamicFormSectionAttribute.GridDisplaySeqNo });
                RemoveApplicationMasterParentSingleItemSyncData(listss, dynamicFormSectionAttribute, dataColumnNamesSync);
            }
        }
    }
    async Task OnSyncTables()
    {
        PanelVisible = true; SyncTablepopup = false;
        DynamicFormSearch dynamicFormSearch1 = new DynamicFormSearch();
        var _dynamicformDataLists = Task.Factory.StartNew(() => Mediator.Send(new GetDynamicFormDataById(_dynamicForm.ID, 0, -1, null, null, dynamicFormSearch1)));
        var _AttributeHeaders = Task.Factory.StartNew(() => Mediator.Send(new GetAllAttributeNameList(_dynamicForm, applicationUser.UserID, false, true, false)));
        await Task.WhenAll(_dynamicformDataLists, _AttributeHeaders);
        var _dynamicformDataListItems = await _dynamicformDataLists.Result;
        var _AttributeHeadersDetails = await _AttributeHeaders.Result;
        List<string?> dataSourceTableIds = new List<string?>() { "Plant" };
        var DataSourceTablelists = _AttributeHeadersDetails.DynamicFormSectionAttribute.Where(w => w.AttributeHeaderDataSource.Count > 0).SelectMany(a => a.AttributeHeaderDataSource.Select(s => s.DataSourceTable)).ToList().Distinct().ToList();
        dataSourceTableIds.AddRange(DataSourceTablelists); List<long?> ApplicationMasterIds = new List<long?>(); List<long?> ApplicationMasterParentIds = new List<long?>();
        ApplicationMasterIds = _AttributeHeadersDetails.DynamicFormSectionAttribute.Where(w => w.ApplicationMaster.Count > 0).SelectMany(a => a.ApplicationMaster.Select(s => (long?)s.ApplicationMasterId)).ToList().Distinct().ToList();
        ApplicationMasterParentIds = _AttributeHeadersDetails.DynamicFormSectionAttribute.Where(w => w.ApplicationMasterParents.Count > 0).SelectMany(a => a.ApplicationMasterParents.Select(s => (long?)s.ApplicationMasterParentCodeId)).ToList().Distinct().ToList();
        if (ApplicationMasterIds.Count > 0)
        {
            dataSourceTableIds.Add("ApplicationMaster");
        }
        if (ApplicationMasterParentIds != null && ApplicationMasterParentIds.Count > 0)
        {
            dataSourceTableIds.Add("ApplicationMasterParent");
        }
        var PlantDependencySubAttributeDetailss = Task.Factory.StartNew(() => Mediator.Send(new GetDataSourceDropDownList(null, dataSourceTableIds, null, ApplicationMasterIds, ApplicationMasterParentIds != null ? ApplicationMasterParentIds : new List<long?>())));
        await Task.WhenAll(PlantDependencySubAttributeDetailss);
        var PlantDependencySubAttributeDetailsItems = await PlantDependencySubAttributeDetailss.Result;
        var _dynamicformObjectDataLists = loadItems(_dynamicformDataListItems, _AttributeHeadersDetails, PlantDependencySubAttributeDetailsItems);
        dynamicFormSearch1.StartDate = DateTime.Today.AddYears(50);
        dynamicFormSearch1.EndDate = DateTime.Now;

        UpdateDataSyncDatas(_AttributeHeadersDetails);
        var resultData = await Mediator.Send(new GetDynamicFormDataTableSync(dataColumnNamesSync, _dynamicformObjectDataLists, _AttributeHeadersDetails, _dynamicForm));
        if (resultData.ID > 0)
        {
            PanelVisible = false;
            toastService.ShowToast("Table Sync Successfully", AC.SD.Core.Services.ToastLevel.Success);
        }
        StateHasChanged();
    }
}
