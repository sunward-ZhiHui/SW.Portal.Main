@page "/dynamicMainForm"


<DxFormLayout CssClass="w-100">
    <DxFormLayoutItem Caption="" ColSpanMd="12">
        @foreach (var item in ComplaintItems)
        {
            @RenderComplaintItem(item, 0)
        }
    </DxFormLayoutItem>
</DxFormLayout>

@code {
    public class ComplaintItem
    {
        public string Label { get; set; }
        public bool? Value { get; set; } = false;     // For checkboxes
        public string TextValue { get; set; }         // For text input
        public bool IsItalic { get; set; }
        public bool IsBold { get; set; }
        public bool IsTextBox { get; set; } = false;  // 🔸 Flag for textbox
        public List<ComplaintItem> Children { get; set; } = new();
    }


    List<ComplaintItem> ComplaintItems = new()
    {
        new ComplaintItem
        {
            Label = "Violation of Company Policy, SOP and/or Work Instruction",
            Children =
            {
                 new ComplaintItem { Label = "Specify violated policy:", IsItalic = true, IsTextBox = true },
                new ComplaintItem { Label = "Specify in details of violated clause:", IsItalic = true, IsTextBox = true },

            }
        },
        new ComplaintItem
        {
            Label = "Violation of Human Resources Policy",
            Children =
            {
                new ComplaintItem { Label = "Specify in details of violated clause:", IsItalic = true,IsTextBox = true }
            }
        },
        new ComplaintItem
        {
            Label = "Job Performance Related Matters",
            Children = new List<ComplaintItem>
            {
                new ComplaintItem { Label = "Document Validity" },
                new ComplaintItem { Label = "Document Report" },
                new ComplaintItem { Label = "Discussion Due" },
                new ComplaintItem { Label = "IPIR" },
                new ComplaintItem { Label = "OPIR" },
                new ComplaintItem { Label = "SOP",
                // Children =
                // {
                //     new ComplaintItem { Label = "Tardiness CheckBox1" ,IsItalic = true,IsTextBox = true},
                //     new ComplaintItem { Label = "Unauthorized absent CheckBox1" },
                // }
                },
                new ComplaintItem { Label = "Task Management/Project" },
                new ComplaintItem { Label = "Work Instruction" },
                new ComplaintItem { Label = "Job Duty/Responsibility" },
                new ComplaintItem { Label = "Others:" ,
                Children =
                {
                    new ComplaintItem { Label = "Tardiness2" },
                    new ComplaintItem { Label = "Unauthorized absent2" },
                    new ComplaintItem { Label = "Tardiness22",
                //     Children =
                // {
                //     new ComplaintItem { Label = "Tardiness CheckBox1" ,IsItalic = true,IsTextBox = true},
                //     new ComplaintItem { Label = "Unauthorized absent CheckBox1" ,IsItalic = true,IsTextBox = true},
                // }
                },
                    new ComplaintItem { Label = "Unauthorized absent22" },
                }},
            }
        },
        new ComplaintItem
        {
            Label = "Attendance",
            Children =
            {
                new ComplaintItem { Label = "Tardiness" },
                new ComplaintItem { Label = "Unauthorized absent" },
                new ComplaintItem { Label = "Unauthorized absent11" },
            }
        }
    };

    RenderFragment RenderComplaintItem(ComplaintItem item, int indent, bool? isVisible = true) => builder =>
{
    int seq = 0;

    // If this item should not be rendered due to parent not checked
    //if (isVisible == false && item.IsTextBox)
       // return;

    builder.OpenElement(seq++, "div");
    builder.AddAttribute(seq++, "class", "mb-1");
    builder.AddAttribute(seq++, "style", $"padding-left: {indent}px;");

    // Checkbox items
    if (!item.IsTextBox)
    {
        builder.OpenComponent<DxCheckBox<bool?>>(seq++);
        builder.AddAttribute(seq++, "Checked", item.Value);
        builder.AddAttribute(seq++, "CheckedChanged", EventCallback.Factory.Create<bool?>(this, val => item.Value = val));
        builder.AddAttribute(seq++, "ChildContent", (RenderFragment)((b) =>
        {
            var style = item.IsItalic ? "font-style:italic;" : item.IsBold ? "font-weight:bold;" : "";
            b.OpenElement(seq++, "span");
            b.AddAttribute(seq++, "style", style);
            b.AddContent(seq++, item.Label);
            b.CloseElement();
        }));
        builder.CloseComponent();
    }

    // Textbox items, only show if parent is checked
    if (item.IsTextBox && isVisible == true)
    {
        builder.OpenElement(seq++, "div");
        builder.AddAttribute(seq++, "class", "align-items-center gap-2");

        // Label
        builder.OpenElement(seq++, "label");
        builder.AddAttribute(seq++, "style", "min-width: 150px;");
        builder.AddContent(seq++, item.Label);
        builder.CloseElement();

        // Textbox
        builder.OpenComponent<DxTextBox>(seq++);
        builder.AddAttribute(seq++, "Text", item.TextValue);
        builder.AddAttribute(seq++, "TextChanged", EventCallback.Factory.Create<string>(this, val => item.TextValue = val));
        builder.AddAttribute(seq++, "style", "width: 300px;");
        builder.CloseComponent();

        builder.CloseElement(); // end flex row
    }

    builder.CloseElement(); // container

    // Render children — pass current item's checked value
    if (item.Children?.Any() == true)
    {
        builder.OpenElement(seq++, "div");
        builder.AddAttribute(seq++, "class", "d-flex flex-wrap gap-2 ms-4 mb-2");

        foreach (var child in item.Children)
        {
            builder.OpenElement(seq++, "div");
            builder.AddAttribute(seq++, "style", child.IsTextBox ? "flex: 0 0 100%;" : "flex: 0 0 calc(33.33% - 10px);");
            builder.AddContent(seq++, RenderComplaintItem(child, indent + 20, item.Value == true));
            builder.CloseElement();
        }

        builder.CloseElement(); // close children container
    }
};



}



