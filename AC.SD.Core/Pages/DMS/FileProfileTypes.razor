@page "/fileprofiletype/"
@page "/fileprofiletype/{MainSessionId:guid}"
@page "/fileprofiletype/{MainSessionId:guid}/{DocSessionId:guid}"
@using Application.Queries;
@using MediatR;
@inject IMediator Mediator
@using global::Core.Entities;
@using global::Core.Entities.Views;
@using global::Core.EntityModels;
@inject AC.SD.Core.Helpers.TreeGenerateRecursive _treeGenerateRecursive
@inject IJSRuntime jsRuntime
@inject NavigationManager NavigationManager
@using Microsoft.Extensions.Configuration;
@inject IConfiguration Configuration
@inject ClipboardService ClipboardService
@using global::Core.Repositories.Query;
@inject AC.SD.Core.Services.ToastService toastService
@inject ILocalStorageService<ApplicationUser> _localStorageService
@using Application.Command.ApplicationMasterChilds;
@using Application.Command.ApplicationMasterDetails;
@implements IDisposable;
@using System;
@using System.IO;
<style>
    .dxbl-wait-indicator {
        --dxbl-wait-indicator-color: white;
    }

    .dxbl-btn.dxbl-lg {
        --dxbl-btn-line-height: 1.5rem;
    }

    .table-hover-OnFileProfile {
        cursor: pointer;
    }
</style>

<div class="menu-bar-content-container col-md-12">
    <div class="card w-100" style="margin-bottom:1px;">



        <div class="card-body p-0" style="@onShowMain">

            <DxMenu CollapseItemsToHamburgerMenu="true"
                    CollapseItemToIconMode="MenuCollapseItemToIconMode.Sequentially"
                    DisplayMode="MenuDisplayMode.Auto">

                <Items>
                    <DxMenuItem Position="ItemPosition.Start" IconCssClass="fa fa-reply " Click="onBack" />
                    <DxMenuItem Text="Profile Type" Position="ItemPosition.Start" style="@isFilterMore">
                        <Items>
                            <DxMenuItem Text="Add Main Folder" IconCssClass="fa fa-add" Click="onAddFileProfileType" Visible="@isCreateFolder" />
                            <DxMenuItem Text="Add Sub Folder" IconCssClass="fa fa-plus-circle" Click="onAddSubFileProfileType" Visible="@isCreateSubFolder" />
                            <DxMenuItem Text="Edit Folder" IconCssClass="fa fa-pencil" Click="@onEditFileProfileType" Visible="@isEdit" />
                            <DxMenuItem Text="Delete Folder" IconCssClass="fa fa-remove" Click="@onDeleteFileProfileType" Visible="@isDelete" />
                        </Items>
                    </DxMenuItem>
                    <DxMenuItem Position="ItemPosition.End" title="Move" IconCssClass="fa fa-sign-in" style="@isMoveEnabled" Click="@(() => OnFileProfilteMoveDocuments())" id=@($"flyout-overview-target-container-MoveDocuments") />
                    <DxMenuItem Position="ItemPosition.End" title="Search And Filter" IconCssClass="fa fa-filter" Click="@(() => OnFileProfiltefilter("Open"))" id=@($"flyout-overview-target-container-FilterDocuments") />
                    <DxMenuItem Position="ItemPosition.End" title="Profile Info" IconCssClass="fa fa-info" Click="OnFileProfileTypeInfo" style="@isVisibleParentMore" id=@($"flyout-overview-target-container-FileProfileTypeInfoDocuments") />
                    <DxMenuItem Position="ItemPosition.End" title="Permission" IconCssClass="fa fa-shield" Click="OnSecurity" Enabled="@IsGrantAdminPermission" style="@isVisibleParentMore" />
                    <DxMenuItem Position="ItemPosition.End" title="Upload Documents" IconCssClass="fa fa-ellipsis-v" Click="onmore" Enabled="@moreEnabled" style="@isVisibleParentMore">
                        <Items>
                            <DxMenuItem Text="Upload New Documents" IconCssClass="fa fa-cloud-upload" Click="onUploadFileProfileType" Visible="isCreateDocumentEnabled" />
                            <DxMenuItem Text="ReUpload Documents" IconCssClass="fa fa-cloud-upload" Click="onMissingUploadFileProfileType" Visible="isCreateDocumentEnabled" />
                            <DxMenuItem Text="Upload Documents By Form" IconCssClass="fa fa-cloud-upload" Click="onUploadDynamicForm" Visible="isCreateDynamicDocumentEnabled" />
                            <DxMenuItem Text="Reserve Profile Number Series" IconCssClass="fa fa-plus-square" Click="onReserveProfileNumberSeries" Visible="IsReserveProfileNumberEnabled" />
                            <DxMenuItem Text="Add/Edit Profile Type Info" IconCssClass="fa fa-info" Click="onAddFileProfileTypeInfo" Visible="isProfileInfoEnabled" />
                        </Items>
                    </DxMenuItem>

                    <DxMenuItem Text="More" Position="ItemPosition.End" IconCssClass="fa fa-ellipsis-v" style="@isVisibleMore">
                        <Items>
                            <DxMenuItem Text="View File" IconCssClass="fa fa-eye" Click="onView" Visible="@viewfileEnabled" />
                            <DxMenuItem Text="Rename" IconCssClass="fa fa-pencil" Click="onRename" Visible="@renameEnabled" />
                            <DxMenuItem Text="Delete" IconCssClass="fa fa-remove" Click="onDeleteDocument" Visible="@deleteEnabled" />
                            <DxMenuItem Text="Check Out" IconCssClass="fa fa-check-square" Click="onCheckOut" Visible="@checkoutEnabled" />
                            <DxMenuItem Text="Check In" IconCssClass="fa fa-check-circle" Visible="@checkInEnabled" Click="onCheckin" />
                            <DxMenuItem Text="History" IconCssClass="fa fa-history" Click="onHistory" Visible="@historyEnabled" />
                            <DxMenuItem Text="Copy Link" IconCssClass="fa fa-link" Click="onCopy" Visible="@copylinkEnabled" />
                            <DxMenuItem Text="Share" IconCssClass="fa fa-share-square" Click="onShare" Visible="@shareEnabled" />
                            <DxMenuItem Text="Link Document" IconCssClass="fa fa-link" Click="onLinkDocuments" Visible="@linkdownloadEnabled" />
                            <DxMenuItem Text="Form Details" IconCssClass="fa fa-info-circle" Click="onFormDetails" Visible="@formdetailsEnabled" />
                            <DxMenuItem Text="View Parent Documents" IconCssClass="fa fa-paperclip" Click="onViewparentDocuments" Visible="@viewParentEnabled" />
                            <DxMenuItem Text="Email" IconCssClass="fa fa-envelope" Click="onFileProfileTypeEmail" Visible="EmailEnabled" />
                        </Items>
                    </DxMenuItem>

                </Items>
            </DxMenu>

        </div>


    </div>
</div>
<div class="menu-bar-content-container col-md-12">
    <div class="card w-100" style="margin-bottom:1px;">
        <div class="card-body p-0" style="@onShowMain">

            <DxMenu Data="@FolderPathListsItems" ItemClick="OnItemClick"
                    DisplayMode="MenuDisplayMode.Auto">
                <DataMappings>
                    <DxMenuDataMapping Text="FileName"
                                       Children="Children"
                                       BeginGroup="BeginGroup"
                                       CssClass="CssClass"
                                       Enabled="Enabled" />
                </DataMappings>
            </DxMenu>
        </div>
    </div>
</div>
<div style="@onShowMain">
    <DxLoadingPanel @bind-Visible="PanelVisible"
                    IsContentBlocked="true"
                    ApplyBackgroundShading="true"
                    IndicatorAreaVisible="false"
                    Text="Fetching Data...">
        <DxGrid @ref="Grid"
                Data="fileProfileTypeDocuments"
                KeyFieldName="UniqueNo"
                SelectAllCheckboxMode="GridSelectAllCheckboxMode.AllPages"
                ColumnResizeMode="GridColumnResizeMode.ColumnsContainer"
                FilterMenuButtonDisplayMode="GridFilterMenuButtonDisplayMode.Always"
                ShowGroupPanel="true" ShowGroupedColumns="true" ShowSearchBox="true"
                SearchText="@searchText"
                SearchTextChanged="OnSearchTextChanged"
                PagerNavigationMode="PagerNavigationMode.InputBox"
                PageSizeSelectorVisible="true"
                PageSizeSelectorAllRowsItemVisible="true"
                PageSizeSelectorItems="@(new int[] { 5,10,20 })"
                CustomizeCellDisplayText="Grid_CustomizeCellDisplayText"
                PageSize="20"
                CustomizeElement="Grid_CustomizeElement" ValidationEnabled="false"
                RowClick="OnRowClick"
                RowDoubleClick="OnRowDoubleClick"
                FocusedRowEnabled="true"
                AllowSelectRowByClick="true"
                CustomizeFilterMenu="OnCustomizeFilterMenu"
                FilterCriteriaChanged="FilterCriteriaChanged"
                CustomizeSummaryDisplayText="Grid_CustomizeSummaryDisplayText"
                SelectionMode="GridSelectionMode.Single"
                AutoExpandAllGroupRows="true"
                CssClass="w-100 table-hover-OnFileProfile"
                style="height: calc(100vh - 250px);">
            <Columns>
                @*            <DxGridSelectionColumn  Width="60px" />
                *@            <DxGridDataColumn FieldName="UniqueNo" Visible="false" />
                <DxGridCommandColumn MinWidth="100" Visible="isCheckAllEnabled">
                    <HeaderTemplate>
                        <DxCheckBox Checked="@CheckedAll" CheckedExpression="@(() => CheckedAll)" CheckedChanged="@((bool value) => OnCheckedAllValueChanged(value))"></DxCheckBox>
                    </HeaderTemplate>
                    <CellDisplayTemplate>
                        @{
                            var item = (DocumentsModel)context.DataItem;
                            // if (item.FilterProfileTypeId > 0 && item.Type == "Document")
                            //  {
                            <DxCheckBox @bind-Checked="item.Checked"></DxCheckBox>
                            // }
                        }
                    </CellDisplayTemplate>
                </DxGridCommandColumn>
                <DxGridDataColumn FieldName="FileName" Caption="Name" MinWidth="270">
                    <CellDisplayTemplate>

                        @{
                            var item = (DocumentsModel)context.DataItem;
                            var contentType = item.ContentType != null ? item.ContentType.Split("/").First().ToLower() : "";
                        }
                        @if (item.Type == "Document")
                        {
                            @if (item.SharesCount > 0)
                            {
                                <i class="fa fa-share-alt" aria-hidden="true" style="padding:5px;margin-right: 5px;color:black" title="@item.FileName"></i>
                            }
                            @if (item.IsEmailTopics == true)
                            {
                                <i class="fa fa-envelope" aria-hidden="true" style="padding:5px;margin-right: 5px;color:black" title="@item.FileName"></i>
                            }
                            @if (item.Extension == "xlsx" || item.Extension == "xls")
                            {
                                <i class="fa fa-file-excel" aria-hidden="true" style="padding:5px;margin-right: 5px;color:green" title="@item.FileName"></i>
                            }
                            else if (item.Extension == "ppt" || item.Extension == "pptx")
                            {
                                <i class="fa fa-file-powerpoint" aria-hidden="true" style="padding:5px;margin-right: 5px;color:#C03F1F;" title="@item.FileName"></i>
                            }
                            else if (item.Extension == "doc" || item.Extension == "docx")
                            {
                                <i class="fa fa-file-word" aria-hidden="true" style="padding:5px;margin-right: 5px;color:blue;" title="@item.FileName"></i>
                            }
                            else if (item.Extension == "pdf")
                            {
                                <i class="fa fa-file-pdf" aria-hidden="true" style="padding:5px;margin-right: 5px;color:red;" title="@item.FileName"></i>
                            }
                            else if (item.Extension == "txt")
                            {
                                <i class="fa fa-file-text" aria-hidden="true" style="padding:5px;margin-right: 5px;" title="@item.FileName"></i>
                            }
                            else
                            {
                                if (contentType == "image")
                                {
                                    <i class="fa fa-file-image" aria-hidden="true" style="padding:5px;margin-right: 5px;color:#1E3050" title="@item.FileName"></i>
                                }
                                else if (contentType == "video")
                                {
                                    <i class="fa fa-file-video" aria-hidden="true" style="padding:5px;margin-right: 5px;color:#008080" title="@item.FileName"></i>
                                }
                                else if (contentType == "audio")
                                {
                                    <i class="fa fa-file-audio" aria-hidden="true" style="padding:5px;margin-right: 5px;color:#005675" title="@item.FileName"></i>
                                }
                                else
                                {
                                    <i class="fa fa-file" aria-hidden="true" style="padding:5px;margin-right: 5px;" title="@item.FileName"></i>
                                }
                            }
                            @if (item.IsLocked == true)
                            {
                                <i class="fa fa-lock" aria-hidden="true" style="padding:5px;margin-right: 5px;" title="@item.LockedByUser"></i>
                            }

                        }
                        else
                        {
                            <i class="fa fa-folder" aria-hidden="true" style="padding:5px;margin-right: 5px;color:yellow" title="@item.FileName"></i>
                        }
                        <span id=@($"flyout-overview-target-container-RenameFilename-{item.DocumentID}") title="@item.FileName">@item.FileName</span>
                    </CellDisplayTemplate>
                </DxGridDataColumn>
                <DxGridDataColumn FieldName="FullPath" Caption="Path" Visible="@isEnablePath" MinWidth="170">
                    <CellDisplayTemplate>
                        @{
                            var item = (DocumentsModel)context.DataItem;
                            <a href="javascript:void(0);" title="@item.FullPath" onclick="@(() => openFileProfileOpenPathLink(item))" style="color:black;">@item.FullPath</a>
                        }
                    </CellDisplayTemplate>
                </DxGridDataColumn>
                <DxGridDataColumn FieldName="ProfileNo" Caption="Profile" MinWidth="170" />
                <DxGridDataColumn FieldName="ActivityProfileNo" Caption="Activity Profile" MinWidth="170" />
                <DxGridDataColumn FieldName="FileSizes" Caption="File Size" MinWidth="170">
                    <CellDisplayTemplate>
                        @{
                            var item = (DocumentsModel)context.DataItem;
                        }

                        @(item.FileSizes + (!string.IsNullOrEmpty(item.FileCounts) ? ("," + item.FileCounts) : ""))
                        @((item.FileIndex > 0 ? ("," + item.FileIndex + " History") : ""))
                    </CellDisplayTemplate>
                </DxGridDataColumn>
                <DxGridDataColumn FieldName="Description" MinWidth="200">
                    <CellDisplayTemplate>
                        @{
                            var item = (DocumentsModel)context.DataItem;
                        }
                        <i class="fa fa-pencil" aria-hidden="true" style="margin-right: 5px;cursor:pointer;" id=@($"flyout-overview-target-container-Description-{item.DocumentID}") onclick="@(() => OnButtonDescriptionClick(item))" title="@item.Description"></i>
                        <span title="@item.Description">@item.Description</span>
                    </CellDisplayTemplate>
                </DxGridDataColumn>
                <DxGridDataColumn FieldName="ExpiryDate" MinWidth="170">
                    <CellDisplayTemplate>
                        @{
                            var item = (DocumentsModel)context.DataItem;
                            var expiryDate = (item.ExpiryDate != null ? Application.Common.Helper.Helper.FormatDate(item.ExpiryDate.Value) : null);
                        }
                        @if (item.Type == "Document")
                        {
                            if (isExpiryDateVisible == true)
                            {
                                <i class="fa fa-pencil" aria-hidden="true" style="margin-right: 5px;cursor:pointer;" id=@($"flyout-overview-target-container-ExpiryDate-{item.DocumentID}") onclick="@(() => OnButtonExpiryDateClick(item))" title="@expiryDate"></i>
                            }
                            @expiryDate
                        }
                    </CellDisplayTemplate>
                </DxGridDataColumn>
                <DxGridDataColumn FieldName="AddedBy" Caption="Added By" MinWidth="170" />
                <DxGridDataColumn FieldName="AddedDate" Caption="Added" MinWidth="170" />
                <DxGridDataColumn FieldName="ModifiedBy" Caption="Modified By" MinWidth="170" />
                <DxGridDataColumn FieldName="ModifiedDate" Caption="Modified" MinWidth="170" />
            </Columns>
            <TotalSummary>
                <DxGridSummaryItem SummaryType="GridSummaryItemType.Count" FieldName="ProfileNo" />
            </TotalSummary>
        </DxGrid>
    </DxLoadingPanel>
</div>
<DxPopup @bind-Visible="@PopupVisible"
         ShowFooter="false"
         ShowCloseButton="true"
         HeaderText="Document History"
         CloseOnOutsideClick="false"
         MinWidth="300" MinHeight="200" MaxWidth="1000px" MaxHeight="800">
    <BodyContentTemplate>
        <HistoryPopup selectedFiles="@selectedFiles"></HistoryPopup>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton RenderStyle="ButtonRenderStyle.Secondary" Text="Close" Click="@(() => ClosePopup())" />
    </FooterContentTemplate>
</DxPopup>
<DxPopup @bind-Visible="@PopupVisibleLinkDocument"
         ShowFooter="false"
         ShowCloseButton="true"
         HeaderText="Link Documents"
         CloseOnOutsideClick="false"
         MinWidth="300" MinHeight="200" MaxWidth="1000px" MaxHeight="800">
    <BodyContentTemplate>
        <LinkDocumentsList selectedFiles="@selectedFiles"></LinkDocumentsList>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton RenderStyle="ButtonRenderStyle.Secondary" Text="Close" Click="@(() => CloseLinkDocumentPopup())" />
    </FooterContentTemplate>
</DxPopup>
<DxPopup @bind-Visible="@PopupVisibleLinkParentDocument"
         ShowFooter="false"
         HeaderText="Parent Documents"
         ShowCloseButton="true"
         CloseOnOutsideClick="false"
         MinWidth="300" MinHeight="200" MaxWidth="1000px" MaxHeight="800">
    <BodyContentTemplate>
        <ParentLinkDocuments ParentSelectedFiles="@_selectedItems" LinkProfileSelectedFiles="@LinkProfileSelectedFiles" LinkType="Profile Type"></ParentLinkDocuments>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton RenderStyle="ButtonRenderStyle.Secondary" Text="Close" Click="@(() => CloseLinkParentDocumentPopup())" />
    </FooterContentTemplate>
</DxPopup>
<DxFlyout @bind-IsOpen=IsDescriptionOpen
          PositionTarget=@($"#flyout-overview-target-container-Description-{_selectedDescriptionItems?.DocumentID}")
          RestrictionTarget="#Navigation-Flyout-Customization"
          AnimationType="FlyoutAnimationType.Fade"
          PreventCloseOnPositionTargetClick="true"
          HeaderVisible="true"
          HeaderText="Update Description"
          FooterVisible="true"
          CloseOnOutsideClick="false"
          FooterCssClass="custom-flyout-footer"
          MinWidth="500" MinHeight="200" MaxWidth="1000px" MaxHeight="800"
          Position=@(FlyoutPosition.BottomStart | FlyoutPosition.TopStart)>
    <BodyContentTemplate Context="PopupContext">
        <DxFormLayout CssClass="w-100">
            <DxFormLayoutItem Caption="Description:" ColSpanMd="12">
                <DxMemo @bind-Text="@_selectedDescriptionItems.Description" CssClass="cw-480" Rows="5" />
            </DxFormLayoutItem>
        </DxFormLayout>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton style="margin-right: 10px;" RenderStyle="ButtonRenderStyle.Primary" Text="Close" Click=@(()=> IsDescriptionOpen = false) />
        <DxButton RenderStyle="ButtonRenderStyle.Success" Text="Update" Click=@(()=> OnUpdateDescription()) />
    </FooterContentTemplate>
</DxFlyout>
<DxFlyout @bind-IsOpen=IsExpiryDateOpen
          PositionTarget=@($"#flyout-overview-target-container-ExpiryDate-{_selectedDescriptionItems?.DocumentID}")
          RestrictionTarget="#Navigation-Flyout-Customization"
          AnimationType="FlyoutAnimationType.Fade"
          PreventCloseOnPositionTargetClick="true"
          FooterVisible="true"
          HeaderVisible="true"
          CloseOnOutsideClick="false"
          HeaderText="Update Expiry Date"
          FooterCssClass="custom-flyout-footer"
          MinWidth="500" MinHeight="200" MaxWidth="1000px" MaxHeight="800"
          Position=@(FlyoutPosition.BottomStart | FlyoutPosition.TopStart)>
    <BodyContentTemplate Context="PopupContext">
        <DxFormLayout CssClass="w-100">
            <DxFormLayoutItem Caption="Expiry Date:" ColSpanMd="12">
                <DxDateEdit NullText="Select a Expiry Date..." @bind-Date="@_selectedDescriptionItems.ExpiryDate" CssClass="cw-320" />
            </DxFormLayoutItem>
        </DxFormLayout>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton style="margin-right: 10px;" RenderStyle="ButtonRenderStyle.Primary" Text="Close" Click=@(()=> IsExpiryDateOpen = false) />
        <DxButton RenderStyle="ButtonRenderStyle.Success" Text="Update" Click=@(()=> OnUpdateExpiryDate()) />


    </FooterContentTemplate>
</DxFlyout>
<DxFlyout @bind-IsOpen=IsRenameOpen
          PositionTarget=@($"#flyout-overview-target-container-RenameFilename-{_selectedDescriptionItems?.DocumentID}")
          RestrictionTarget="#Navigation-Flyout-Customization"
          AnimationType="FlyoutAnimationType.Fade"
          HeaderVisible="true"
          HeaderText="Rename Document"
          FooterVisible="true"
          FooterCssClass="custom-flyout-footer"
          CloseOnOutsideClick="false"
          MinWidth="600" MinHeight="200" MaxWidth="1000px" MaxHeight="800"
          PreventCloseOnPositionTargetClick="true">
    <BodyContentTemplate Context="PopupContext">
        <DxFormLayout CssClass="w-100">
            <DxFormLayoutItem Caption="Document Name:" ColSpanMd="9">
                <DxTextBox @bind-Text="@NewRename" CssClass="cw-480" />
            </DxFormLayoutItem>
            <DxFormLayoutItem Caption="" ColSpanMd="3">
                <DxTextBox @bind-Text="@_selectedDescriptionItems.Extension" CssClass="cw-480" Enabled="false" />
            </DxFormLayoutItem>
        </DxFormLayout>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton style="margin-right: 10px;" RenderStyle="ButtonRenderStyle.Primary" Text="Close" Click=@(()=> IsRenameOpen = false) />
        <DxButton RenderStyle="ButtonRenderStyle.Success" Text="Update" Click=@(()=> OnUpdateDocumentRename()) />


    </FooterContentTemplate>
</DxFlyout>
<DxPopup @bind-Visible="@PopupVisibleSecurityAccess"
         ShowFooter="false"
         ShowCloseButton="true"
         HeaderText=@($"Security Access-{Name}")
         CloseOnOutsideClick="false"
         MinWidth="300" MinHeight="200" MaxWidth="1000px" MaxHeight="800">
    <BodyContentTemplate>
        <FileProfileTypeSecurity FileProfileTypeId="@FileProfileTypeId" selectedItems="@_selectedItems"></FileProfileTypeSecurity>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton RenderStyle="ButtonRenderStyle.Secondary" Text="Close" Click="@(() => CloseSecurityAccessPopup())" />
    </FooterContentTemplate>
</DxPopup>
@* <div style="@onUploadVisible">
 *@

<DxPopup @bind-Visible="@PopupNewUpload"
         HeaderText="Upload Documents"
         CloseOnOutsideClick="false"
         ShowFooter="false"
         ShowCloseButton="true"
         MinWidth="300" MinHeight="200" MaxWidth="1000px" MaxHeight="800">
    <BodyContentTemplate>
        <UploadDoumentFiles @ref="refUploadDoumentFiles" FolderPathLists="@FolderPathLists" applicationUser="@applicationUser" selectedFiles="@_ParentselectedItems" UploadDocFormID="UploadDocFormID" RevokeBack="BackUpload"></UploadDoumentFiles>
    </BodyContentTemplate>
</DxPopup>
@* </div> *@
<DxPopup @bind-Visible="@PopupUpload"
         HeaderText="Upload Documents"
         CloseOnOutsideClick="false"
         ShowFooter="false"
         ShowCloseButton="true"
         MinWidth="300" MinHeight="200" MaxWidth="1000px" MaxHeight="800">
    <BodyContentTemplate>
        <UploadDocumentUpdateFiles @ref="refUploadDocumentUpdateFiles" FolderPathLists="@FolderPathLists" selectedItems="@_selectedItems" applicationUser="@applicationUser" FileProfileSessionId="@MainSessionId" RevokeBack="BackUpload"></UploadDocumentUpdateFiles>
    </BodyContentTemplate>
</DxPopup>
<DxPopup @bind-Visible="@Blukdeletepopup"
         ShowCloseButton="true"
         ShowFooter="true"
         HeaderText="Delete"
         Closed="EulaPopupClosed"
         MinWidth="300" MinHeight="200" MaxWidth="1000px" MaxHeight="800">
    <BodyContentTemplate>
        <p>
            Do you want to delete this Profile
        </p>
        <strong>@DeleteProfileTypeName</strong>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton style="margin-right: 10px;" RenderStyle="ButtonRenderStyle.Primary" Text="NO" Click="Context.CloseCallback" />
        <DxButton RenderStyle="ButtonRenderStyle.Secondary" Text="Yes" Click="deleteFileProfileTypes" />

    </FooterContentTemplate>
</DxPopup>

<DxPopup @bind-Visible="@BlukdeleteDocument"
         ShowFooter="true"
         ShowCloseButton="true"
         HeaderText="Delete"
         Closed="EulaPopupDocumentClosed"
         Width="300px">
    <BodyContentTemplate>
        <p>
            Do you want to delete this Document
        </p>
        <strong>@DeleteDocumentName</strong>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton style="margin-right: 10px;" RenderStyle="ButtonRenderStyle.Primary" Text="NO" Click="Context.CloseCallback" />
        <DxButton RenderStyle="ButtonRenderStyle.Secondary" Text="Yes" Click="onDelete" />

    </FooterContentTemplate>
</DxPopup>


<DxFlyout @bind-IsOpen=IsFilterOpen
          PositionTarget=@($"#flyout-overview-target-container-FilterDocuments")
          RestrictionTarget="#Navigation-Flyout-Customization"
          AnimationType="FlyoutAnimationType.Fade"
          HeaderVisible="true"
          HeaderText="Search Document"
          FooterVisible="true"
          FooterCssClass="custom-flyout-footer"
          CloseOnOutsideClick="false"
          MinWidth="500" MinHeight="200" MaxWidth="1000px" MaxHeight="800"
          PreventCloseOnPositionTargetClick="true">
    <BodyContentTemplate Context="PopupContext">
        <DxFormLayout CssClass="w-100">

            <DxFormLayoutItem Caption="Sunward Libraries" ColSpanMd="12">
                <DxTextBox NullText="Select Sunward Libraries..." @bind-Text="@LinkFilterFileprofiletypeName" CssClass="cw-480">
                    <Buttons>
                        <DxEditorButton IconCssClass="fa fa-add" Id=@($"flyout-overview-target-container-IsFilterFileProfileTypeDocumentOpen")
                                        Tooltip="Select Sunward Libraries"
                                        Click="@(_ => OnButtonFileProfileTypeLinDocClick())" />
                    </Buttons>
                </DxTextBox>
            </DxFormLayoutItem>
            <DxFormLayoutItem Caption="Document Name:" ColSpanMd="12">
                <DxTextBox @bind-Text="@LinkFilterFileprofiletypeFileName" ClearButtonDisplayMode="DataEditorClearButtonDisplayMode.Auto" CssClass="cw-480" />
            </DxFormLayoutItem>
            <DxFormLayoutItem Caption="Document No:" ColSpanMd="12">
                <DxTextBox @bind-Text="@LinkFilterFileprofiletypeProfileNo" ClearButtonDisplayMode="DataEditorClearButtonDisplayMode.Auto" CssClass="cw-480" />
            </DxFormLayoutItem>
            <DxFormLayoutItem Caption="Ext" ColSpanMd="12">
                <DxComboBox Data="@_fileContentList"
                            NullText="Select File Ext..."
                            ListRenderMode="ListRenderMode.Virtual"
                            SearchMode="ListSearchMode.Default"
                            SearchFilterCondition="ListSearchFilterCondition.Contains"
                            TextFieldName="Extension"
                            ValueFieldName="Extension"
                            ClearButtonDisplayMode="DataEditorClearButtonDisplayMode.Auto"
                            @bind-Value="@LinkFilterFileprofiletypeExtension" ShowValidationIcon="true">
                </DxComboBox>
            </DxFormLayoutItem>
            <DxFormLayoutItem Caption="From" ColSpanMd="12">
                <DxDateEdit NullText="Select a From Date..." @bind-Date="@LinkFilterFileprofiletypeFrom" ClearButtonDisplayMode="DataEditorClearButtonDisplayMode.Auto" CssClass="cw-320" />
            </DxFormLayoutItem>
            <DxFormLayoutItem Caption="To" ColSpanMd="12">
                <DxDateEdit NullText="Select a To Date..." @bind-Date="@LinkFilterFileprofiletypeTo" ClearButtonDisplayMode="DataEditorClearButtonDisplayMode.Auto" CssClass="cw-320" />
            </DxFormLayoutItem>
        </DxFormLayout>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton style="margin-right: 10px;" RenderStyle="ButtonRenderStyle.Success" Text="Search" Click=@(()=> OnFilterDocuments()) />
        <DxButton style="margin-right: 10px;" RenderStyle="ButtonRenderStyle.Primary" Text="Clear" Click=@(()=> OnClearFilterDocuments()) />
        <DxButton RenderStyle="ButtonRenderStyle.Secondary" Text="Close" Click=@(()=> OnCloseFilterDocuments()) />

    </FooterContentTemplate>
</DxFlyout>

<DxFlyout @bind-IsOpen=IsFileProfileTypeFilterDocOpen
          PositionTarget=@($"#flyout-overview-target-container-IsFilterFileProfileTypeDocumentOpen")
          RestrictionTarget="#Navigation-Flyout-Customization"
          AnimationType="FlyoutAnimationType.Fade"
          HeaderVisible="true"
          HeaderText="Select Sunward Libraries"
          FooterVisible="true"
          FooterCssClass="custom-flyout-footer"
          MinWidth="500" MinHeight="200" MaxWidth="1000px" MaxHeight="800"
          CloseOnOutsideClick="false"
          PreventCloseOnPositionTargetClick="true">
    <BodyContentTemplate Context="PopupContext">
        <DxFormLayout CssClass="w-100" style="height: calc(100vh - 250px);overflow:auto;overflow-x:hidden;">
            <DxFormLayoutItem Caption="">
                <DxTreeView @ref="_treeFilterDocView"
                            @bind-FilterString="FilterDocumentString"
                            ShowFilterPanel="true"
                            FilterMode="NavigationFilterMode.EntireBranch"
                            AllowSelectNodes="true"
                            SelectionChanged="@SelectionChanged"
                            Data="@_selectedTreeItems"
                            LoadChildNodesOnDemand="true">
                    <DataMappings>
                        <DxTreeViewDataMapping Text="FileName"
                                               HasChildren="HasChildren"
                                               Children="Children" />
                    </DataMappings>
                </DxTreeView>
            </DxFormLayoutItem>

        </DxFormLayout>
    </BodyContentTemplate>
    <FooterContentTemplate>
        <div class="w-100">
            <div class="custom-flyout-footer">
                <DxButton CssClass="popup-button" RenderStyle="ButtonRenderStyle.Primary" Text="Close" Click=@(()=> IsFileProfileTypeFilterDocOpen = false) />
            </div>
        </div>
    </FooterContentTemplate>
</DxFlyout>
<DxPopup @bind-Visible="@PopupShareDocuments"
         HeaderText="Share Documents"
         CloseOnOutsideClick="false"
         ShowCloseButton="true"
         ShowFooter="false"
         MinWidth="300" MinHeight="200" MaxWidth="1000px" MaxHeight="800">
    <BodyContentTemplate>
        <ShareDocuments @ref="refShareDocuments" selectedItems="@_selectedItems" applicationUser="@applicationUser" RevokeBack="BackShareDoc"></ShareDocuments>
    </BodyContentTemplate>
</DxPopup>
<DxFlyout @bind-IsOpen=IsFileProfileTypeInfoOpen
          PositionTarget=@($"#flyout-overview-target-container-FileProfileTypeInfoDocuments")
          RestrictionTarget="#Navigation-Flyout-Customization"
          AnimationType="FlyoutAnimationType.Fade"
          PreventCloseOnPositionTargetClick="true"
          HeaderVisible="true"
          HeaderText="Profile Type Info"
          FooterVisible="true"
          CloseOnOutsideClick="false"
          FooterCssClass="custom-flyout-footer"
          MinWidth="500" MinHeight="200" MaxWidth="1000px" MaxHeight="800"
          Position=@(FlyoutPosition.BottomStart | FlyoutPosition.TopStart)>
    <BodyContentTemplate Context="PopupContext">
        <DxFormLayout CssClass="w-100">
            <DxFormLayoutItem Caption="" ColSpanMd="12">
                <div style="height: calc(100vh - 100px);overflow-x: hidden;">@((MarkupString)fileProfileTypeProfileInfo.ProfileTypeInfo)</div>
            </DxFormLayoutItem>
        </DxFormLayout>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton style="margin-right: 10px;" RenderStyle="ButtonRenderStyle.Primary" Text="Close" Click=@(()=> IsFileProfileTypeInfoOpen = false) />
    </FooterContentTemplate>
</DxFlyout>
<DxPopup @bind-Visible="@IsAddFileProfileTypeInfo"
         HeaderText="Profile Type Info"
         CloseOnOutsideClick="false"
         ShowCloseButton="true"
         ShowFooter="false"
         MinWidth="300" MinHeight="200" MaxWidth="1000px" MaxHeight="800">
    <BodyContentTemplate>
        <AddFileProfileTypeInfo selectedItems="@_ParentselectedItems" applicationUser="@applicationUser" RevokeBack="BackShareDoc"></AddFileProfileTypeInfo>
    </BodyContentTemplate>
</DxPopup>
<DxFlyout @bind-IsOpen=IsMoveDocumentsOpen
          PositionTarget=@($"#flyout-overview-target-container-MoveDocuments")
          RestrictionTarget="#Navigation-Flyout-Customization"
          AnimationType="FlyoutAnimationType.Fade"
          HeaderVisible="true"
          HeaderText="Select Sunward Libraries"
          FooterVisible="true"
          FooterCssClass="custom-flyout-footer"
          MinWidth="500" MinHeight="200" MaxWidth="1000px" MaxHeight="800"
          CloseOnOutsideClick="false"
          PreventCloseOnPositionTargetClick="true">
    <BodyContentTemplate Context="PopupContext">
        <DxFormLayout CssClass="w-100" style="height: calc(100vh - 250px);overflow:auto;overflow-x:hidden;">
            <DxFormLayoutItem Caption="">
                <DxTreeView @ref="_treeFilterMoveDocView"
                            @bind-FilterString="FilterMoveDocumentString"
                            ShowFilterPanel="true"
                            FilterMode="NavigationFilterMode.EntireBranch"
                            AllowSelectNodes="true"
                            SelectionChanged="@SelectionMoveChanged"
                            Data="@_selectedTreeItems"
                            LoadChildNodesOnDemand="true">
                    <DataMappings>
                        <DxTreeViewDataMapping Text="FileName"
                                               HasChildren="HasChildren"
                                               Children="Children" />
                    </DataMappings>
                </DxTreeView>
            </DxFormLayoutItem>

        </DxFormLayout>
    </BodyContentTemplate>
    <FooterContentTemplate>
        <div class="w-100">
            <div class="custom-flyout-footer">
                <DxButton CssClass="popup-button" RenderStyle="ButtonRenderStyle.Primary" Text="Close" Click=@(()=> IsMoveDocumentsOpen = false) />
            </div>
        </div>
    </FooterContentTemplate>
</DxFlyout>
<DxPopup @bind-Visible="@MoveDocumentPopup"
         ShowCloseButton="true"
         ShowFooter="true"
         HeaderText="Move Document"
         Closed="EulaPopupMoveDocumentClosed"
         Width="300px">
    <BodyContentTemplate>
        <p>
            Do you want to Move this Document
        </p>
        <span>@((MarkupString)MoveDocumentName)</span>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton style="margin-right: 10px;" RenderStyle="ButtonRenderStyle.Primary" Text="NO" Click="Context.CloseCallback" />
        <DxButton RenderStyle="ButtonRenderStyle.Secondary" Text="Yes" Click="onMoveToFileProfileTypeUpdateInfo" />

    </FooterContentTemplate>
</DxPopup>
<DxPopup @bind-Visible="@MissingUploadFileProfileTypePopup"
         HeaderText="ReUpload Documents"
         CloseOnOutsideClick="false"
         ShowCloseButton="true"
         ShowFooter="false"
         MinWidth="400" MinHeight="200" MaxWidth="1000px" MaxHeight="800">
    <BodyContentTemplate>
        <MissingUploadFileProfileType FolderPathLists="@FolderPathLists" applicationUser="@applicationUser" selectedFiles="@_ParentselectedItems" RevokeBack="BackUpload"></MissingUploadFileProfileType>
    </BodyContentTemplate>
</DxPopup>
@code {
    bool MissingUploadFileProfileTypePopup { get; set; } = false;
    string? MoveDocumentName { get; set; } = string.Empty;
    bool MoveDocumentPopup { get; set; } = false;
    bool isCheckAllEnabled { get; set; } = false;
    bool CheckedAll { get; set; } = false;
    string? isMoveEnabled { get; set; } = "display:none;";
    private UploadDoumentFiles refUploadDoumentFiles;
    private ShareDocuments refShareDocuments;
    private UploadDocumentUpdateFiles refUploadDocumentUpdateFiles;
    IGrid Grid { get; set; }
    [Parameter]
    public Guid? MainSessionId { get; set; }
    //public Guid? SessionId { get; set; }
    public string? searchText { get; set; }
    [Parameter]
    public Guid? DocSessionId { get; set; }
    bool Blukdeletepopup { get; set; } = false;
    bool BlukdeleteDocument { get; set; } = false;
    public string DeleteDocumentName { get; set; }
    bool IsAddFileProfileTypeInfo { get; set; } = false;
    bool IsDescriptionOpen { get; set; } = false;
    bool IsRenameOpen { get; set; } = false;
    bool IsFilterOpen { get; set; } = false; bool IsFileProfileTypeInfoOpen { get; set; } = false; bool IsMoveDocumentsOpen { get; set; } = false;
    public bool PopupUpload { get; set; } = false;
    public bool PopupVisible { get; set; } = false;
    public bool PopupVisibleLinkDocument { get; set; } = false;
    public bool PopupVisibleSecurityAccess { get; set; } = false;
    public bool IsExpiryDateOpen { get; set; } = false;
    public bool loading { get; set; } = false; public bool PopupShareDocuments { get; set; } = false;
    string onShowMain = "";
    string onUploadVisible = "display:none;";
    bool PopupNewUpload { get; set; } = false;
    public DocumentsModel selectedFiles { get; set; }
    public long? FileProfileTypeId { get; set; }
    private List<DocumentsModel> fileProfileTypeDocuments { get; set; }
    public List<DocumentsModel> fileProfileTypeDocumentsAll { get; set; }
    private DocumentTypeModel _fileProfileselectedlstItems { get; set; }
    private OpenAccessUserLink _openAccessUserLink { get; set; }
    bool PanelVisible { get; set; }
    DocumentLinkModel LinkProfileSelectedFiles = new DocumentLinkModel();
    List<DocumentsModel> FolderPathLists = new List<DocumentsModel>();
    List<DocumentsModel> FolderPathListsItems = new List<DocumentsModel>();
    IEnumerable<DocumentsModel> _selectedTreeItems = new List<DocumentsModel>();
    //private DocumentsModel? _selectedTreeItems{get;set;}
    private DocumentsModel? _selectedItems;
    public string? DeleteProfileTypeName { get; set; }
    public long? DeletefileProfileTypeId { get; set; }
    public long? DeleteParentfileProfileTypeId { get; set; }
    public Guid? DeleteParentSessionId { get; set; }
    private DocumentsModel _ParentselectedItems;
    DocumentsModel _selectedDescriptionItems = new DocumentsModel();
    public string? Name;
    public Guid? SelectSessionId { get; set; }
    public string isFilterMore { get; set; } = "";
    public string isVisibleParentMore { get; set; } = "display:none;";
    public string isVisibleMore { get; set; } = "display:none;";
    public bool DownloadEnabled { get; set; } = false;
    public bool EmailEnabled { get; set; } = false;
    public bool uploadEnabled { get; set; } = false;
    public bool copylinkEnabled { get; set; } = false;
    public bool deleteEnabled { get; set; } = false;
    public bool viewfileEnabled { get; set; } = false;
    public bool historyEnabled { get; set; } = false;
    public bool checkoutEnabled { get; set; } = false;
    public bool checkInEnabled { get; set; } = false;
    public bool formdetailsEnabled { get; set; } = false;
    public bool linkdownloadEnabled { get; set; } = false;
    public bool viewParentEnabled { get; set; } = false;
    public bool renameEnabled { get; set; } = false;
    public bool moreEnabled { get; set; } = false;
    public bool shareEnabled { get; set; } = false;
    public bool isCreateDocumentEnabled { get; set; } = false;
    public bool isProfileInfoEnabled { get; set; } = false;
    public bool isCreateDynamicDocumentEnabled { get; set; } = false;
    public bool IsReserveProfileNumberEnabled { get; set; } = false;
    public ApplicationUser applicationUser { get; private set; }
    FileProfileTypeModel fileProfileTypeProfileInfo = new FileProfileTypeModel();
    public bool PopupVisibleLinkParentDocument { get; set; } = false;
    public string? NewRename { get; set; }
    private string? DocumentViewUrl;
    private string? ServerUrl;
    private string? FileUrl;
    public bool? isExpiryDateVisible { get; set; } = false;
    public bool IsFileProfileTypeFilterDocOpen { get; set; }
    private DxTreeView _treeFilterDocView; private DxTreeView _treeFilterMoveDocView;
    string? FilterDocumentString { get; set; }
    string? FilterMoveDocumentString { get; set; }
    string? LinkFilterFileprofiletypeName { get; set; } = null;
    string? LinkFilterFileprofiletypeFileName { get; set; } = null;
    string? LinkFilterFileprofiletypeProfileNo { get; set; } = null;
    long? LinkFilterFileprofiletypeId { get; set; } = null;
    Guid? LinkFilterFileprofiletypeSessionId { get; set; } = null;
    string? LinkFilterFileprofiletypeExtension { get; set; } = null;
    DateTime? LinkFilterFileprofiletypeFrom { get; set; } = null;
    DateTime? LinkFilterFileprofiletypeTo { get; set; } = null;
    DocumentSearchModel documentSearchModel = new DocumentSearchModel();
    public List<DocumentsModel> _fileContentList { get; set; }
    public List<DocumentsModel> _MoveDocList { get; set; } = new List<DocumentsModel>();
    long? MoveFileprofiletypeId { get; set; } = null;
    DocumentPermissionModel documentPermissionModel = new DocumentPermissionModel();
    bool isEdit { get; set; } = false;
    bool IsGrantAdminPermission { get; set; } = false; bool isDelete { get; set; } = false; bool isCreateFolder { get; set; } = false; bool isCreateSubFolder { get; set; } = false;
    bool isEnablePath { get; set; } = false;
    public string? SearchText { get; set; } = null;
    protected override async Task OnInitializedAsync()
    {
        applicationUser = await _localStorageService.GetItem<ApplicationUser>("user");
        DocumentViewUrl = Configuration["DocumentsUrl:DocumentViewer"];
        ServerUrl = Configuration["DocumentsUrl:ServerUrl"];
        FileUrl = Configuration["DocumentsUrl:FileUrl"];
        await loadFileProfileTypeAllDatas();
    }
    async Task loadFileProfileTypeAllDatas()
    {
        PanelVisible = true;
        fileProfileTypeDocumentsAll = await Mediator.Send(new GetAllfileprofiletypeListQuery());
        if (fileProfileTypeDocumentsAll.Count() > 0)
        {
            _selectedTreeItems = _treeGenerateRecursive.TreeGenerateRecursives(fileProfileTypeDocumentsAll);
            PanelVisible = false;
        }
        PanelVisible = false;
        StateHasChanged();
    }
    async Task OnSearchTextChanged(string? newSearchText)
    {
        searchText = newSearchText;
        if (newSearchText != null)
        {
            moreEnabled = false;
            isVisibleMore = "display:none;";
            _selectedItems = null;
            StateHasChanged();
        }
        else
        {
            await mainPageLoad();
        }
    }
    void OnCustomizeFilterMenu(GridCustomizeFilterMenuEventArgs e)
    {
    }
    void FilterCriteriaChanged(GridFilterCriteriaChangedEventArgs args)
    {
        moreEnabled = false;
        isVisibleMore = "display:none;";
        _selectedItems = null;
        StateHasChanged();
    }
    protected override async Task OnParametersSetAsync()
    {
        if (applicationUser != null)
        {
            await mainPageLoad();
            base.OnParametersSet();
        }
    }
    void OnItemClick(MenuItemClickEventArgs e)
    {
        var data = (DocumentsModel)e.ItemInfo.Data;
        if (data.FileProfileTypeId > 0)
        {
            openFileProfileLink(data);
        }
        else
        {
            openFileProfileMainLink();
        }
    }
    async Task mainPageLoad()
    {
        searchText = null; SearchText = null;
        PanelVisible = true; isCheckAllEnabled = false; CheckedAll = false; MoveFileprofiletypeId = null; _MoveDocList = new List<DocumentsModel>(); isMoveEnabled = "display:none;";
        _openAccessUserLink = await Mediator.Send(new GetDMSAccessByUser(applicationUser.UserID));
        IsFileProfileTypeInfoOpen = false;
        isEnablePath = false; isExpiryDateVisible = false; isEdit = false; IsGrantAdminPermission = false; isDelete = false; isCreateFolder = false; isCreateSubFolder = false;
        documentPermissionModel = new DocumentPermissionModel();
        Grid.ClearFilter();
        _fileContentList = await Mediator.Send(new GetFileContetTypes());
        isVisibleMore = "display:none;"; isVisibleParentMore = "display:none;";
        moreEnabled = false; isCreateDocumentEnabled = false; IsReserveProfileNumberEnabled = false; isCreateDynamicDocumentEnabled = false; isProfileInfoEnabled = false;
        DocumentsModel dc = new DocumentsModel();
        dc.FileName = "Main";
        FolderPathLists = new List<DocumentsModel>(); FolderPathListsItems = new List<DocumentsModel>();
        FolderPathListsItems.Add(dc);
        documentSearchModel.SessionId = MainSessionId;
        if (MainSessionId != null)
        {
            isMoveEnabled = "";
            isCheckAllEnabled = true;
        }
        FileProfileTypeId = fileProfileTypeDocumentsAll.FirstOrDefault(f => f.SessionID == MainSessionId)?.FileProfileTypeId;
        if (_openAccessUserLink != null && _openAccessUserLink.IsDmsCreateMainFolder == true && MainSessionId != null)
        {
            isCreateFolder = true;
        }
        if (FileProfileTypeId > 0)
        {
            documentSearchModel.FileProfileTypeId = FileProfileTypeId;
            OnFileProfiltefilter(null);
            var fileType = fileProfileTypeDocumentsAll.Where(w => w.FileProfileTypeId == FileProfileTypeId).FirstOrDefault();
            if (fileType != null)
            {

                _ParentselectedItems = fileType;
                if (fileType != null)
                {
                    isExpiryDateVisible = _ParentselectedItems.IsExpiryDate == null ? false : _ParentselectedItems.IsExpiryDate;
                    Name = fileType?.FileName;
                    FolderPathLists = GetAllFileProfileTypeName(fileProfileTypeDocumentsAll, fileType, FolderPathLists);
                    FolderPathLists.Add(fileType);
                    FolderPathListsItems.AddRange(FolderPathLists);
                }
            }
        }
        await loadFileProfileData();
        PanelVisible = false;
        StateHasChanged();
    }
    async Task loadFileProfileData()
    {
        Grid.ClearFilter(); searchText = null; SearchText = null;
        IsExpiryDateOpen = false; IsDescriptionOpen = false; IsRenameOpen = false; IsFileProfileTypeInfoOpen = false;
        isFilterMore = ""; MoveFileprofiletypeId = null; _MoveDocList = new List<DocumentsModel>(); isMoveEnabled = "display:none;";
        _selectedItems = null;
        if (FileProfileTypeId == null && MainSessionId != null)
        {
            NavigationManager.NavigateTo("fileprofiletype");
        }
        else
        {
            PanelVisible = true;
            _fileProfileselectedlstItems = await Mediator.Send(new GetAllSelectedfileprofiletypeQuery(documentSearchModel));
            fileProfileTypeDocuments = _fileProfileselectedlstItems.DocumentsData;
            if (DocSessionId != null)
            {
                fileProfileTypeDocuments = fileProfileTypeDocuments.Where(w => w.SessionID == DocSessionId).ToList();

            }
            if (fileProfileTypeDocuments.Count > 0)
            {
                if (documentSearchModel.Type == "Search")
                {
                    isEnablePath = true;
                    isFilterMore = "display:none";
                    fileProfileTypeDocuments.ForEach(s =>
                    {
                        var lists = GetFileProfileTypePath(fileProfileTypeDocumentsAll, s.FilterProfileTypeId);
                        s.FullPath = lists.FirstOrDefault()?.FileProfilePath;
                        s.FileProfileTypeMainParentId = lists.FirstOrDefault()?.FileProfileTypeParentId;
                    });
                }
                _selectedItems = fileProfileTypeDocuments.FirstOrDefault();

                await permissionEnabled();
                Grid.SetFocusedRowIndex(0);
            }
            else
            {
                await PermiisionMain();
            }
            PanelVisible = false;
            StateHasChanged();
        }
    }
    async Task PermiisionMain()
    {
        if (_openAccessUserLink != null && _openAccessUserLink.IsDmsAccess == true)
        {
            isVisibleParentMore = "display:none;"; moreEnabled = false;

            if (documentSearchModel.Type != "Search")
            {
                isCreateFolder = false;
                if (MainSessionId == null)
                {
                    isCreateFolder = true;
                }
                isEdit = true; IsGrantAdminPermission = true; isDelete = true; isCreateSubFolder = true;
                isCreateDocumentEnabled = true; IsReserveProfileNumberEnabled = true; moreEnabled = true; isProfileInfoEnabled = true; isMoveEnabled = "display:none;";
                if (_ParentselectedItems != null && _ParentselectedItems.DynamicFormId > 0)
                {
                    isCreateDynamicDocumentEnabled = true; isCreateDocumentEnabled = false;
                }
                if (MainSessionId != null)
                {
                    isVisibleParentMore = ""; isMoveEnabled = "";
                    isCreateFolder = false;
                }
            }
        }
        else
        {
            isVisibleMore = "display:none;"; isVisibleParentMore = "display:none;"; isEdit = false; IsGrantAdminPermission = false; isDelete = false; isCreateFolder = false; isCreateSubFolder = false;
            DownloadEnabled = false; uploadEnabled = false; copylinkEnabled = false; viewfileEnabled = false; EmailEnabled = false;
            deleteEnabled = false; historyEnabled = false; checkoutEnabled = false; checkInEnabled = false; shareEnabled = false;
            formdetailsEnabled = false; linkdownloadEnabled = false;
            if (MainSessionId != null)
            {
                isCreateFolder = false;
            }
            else
            {
                if (_openAccessUserLink != null && _openAccessUserLink.IsDmsCreateMainFolder == true)
                {
                    if (MainSessionId == null)
                    {
                        isCreateFolder = true;
                    }
                    isCreateSubFolder = true; isEdit = true; IsGrantAdminPermission = true; isDelete = true;
                }
            }
            renameEnabled = false; viewParentEnabled = false;
            if (_selectedItems != null)
            {
                var FileProfileTypeIds = _selectedItems.FilterProfileTypeId > 0 ? _selectedItems.FilterProfileTypeId : _selectedItems.FileProfileTypeId;
                var fileTypeData = fileProfileTypeDocumentsAll.Where(w => w.FileProfileTypeId == FileProfileTypeIds).FirstOrDefault();
                if (fileTypeData != null)
                {
                    await permissinSetMainProfile(fileTypeData);
                }
            }
            else
            {
                if (MainSessionId != null)
                {
                    var fileTypeData = fileProfileTypeDocumentsAll.Where(w => w.SessionID == MainSessionId).FirstOrDefault();
                    if (fileTypeData != null && fileTypeData.FileProfileTypeId > 0)
                    {
                        await permissinSetMainProfile(fileTypeData);

                    }
                }
            }
        }
        StateHasChanged();
    }
    async Task permissinSetMainProfile(DocumentsModel fileTypeData)
    {
        if (fileTypeData != null)
        {
            moreEnabled = false; isCreateDocumentEnabled = false; IsReserveProfileNumberEnabled = false; isCreateSubFolder = false; isCreateDynamicDocumentEnabled = false;
            isCreateSubFolder = false; isProfileInfoEnabled = false; isMoveEnabled = "display:none;";
            if (fileTypeData != null)
            {
                var documentPermissionModels = await Mediator.Send(new GetDocumentUserRoleByUserID(fileTypeData.FileProfileTypeId, applicationUser.UserID,null));
                if (documentPermissionModels != null)
                {
                    if (documentPermissionModels.IsPermissionExits == true)
                    {
                        if (MainSessionId != null)
                        {
                            isMoveEnabled = "";
                        }
                        if (documentSearchModel.Type != "Search")
                        {
                            if (MainSessionId != null)
                            {
                                isVisibleParentMore = "";
                            }
                            moreEnabled = true; isCreateDocumentEnabled = true; IsReserveProfileNumberEnabled = true; isProfileInfoEnabled = true;
                            isEdit = true; isDelete = true; isCreateSubFolder = true; IsGrantAdminPermission = true;
                            if (_ParentselectedItems != null && _ParentselectedItems.DynamicFormId > 0)
                            {
                                isCreateDynamicDocumentEnabled = true; isCreateDocumentEnabled = false;
                            }
                        }
                    }
                    else
                    {
                        documentPermissionModel = documentPermissionModels;
                        if (documentPermissionModels.IsCreateDocument == true)
                        {
                            if (documentSearchModel.Type != "Search")
                            {
                                if (MainSessionId != null)
                                {
                                    isVisibleParentMore = "";
                                }
                                moreEnabled = true; isCreateDocumentEnabled = true;
                                if (_ParentselectedItems != null && _ParentselectedItems.DynamicFormId > 0)
                                {
                                    isCreateDynamicDocumentEnabled = true; isCreateDocumentEnabled = false;
                                }
                            }
                        }
                        if (documentPermissionModels.IsMove == true)
                        {
                            isMoveEnabled = "";
                        }
                        if (documentPermissionModels.IsEnableProfileTypeInfo == true)
                        {
                            if (documentSearchModel.Type != "Search")
                            {
                                if (MainSessionId != null)
                                {
                                    isVisibleParentMore = "";
                                }
                                moreEnabled = true; isProfileInfoEnabled = true;
                            }
                        }
                        if (documentPermissionModels.IsReserveProfileNumber == true)
                        {
                            if (documentSearchModel.Type != "Search")
                            {
                                if (MainSessionId != null)
                                {
                                    isVisibleParentMore = "";
                                }
                                moreEnabled = true; IsReserveProfileNumberEnabled = true;
                            }
                        }
                        if (documentPermissionModels.IsEditFolder == true)
                        {
                            if (documentSearchModel.Type != "Search")
                            {
                                isEdit = true;
                            }
                        }
                        if (documentPermissionModels.IsDeleteFolder == true)
                        {
                            if (documentSearchModel.Type != "Search")
                            {
                                isDelete = true;
                            }
                        }
                        if (documentPermissionModels.IsGrantAdminPermission == true)
                        {
                            if (documentSearchModel.Type != "Search")
                            {
                                IsGrantAdminPermission = true;
                            }
                        }
                        if (documentPermissionModels.IsCreateFolder == true)
                        {
                            if (documentSearchModel.Type != "Search")
                            {
                                isCreateSubFolder = true;
                            }
                        }
                    }
                }

            }
        }
        if (_openAccessUserLink != null && _openAccessUserLink.IsDmsCreateMainFolder == true)
        {
            isCreateFolder = false;
            if (MainSessionId == null)
            {
                isCreateFolder = true;
            }
            isCreateSubFolder = true; isEdit = true; IsGrantAdminPermission = true; isDelete = true;
        }
    }
    async Task permissionEnabled()
    {
        await PermiisionMain();
        isVisibleMore = "display:none;";
        if (_openAccessUserLink != null && _openAccessUserLink.IsDmsAccess == true)
        {
            if (_selectedItems != null)
            {
                if (_selectedItems.FilterProfileTypeId > 0)
                {
                    isVisibleMore = "";
                    DownloadEnabled = false; shareEnabled = false;
                    uploadEnabled = false; copylinkEnabled = false; viewfileEnabled = false; deleteEnabled = false; historyEnabled = false; EmailEnabled = false;
                    checkoutEnabled = false; checkInEnabled = false;
                    linkdownloadEnabled = false; formdetailsEnabled = false; renameEnabled = false; viewParentEnabled = false;
                    if (_selectedItems.IsLocked == true)
                    {
                        checkInEnabled = true;
                        uploadEnabled = false; deleteEnabled = false; DownloadEnabled = false; EmailEnabled = false;
                        viewfileEnabled = false; historyEnabled = false; checkoutEnabled = false;
                        copylinkEnabled = false; viewParentEnabled = false; shareEnabled = false;
                        linkdownloadEnabled = false; formdetailsEnabled = false; renameEnabled = false;
                    }
                    else
                    {
                        moreEnabled = true; uploadEnabled = true; DownloadEnabled = true; copylinkEnabled = true; viewfileEnabled = true; deleteEnabled = true; historyEnabled = true;
                        checkoutEnabled = true; checkInEnabled = false; linkdownloadEnabled = true;
                        renameEnabled = true; viewParentEnabled = true; EmailEnabled = true; shareEnabled = true;
                        if (_ParentselectedItems != null && _selectedItems.IsDynamicFromData == true)
                        {
                            formdetailsEnabled = true;
                        }
                    }
                }

            }

        }
        else
        {

            //var permissionData = _selectedItems.DocumentPermissionData;
            if (_selectedItems != null && _selectedItems.FilterProfileTypeId > 0)
            {
                isVisibleMore = "";
                DownloadEnabled = false; shareEnabled = false;
                uploadEnabled = false; copylinkEnabled = false; viewfileEnabled = false; deleteEnabled = false; historyEnabled = false; EmailEnabled = false;
                checkoutEnabled = false; checkInEnabled = false;
                linkdownloadEnabled = false; formdetailsEnabled = false; renameEnabled = false; viewParentEnabled = false;

                if (_selectedItems.IsLocked == true)
                {
                    checkInEnabled = true;
                    uploadEnabled = false; deleteEnabled = false; DownloadEnabled = false; EmailEnabled = false;
                    viewfileEnabled = false; historyEnabled = false; checkoutEnabled = false;
                    copylinkEnabled = false; viewParentEnabled = false; shareEnabled = false;
                    linkdownloadEnabled = false; formdetailsEnabled = false; renameEnabled = false;
                }
                else
                {
                    EmailEnabled = true;
                    var permissionData = await Mediator.Send(new GetDocumentUserRoleByUserID(_selectedItems.FilterProfileTypeId, applicationUser.UserID,null));
                    if (permissionData != null)
                    {
                        if (permissionData.IsPermissionExits == true)
                        {
                            uploadEnabled = true; DownloadEnabled = true; copylinkEnabled = true; viewfileEnabled = true; deleteEnabled = true; historyEnabled = true;
                            checkoutEnabled = true; checkInEnabled = false; linkdownloadEnabled = true;
                            renameEnabled = true; viewParentEnabled = true; EmailEnabled = true; shareEnabled = true;
                            if (_ParentselectedItems != null && _selectedItems.IsDynamicFromData == true)
                            {
                                formdetailsEnabled = true;
                            }
                            if (_selectedItems.IsLocked == true)
                            {
                                checkoutEnabled = false;
                                checkInEnabled = true;
                            }
                        }
                        else
                        {
                            if (permissionData.IsUpdateDocument == true)
                            {
                                checkoutEnabled = true; checkInEnabled = false;
                                linkdownloadEnabled = true; viewParentEnabled = true;
                                if (_ParentselectedItems != null && _selectedItems.IsDynamicFromData == true)
                                {
                                    formdetailsEnabled = true;
                                }
                            }
                            if (permissionData.IsDelete == true)
                            {
                                deleteEnabled = true;
                            }
                            if (permissionData.IsEdit == true)
                            {
                                DownloadEnabled = true;
                            }
                            if (permissionData.IsRead == true)
                            {
                                viewfileEnabled = true;
                            }
                            if (permissionData.IsListVersion == true)
                            {
                                historyEnabled = true;
                            }
                            if (permissionData.IsCopy == true)
                            {
                                copylinkEnabled = true;
                            }
                            if (permissionData.IsRename == true)
                            {
                                renameEnabled = true;
                            }
                            if (permissionData.IsShare == true)
                            {
                                shareEnabled = true;
                            }
                            if (permissionData.IsSendEmail == true)
                            {
                                //EmailEnabled = true;
                            }

                            if (_selectedItems.IsLocked == true)
                            {
                                checkoutEnabled = false;
                                checkInEnabled = true;
                            }
                        }
                    }

                }
            }
        }
        StateHasChanged();
    }
    private List<DocumentsModel>
    GetAllFileProfileTypeName(List<DocumentsModel>
        foldersListItems, DocumentsModel s, List<DocumentsModel>
            foldersModel)
    {
        if (s.ParentId != null)
        {
            var items = foldersListItems.FirstOrDefault(f => f.FileProfileTypeId == s.ParentId);
            GetAllFileProfileTypeName(foldersListItems, items, foldersModel);
            foldersModel.Add(items);
        }
        return foldersModel;
    }

    public void openFileProfileLink(DocumentsModel documentsModel)
    {
        documentSearchModel.SessionId = null;
        documentSearchModel.FileProfileTypeId = null;
        documentSearchModel.Type = null;
        documentSearchModel.SessionIds = null;
        documentSearchModel.FileProfileTypeIds = null;
        LinkFilterFileprofiletypeExtension = null;
        LinkFilterFileprofiletypeFrom = null; LinkFilterFileprofiletypeTo = null;
        LinkFilterFileprofiletypeFileName = null;
        LinkFilterFileprofiletypeProfileNo = null;
        LinkFilterFileprofiletypeId = null;
        LinkFilterFileprofiletypeName = null;
        LinkFilterFileprofiletypeSessionId = null;
        isEnablePath = false;
        onShowMain = "";
        onUploadVisible = "display:none;";
        StateHasChanged();
        NavigationManager.NavigateTo("fileprofiletype/" + documentsModel.SessionID);
    }
    public void openFileProfileMainLink()
    {
        documentSearchModel.SessionId = null;
        documentSearchModel.FileProfileTypeId = null;
        documentSearchModel.Type = null;
        documentSearchModel.SessionIds = null;
        documentSearchModel.FileProfileTypeIds = null;
        LinkFilterFileprofiletypeExtension = null;
        LinkFilterFileprofiletypeFrom = null; LinkFilterFileprofiletypeTo = null;
        LinkFilterFileprofiletypeFileName = null;
        LinkFilterFileprofiletypeProfileNo = null;
        LinkFilterFileprofiletypeId = null;
        LinkFilterFileprofiletypeSessionId = null;
        LinkFilterFileprofiletypeName = null;
        isEnablePath = false;
        onShowMain = "";
        onUploadVisible = "display:none;";
        StateHasChanged();
        NavigationManager.NavigateTo("fileprofiletype");
    }
    void onCopyLink()
    {

    }
    void onReserveNumberSeries()
    {

    }
    async Task OnRowClick(GridRowClickEventArgs e)
    {

        var UniqueId = e.Grid.GetRowValue(e.VisibleIndex, "UniqueNo");
        _selectedItems = fileProfileTypeDocuments.FirstOrDefault(f => f.UniqueNo == (long?)UniqueId);

        if (_selectedItems != null)
        {
            await permissionEnabled();
        }
        IsFileProfileTypeInfoOpen = false;
        StateHasChanged();
    }
    async Task OnRowDoubleClick(GridRowClickEventArgs e)
    {
        IsFileProfileTypeInfoOpen = false;
        if (_selectedItems != null && _selectedItems.FileProfileTypeId > 0)
        {
            documentSearchModel.SessionId = null;
            documentSearchModel.FileProfileTypeId = null;
            documentSearchModel.Type = null;
            documentSearchModel.SessionIds = null;
            documentSearchModel.FileProfileTypeIds = null;
            isEnablePath = false;
            NavigationManager.NavigateTo($"fileprofiletype/" + _selectedItems.SessionID);

        }
        else
        {
            await OnRowClick(e);
        }
    }
    void Grid_CustomizeCellDisplayText(GridCustomizeCellDisplayTextEventArgs e)
    {
        if (e.FieldName == "FileSizes")
        {
            var dataItems = (DocumentsModel)e.DataItem;
            if (dataItems.FileProfileTypeId > 0)
            {
                // var resp = await Mediator.Send(new GetAllSelectedFileCountQuery(dataItems.FileProfileTypeId.Value));
                //e.DisplayText = "Test";
            }
        }
    }
    void Grid_CustomizeSummaryDisplayText(GridCustomizeSummaryDisplayTextEventArgs e)
    {
        if (e.Item.Name == "Custom")
            e.DisplayText = string.Format("Sum of Selected: {0:c}", e.Value);
    }
    void Grid_CustomizeElement(GridCustomizeElementEventArgs e)
    {
        if (e.ElementType == GridElementType.DataRow && e.VisibleIndex % 2 == 1)
        {
            e.CssClass = "alt-item";
        }
        //if (e.ElementType == GridElementType.DataCell)
        //{
        //    var dataColumn = (IGridDataColumn)e.Column;
        //    switch (dataColumn.FieldName)
        //    {
        //        case "FileSizes":
        //            var FileProfileTypeIds = e.Grid.GetRowValue(e.VisibleIndex, "FileProfileTypeId");
        //            break;
        //    }
        //}
        //if (e.ElementType == GridElementType.HeaderCell)
        //{
        //    e.Style = "background-color: rgba(0, 0, 0, 0.08)";
        //    e.CssClass = "header-bold";
        //}
    }
    void onAddFileProfileType()
    {
        NavigationManager.NavigateTo($"fileprofiletype/AddFileProfileTypes/Add/");
    }
    void onAddSubFileProfileType()
    {
        if (MainSessionId == null)
        {
            NavigationManager.NavigateTo($"fileprofiletype/AddFileProfileTypes/Add/" + _selectedItems.SessionID);
        }
        else
        {
            if (_selectedItems != null)
            {
                NavigationManager.NavigateTo($"fileprofiletype/AddFileProfileTypes/Add/" + _selectedItems.FileProfileTypeSessionId);
            }
            else
            {
                NavigationManager.NavigateTo($"fileprofiletype/AddFileProfileTypes/Add/" + MainSessionId);
            }
        }

    }
    void onEditFileProfileType()
    {
        SelectSessionId = null;
        if (MainSessionId == null)
        {
            if (_selectedItems != null)
            {
                SelectSessionId = _selectedItems.SessionID;
            }
        }
        else
        {
            if (_selectedItems != null)
            {
                if (_selectedItems.FileProfileTypeId == null)
                {
                    SelectSessionId = fileProfileTypeDocumentsAll.FirstOrDefault(f => f.FileProfileTypeId == _selectedItems.FilterProfileTypeId)?.SessionID;
                }
                else
                {
                    SelectSessionId = _selectedItems.SessionID;
                }
            }
            else
            {
                SelectSessionId = MainSessionId;
            }
        }
        NavigationManager.NavigateTo($"fileprofiletype/AddFileProfileTypes/Edit/" + SelectSessionId);

    }
    void onBack()
    {
        openFileProfileMainLink();
    }
    private async Task onCopy()
    {

        if (_selectedItems != null && _selectedItems.DocumentID > 0 && _selectedItems.FilePath != null)
        {
            if (_selectedItems.IsNewPath == true)
            {
                // var url = DocumentViewUrl + "?url=" + FileUrl + _selectedItems.FilePath;
                var url = DocumentViewUrl + "?url=" + _selectedItems.UniqueSessionId;
                await ClipboardService.WriteTextAsync(url);
                toastService.ShowToast("Copied", AC.SD.Core.Services.ToastLevel.Info);
            }
            else
            {
                //var url = DocumentViewUrl + "?url=" + ServerUrl + _selectedItems.FilePath;
                var url = DocumentViewUrl + "?url=" + _selectedItems.UniqueSessionId;
                await ClipboardService.WriteTextAsync(url);
                toastService.ShowToast("Copied", AC.SD.Core.Services.ToastLevel.Info);
            }
        }
    }
    private void LoadFiles(InputFileChangeEventArgs e)
    {

    }
    void OnSecurity()
    {
        PopupVisibleSecurityAccess = true;
    }
    void onDownload()
    {

    }
    void onmore()
    {

    }
    void onInfo()
    {

    }
    async Task Download()
    {
        if (_selectedItems != null && _selectedItems.DocumentID > 0 && _selectedItems.FilePath != null)
        {
            var response = await Mediator.Send(new GetFileDownload(_selectedItems.DocumentID));
            if (response.StatusCodeID == 0)
            {
                toastService.ShowToast("File Not Exits", AC.SD.Core.Services.ToastLevel.Error);
            }
            else
            {
                //  Trigger file download
                await jsRuntime.InvokeVoidAsync("downloadFile", _selectedItems.OriginalFileName, response.ImageData, "");
            }
        }
    }
    async Task CloseUploadPopup()
    {
        PopupUpload = false;
        await loadFileProfileData();
    }
    async Task onUploadFileProfileType()
    {
        PopupNewUpload = true;
        //await refUploadDoumentFiles.loadData(_ParentselectedItems, applicationUser);
        // onShowMain = "display:none;";
        //  onUploadVisible = "";
        StateHasChanged();
    }
    void onUpload()
    {
        PopupUpload = true;
    }
    async void onView()
    {
        if (_selectedItems != null && _selectedItems.DocumentID > 0 && _selectedItems.FilePath != null)
        {
            if (_selectedItems.IsNewPath == true)
            {
                // var url = DocumentViewUrl + "?url=" + FileUrl + _selectedItems.FilePath;
                var url = DocumentViewUrl + "?url=" + _selectedItems.UniqueSessionId;
                await OpenDocumentPreview(url);
            }
            else
            {
                //var url = DocumentViewUrl + "?url=" + ServerUrl + _selectedItems.FilePath;
                var url = DocumentViewUrl + "?url=" + _selectedItems.UniqueSessionId;
                await OpenDocumentPreview(url);
            }

        }
    }
    private async Task OpenDocumentPreview(string url)
    {
        await jsRuntime.InvokeVoidAsync("window.open", url, "_blank");
    }
    async Task onDelete()
    {
        if (_selectedItems != null && _selectedItems.DocumentID > 0)
        {
            BlukdeleteDocument = false;
            await Mediator.Send(new GetFileProfileTypeDocumentDelete(_selectedItems));
            toastService.ShowToast("Record Deleted Successfully", AC.SD.Core.Services.ToastLevel.Success);
            await loadFileProfileData();
        }
    }
    void onHistory()
    {
        if (_selectedItems != null && _selectedItems.DocumentID > 0)
        {
            selectedFiles = _selectedItems;
            PopupVisible = true;
        }

    }
    async Task onCheckOut()
    {
        if (_selectedItems != null && _selectedItems.DocumentID > 0)
        {

            await Mediator.Send(new GetFileProfileTypeCheckOut(_selectedItems));
            //await loadFileProfileData();
            _selectedItems.IsLocked = true;
            _selectedItems.LockedByUserId = applicationUser.UserID;
            _selectedItems.LockedByUser = applicationUser.UserName;
            await permissionEnabled();
            await Download();
        }
    }
    void onCheckin()
    {
        PopupUpload = true;
    }
    void onLinkDocuments()
    {
        if (_selectedItems != null && _selectedItems.DocumentID > 0)
        {
            selectedFiles = _selectedItems;
            PopupVisibleLinkDocument = true;
        }
    }

    void onFormDetails()
    {
        if (_selectedItems != null && _selectedItems.DynamicFormSessionId != null)
        {
            NavigationManager.NavigateTo($"fileprofiletype/uploadDynamicForm/" + MainSessionId + "/" + _selectedItems.DynamicFormSessionId + "/" + _selectedItems.SessionID);
        }
    }
    void CloseLinkParentDocumentPopup()
    {
        PopupVisibleLinkParentDocument = false;
    }
    async Task onFileProfileTypeEmail()
    {

        var itemlst = await Mediator.Send(new GetActivityEmailList(_selectedItems.SessionID.Value));
        if (itemlst.Count > 0)
        {
            if (itemlst[0].EmailTopicSessionId != null)
            {
                var plist = await Mediator.Send(new GetParticipantbysessionidList(itemlst[0].EmailTopicSessionId.Value));
                var checkusers = plist.Where(t => t.UserId == applicationUser.UserID).ToList();
                if (checkusers.Count > 0)
                {
                    NavigationManager.NavigateTo("ViewEmail/" + itemlst[0].EmailTopicSessionId + "/Email");
                }
                else
                {
                    toastService.ShowToast("Already created email current user permission denied, please contact admin", AC.SD.Core.Services.ToastLevel.Warning);
                }
            }
            else
            {
                onCreateorUpdateFileProfileTypeEmail();
            }
        }
        else
        {
            onCreateorUpdateFileProfileTypeEmail();
        }



    }
    async Task onCreateorUpdateFileProfileTypeEmail()
    {
        var lst = FolderPathLists;
        string groupTag = "";
        long grouptTagId = 0;
        long catTagId = 0;

        List<string> tagStringList = new List<string>();

        for (var j = 0; j < FolderPathLists.Count; j++)
        {
            var ckl = FolderPathLists[j].FileName;

            if (j == 0)
            {
                groupTag = ckl; // Assign the first element to groupTag
            }
            else
            {
                tagStringList.Add(ckl); // Add other elements to tagStringList
            }
        }

        string tagString = string.Join("_", tagStringList);

        if (string.IsNullOrEmpty(tagString))
        {
            tagString = groupTag;
        }

        var tagItems = await Mediator.Send(new GetAllApplicationMasterChildListQuery("122"));

        var cktagItem = tagItems.Where(x => x.Value == groupTag).ToList();
        if (cktagItem.Count > 0)
        {
            grouptTagId = cktagItem[0].ApplicationMasterChildId;
        }
        else
        {
            var request = new CreateApplicationMasterChildCommand
                {
                    ApplicationMasterParentId = 122,
                    ParentId = null,
                    Description = groupTag,
                    Value = groupTag,
                    AddedByUserId = applicationUser.UserID,
                    ModifiedByUserId = applicationUser.UserID,
                    AddedDate = DateTime.Now,
                    ModifiedDate = DateTime.Now,
                    StatusCodeId = 1,
                    SessionId = Guid.NewGuid(),
                };
            var rlt = await Mediator.Send(request);
            grouptTagId = rlt.ApplicationMasterChildId;
        }

        if (!string.IsNullOrEmpty(tagString))
        {
            var catItems = await Mediator.Send(new GetAllApplicationMasterChildByIdQuery(grouptTagId));

            var ckcatItem = catItems.Where(x => x.Value == tagString).ToList();
            if (ckcatItem.Count > 0)
            {
                catTagId = ckcatItem[0].ApplicationMasterChildId;
            }
            else
            {
                var request = new CreateApplicationMasterChildCommand
                    {
                        ApplicationMasterParentId = 123,
                        ParentId = grouptTagId,
                        Description = tagString,
                        Value = tagString,
                        AddedByUserId = applicationUser.UserID,
                        ModifiedByUserId = applicationUser.UserID,
                        AddedDate = DateTime.Now,
                        ModifiedDate = DateTime.Now,
                        StatusCodeId = 1,
                        SessionId = Guid.NewGuid(),
                    };
                var rlt = await Mediator.Send(request);
                catTagId = rlt.ApplicationMasterChildId;

                await createApplicationMasterChild(124, catTagId, "Review");
                await createApplicationMasterChild(124, catTagId, "Discussion");
            }
        }

        var items = await Mediator.Send(new GetActivityEmailList(_selectedItems.SessionID.Value));

        if (items.Count == 0)
        {
            var sessionId = _selectedItems.SessionID;
            string filePath = _selectedItems.FileName;
            string subjectName = Path.GetFileNameWithoutExtension(filePath);

            var createReq = new CreateActivityEmail
                {
                    SubjectName = subjectName,
                    Comment = _selectedItems.Description,
                    ActivityType = "FileProfileType",
                    SessionId = _selectedItems.SessionID,
                    BackURL = MainSessionId.ToString(),
                    DocumentSessionId = _selectedItems.SessionID,
                    AddedByUserID = applicationUser.UserID,
                    AddedDate = DateTime.Now,
                    ManufacturingProcessId = grouptTagId,
                    CategoryActionId = catTagId

                };

            var result = await Mediator.Send(createReq);
        }

        var itemlst = await Mediator.Send(new GetActivityEmailList(_selectedItems.SessionID.Value));

        if (itemlst[0].IsDraft.GetValueOrDefault(false))
        {
            var plist = await Mediator.Send(new GetParticipantbysessionidList(itemlst[0].EmailTopicSessionId.Value));
            var checkusers = plist.Where(t => t.UserId == applicationUser.UserID).ToList();
            if (checkusers.Count > 0)
            {
                NavigationManager.NavigateTo("EmailDrafts");
            }
            else
            {
                toastService.ShowToast("Already created email current user permission denied, please contact admin", AC.SD.Core.Services.ToastLevel.Warning);
            }

        }
        else if (itemlst[0].EmailTopicSessionId == null)
        {
            var sessionId = _selectedItems.SessionID;
            string filePath = _selectedItems.FileName;
            string subjectName = Path.GetFileNameWithoutExtension(filePath);

            var createReq = new UpdateActivityEmail
                {
                    SubjectName = subjectName,
                    Comment = _selectedItems.Description,
                    ActivityType = "FileProfileType",
                    SessionId = _selectedItems.SessionID,
                    BackURL = MainSessionId.ToString(),
                    DocumentSessionId = _selectedItems.SessionID,
                    AddedByUserID = applicationUser.UserID,
                    AddedDate = DateTime.Now,
                    ManufacturingProcessId = grouptTagId,
                    CategoryActionId = catTagId,
                    ActivityEmailTopicID = itemlst[0].ActivityEmailTopicID

                };

            var result = await Mediator.Send(createReq);



            NavigationManager.NavigateTo("CreateEmail/" + _selectedItems.SessionID + "");
        }
        else
        {
            var plist = await Mediator.Send(new GetParticipantbysessionidList(itemlst[0].EmailTopicSessionId.Value));
            var checkusers = plist.Where(t => t.UserId == applicationUser.UserID).ToList();
            if (checkusers.Count > 0)
            {
                NavigationManager.NavigateTo("ViewEmail/" + itemlst[0].EmailTopicSessionId + "/Email");
            }
            else
            {
                toastService.ShowToast("Already created email current user permission denied, please contact admin", AC.SD.Core.Services.ToastLevel.Warning);
            }

        }
    }
    async Task createApplicationMasterChild(long MasterParentId, long ParentId, string notes)
    {

        var request = new CreateApplicationMasterChildCommand
            {
                ApplicationMasterParentId = MasterParentId,
                ParentId = ParentId,
                Description = notes,
                Value = notes,
                AddedByUserId = applicationUser.UserID,
                ModifiedByUserId = applicationUser.UserID,
                AddedDate = DateTime.Now,
                ModifiedDate = DateTime.Now,
                StatusCodeId = 1,
                SessionId = Guid.NewGuid(),
            };
        await Mediator.Send(request);
    }
    void onViewparentDocuments()
    {
        LinkProfileSelectedFiles.DocumentLinkId = 0;
        LinkProfileSelectedFiles.LinkDocumentId = _selectedItems.DocumentID;
        LinkProfileSelectedFiles.DocumentID = _selectedItems.DocumentID;
        PopupVisibleLinkParentDocument = true;
    }
    void onRename()
    {
        OnButtonRenameDescriptionClick();
    }
    void ClosePopup()
    {
        PopupVisible = false;
    }
    async Task CloseLinkDocumentPopup()
    {
        await loadFileProfileData();
        PopupVisibleLinkDocument = false;
    }
    void OnButtonDescriptionClick(DocumentsModel items)
    {
        IsDescriptionOpen = true; IsExpiryDateOpen = false; IsRenameOpen = false; IsFileProfileTypeFilterDocOpen = false;
        _selectedDescriptionItems = new DocumentsModel();
        _selectedDescriptionItems.FilterProfileTypeId = items.FilterProfileTypeId;
        _selectedDescriptionItems.DocumentID = items.DocumentID;
        _selectedDescriptionItems.Description = items.Description;
        _selectedDescriptionItems.Type = items.Type;
        _selectedDescriptionItems.ModifiedDate = DateTime.Now;
        _selectedDescriptionItems.ModifiedByUserID = applicationUser.UserID;
    }
    async Task OnUpdateDescription()
    {
        await Mediator.Send(new GetUpdateDescriptionField(_selectedDescriptionItems));
        await loadFileProfileData();
        toastService.ShowToast("Record Updated Successfully", AC.SD.Core.Services.ToastLevel.Success);
        IsDescriptionOpen = false; IsFileProfileTypeInfoOpen = false;
    }
    void OnButtonExpiryDateClick(DocumentsModel items)
    {
        IsExpiryDateOpen = true; IsDescriptionOpen = false; IsRenameOpen = false; IsFileProfileTypeFilterDocOpen = false;
        _selectedDescriptionItems = new DocumentsModel();
        _selectedDescriptionItems.FilterProfileTypeId = items.FilterProfileTypeId;
        _selectedDescriptionItems.DocumentID = items.DocumentID;
        _selectedDescriptionItems.ExpiryDate = items.ExpiryDate;
        _selectedDescriptionItems.Type = items.Type;
        _selectedDescriptionItems.ModifiedDate = DateTime.Now;
        _selectedDescriptionItems.ModifiedByUserID = applicationUser.UserID;
    }
    void OnButtonRenameDescriptionClick()
    {
        IsRenameOpen = true; IsExpiryDateOpen = false; IsDescriptionOpen = false; IsFileProfileTypeFilterDocOpen = false;
        _selectedDescriptionItems = new DocumentsModel();
        _selectedDescriptionItems = _selectedItems;
        if (!string.IsNullOrEmpty(_selectedDescriptionItems.OriginalFileName))
        {
            NewRename = _selectedDescriptionItems.OriginalFileName.Remove(_selectedDescriptionItems.OriginalFileName.LastIndexOf("."));
        }
    }
    async Task OnUpdateExpiryDate()
    {
        await Mediator.Send(new GetUpdateExpiryDateField(_selectedDescriptionItems));
        await loadFileProfileData();
        toastService.ShowToast("Record Updated Successfully", AC.SD.Core.Services.ToastLevel.Success);
        IsExpiryDateOpen = false; IsFileProfileTypeFilterDocOpen = false;
    }
    async Task OnUpdateDocumentRename()
    {
        var NewName = NewRename != null ? NewRename.Trim() : "";
        if (!string.IsNullOrEmpty(NewName))
        {
            _selectedDescriptionItems.FileName = NewRename + "." + _selectedDescriptionItems.Extension;
            await Mediator.Send(new GetUpdateDocumentRename(_selectedDescriptionItems));
            await loadFileProfileData();
            toastService.ShowToast("Record Updated Successfully", AC.SD.Core.Services.ToastLevel.Success);
            IsRenameOpen = false; IsFileProfileTypeFilterDocOpen = false;
        }
    }
    void CloseSecurityAccessPopup()
    {
        PopupVisibleSecurityAccess = false;
    }
    void BackShareDoc()
    {
        InvokeAsync(loadFileProfileData);
        IsAddFileProfileTypeInfo = false;
        PopupShareDocuments = false;
        StateHasChanged();
    }
    async void BackUpload()
    {
        MissingUploadFileProfileTypePopup = false;
        PopupNewUpload = false;
        onShowMain = "";
        onUploadVisible = "display:none;";
        PopupUpload = false;
        await loadFileProfileData();
        StateHasChanged();

    }
    void onReserveProfileNumberSeries()
    {
        NavigationManager.NavigateTo("fileprofiletype/reserveProfileNumberSeries/" + MainSessionId);
    }
    void EulaPopupClosed(PopupClosedEventArgs args)
    {
        Blukdeletepopup = false;
    }
    void EulaPopupDocumentClosed(PopupClosedEventArgs args)
    {
        BlukdeleteDocument = false;
    }
    void onDeleteDocument()
    {
        DeleteDocumentName = _selectedItems.FileName;
        BlukdeleteDocument = true;
    }
    async Task deleteFileProfileTypes()
    {
        if (DeletefileProfileTypeId > 0)
        {
            var response = await Mediator.Send(new DeleteFileProfileType(DeletefileProfileTypeId));
            if (response > 0)
            {
                Blukdeletepopup = false;
                toastService.ShowToast("Record Deleted Successfully", AC.SD.Core.Services.ToastLevel.Success);
                if (MainSessionId == DeleteParentSessionId)
                {
                    await loadFileProfileData();
                }
                else
                {
                    if (DeleteParentfileProfileTypeId > 0)
                    {
                        NavigationManager.NavigateTo($"fileprofiletype/" + DeleteParentSessionId);
                    }
                    else
                    {
                        NavigationManager.NavigateTo($"fileprofiletype/");
                    }
                }

            }
        }
    }
    void onDeleteFileProfileType()
    {
        DeleteParentSessionId = null;
        if (MainSessionId == null)
        {
            if (_selectedItems != null)
            {
                DeletefileProfileTypeId = _selectedItems.DocumentID;
                DeleteProfileTypeName = fileProfileTypeDocumentsAll.FirstOrDefault(f => f.DocumentID == _selectedItems.DocumentID)?.FileName;
                DeleteParentfileProfileTypeId = 0;
            }
        }
        else
        {
            if (_selectedItems != null)
            {
                if (_selectedItems.FileProfileTypeId == null)
                {
                    DeletefileProfileTypeId = _selectedItems.FilterProfileTypeId;
                    DeleteProfileTypeName = fileProfileTypeDocumentsAll.FirstOrDefault(f => f.FileProfileTypeId == _selectedItems.FilterProfileTypeId)?.FileName;
                    DeleteParentfileProfileTypeId = fileProfileTypeDocumentsAll.FirstOrDefault(f => f.FileProfileTypeId == _selectedItems.FilterProfileTypeId)?.ParentId;
                    DeleteParentSessionId = fileProfileTypeDocumentsAll.FirstOrDefault(f => f.FileProfileTypeId == DeleteParentfileProfileTypeId)?.SessionID;
                }
                else
                {
                    DeletefileProfileTypeId = _selectedItems.FileProfileTypeId;
                    DeleteProfileTypeName = _selectedItems.FileName;
                    DeleteParentfileProfileTypeId = fileProfileTypeDocumentsAll.FirstOrDefault(f => f.FileProfileTypeId == DeletefileProfileTypeId)?.ParentId;
                    DeleteParentSessionId = fileProfileTypeDocumentsAll.FirstOrDefault(f => f.FileProfileTypeId == DeleteParentfileProfileTypeId)?.SessionID;
                }
            }
            else
            {
                DeletefileProfileTypeId = fileProfileTypeDocumentsAll.FirstOrDefault(f => f.SessionID == MainSessionId)?.FileProfileTypeId;
                DeleteProfileTypeName = fileProfileTypeDocumentsAll.FirstOrDefault(f => f.SessionID == MainSessionId)?.FileName;
                DeleteParentfileProfileTypeId = fileProfileTypeDocumentsAll.FirstOrDefault(f => f.FileProfileTypeId == DeletefileProfileTypeId)?.ParentId;
                DeleteParentSessionId = fileProfileTypeDocumentsAll.FirstOrDefault(f => f.FileProfileTypeId == DeleteParentfileProfileTypeId)?.SessionID;
            }
        }
        Blukdeletepopup = true;
        StateHasChanged();
    }
    void OnFileProfiltefilter(string? type)
    {
        if (FileProfileTypeId > 0)
        {
            var lists = GetFileProfileTypePath(fileProfileTypeDocumentsAll, FileProfileTypeId);
            LinkFilterFileprofiletypeName = lists.FirstOrDefault()?.FileProfilePath;
            LinkFilterFileprofiletypeId = FileProfileTypeId;
            LinkFilterFileprofiletypeSessionId = MainSessionId;
        }
        if (type == "Open")
        {
            IsFilterOpen = true;
        }
    }

    async Task OnFileProfileTypeInfo()
    {
        IsFileProfileTypeInfoOpen = true; IsFileProfileTypeFilterDocOpen = false;
        fileProfileTypeProfileInfo = await Mediator.Send(new GetFileProfileTypeBySession(_ParentselectedItems.SessionID));

    }
    void onAddFileProfileTypeInfo()
    {
        IsAddFileProfileTypeInfo = true;
    }
    async void OnClearFilterDocuments()
    {
        MoveFileprofiletypeId = null; _MoveDocList = new List<DocumentsModel>();
        documentSearchModel.Type = null;
        LinkFilterFileprofiletypeName = null;
        documentSearchModel.Extension = null;
        documentSearchModel.FileName = string.Empty;
        documentSearchModel.SessionIds = null;
        documentSearchModel.FileProfileTypeIds = null;
        documentSearchModel.FileProfileTypeId = null;
        documentSearchModel.SessionId = null;
        LinkFilterFileprofiletypeFileName = null;
        LinkFilterFileprofiletypeProfileNo = null;
        LinkFilterFileprofiletypeExtension = null;
        LinkFilterFileprofiletypeFrom = null; LinkFilterFileprofiletypeTo = null;
        isFilterMore = "";
        isEnablePath = false;
        IsFilterOpen = false;
        await mainPageLoad();
    }
    void OnCloseFilterDocuments()
    {
        IsFilterOpen = false;
    }
    async void OnFilterDocuments()
    {
        // if (LinkFilterFileprofiletypeId == null || string.IsNullOrEmpty(LinkFilterFileprofiletypeFileName) || string.IsNullOrEmpty(LinkFilterFileprofiletypeExtension) || string.IsNullOrEmpty(LinkFilterFileprofiletypeProfileNo))
        //  {
        // if (LinkFilterFileprofiletypeId > 0 && !string.IsNullOrEmpty(LinkFilterFileprofiletypeFileName) && !string.IsNullOrEmpty(LinkFilterFileprofiletypeExtension) && !string.IsNullOrEmpty(LinkFilterFileprofiletypeProfileNo))
        //{
        // NavigationManager.NavigateTo($"fileprofiletype/" + LinkFilterFileprofiletypeSessionId);
        //  }
        // else
        // {
        var childLists = GetChild(LinkFilterFileprofiletypeId);
        documentSearchModel.FileProfileTypeId = LinkFilterFileprofiletypeId;
        documentSearchModel.SessionId = LinkFilterFileprofiletypeSessionId;
        documentSearchModel.FileProfileTypeIds = childLists.Select(s => s.FileProfileTypeId).ToList();
        documentSearchModel.SessionIds = childLists.Select(s => s.SessionID).ToList();
        documentSearchModel.Extension = LinkFilterFileprofiletypeExtension;
        documentSearchModel.FileName = LinkFilterFileprofiletypeFileName;
        documentSearchModel.ProfileNo = LinkFilterFileprofiletypeProfileNo;
        documentSearchModel.FromDate = LinkFilterFileprofiletypeFrom;
        documentSearchModel.ToDate = LinkFilterFileprofiletypeTo;
        documentSearchModel.Type = "Search";
        await loadFileProfileData();
        // }
        //}
    }
    void OnButtonFileProfileTypeLinDocClick()
    {
        IsFileProfileTypeFilterDocOpen = true; IsFileProfileTypeInfoOpen = false;
    }
    protected void SelectionChanged(TreeViewNodeEventArgs e)
    {
        if (e.NodeInfo?.DataItem != null)
        {
            var nodeName = e.NodeInfo.DataItem as DocumentsModel;
            var lists = GetFileProfileTypePath(fileProfileTypeDocumentsAll, nodeName.FileProfileTypeId);
            LinkFilterFileprofiletypeName = lists.FirstOrDefault()?.FileProfilePath;
            LinkFilterFileprofiletypeId = nodeName.FileProfileTypeId;
            LinkFilterFileprofiletypeSessionId = nodeName.SessionID;
        }
        IsFileProfileTypeFilterDocOpen = false;
        StateHasChanged();
    }
    public IEnumerable<DocumentsModel>
        GetChild(long? id)
    {
        var locations = fileProfileTypeDocumentsAll.Where(x => x.ParentId == id || x.FileProfileTypeId == id).ToList();

        var child = locations.AsEnumerable().Union(fileProfileTypeDocumentsAll.AsEnumerable().Where(x => x.ParentId == id).SelectMany(y => GetChild(y.FileProfileTypeId))).ToList();
        return child;
    }
    private List<FileProfileTypeModel>
        GetFileProfileTypePath(List<DocumentsModel>
            foldersListItem, long? id)
    {
        var foldersListItems = foldersListItem.Where(t => t.FileProfileTypeId == id).ToList();
        FileProfileTypeModel fileprofile = new FileProfileTypeModel();
        List<FileProfileTypeModel>
            foldersList = new List<FileProfileTypeModel>
                ();
        if (foldersListItems != null && foldersListItems.Count > 0)
        {
            foldersListItems.ForEach(s =>
            {
                List<string>
                                    FolderPathLists = new List<string>
                                        ();
                FileProfileTypeModel fileProfileTypeModel = new FileProfileTypeModel();
                fileProfileTypeModel.FileProfileTypeId = s.FileProfileTypeId.Value;
                fileProfileTypeModel.Name = s.FileName;
                fileprofile = GetProfileTypeName(foldersListItem, s, FolderPathLists, fileprofile);
                FolderPathLists.Add(s.FileName);
                fileProfileTypeModel.FileProfileTypeParentId = fileprofile.ParentId;
                fileProfileTypeModel.FileProfilePath = string.Join(" / ", FolderPathLists);
                foldersList.Add(fileProfileTypeModel);
            });
        }
        return foldersList;
    }
    private FileProfileTypeModel GetProfileTypeName(List<DocumentsModel>
        foldersListItems, DocumentsModel s, List<string>
            foldersModel, FileProfileTypeModel fileProfileTypeModel)
    {

        if (s.ParentId != null)
        {
            var items = foldersListItems.FirstOrDefault(f => f.FileProfileTypeId == s.ParentId);
            GetProfileTypeName(foldersListItems, items, foldersModel, fileProfileTypeModel);
            foldersModel.Add(items.FileName);
        }
        else if (s.ParentId == null)
        {
            fileProfileTypeModel.ParentId = foldersListItems.FirstOrDefault(f => f.FileProfileTypeId == s.FileProfileTypeId)?.FileProfileTypeId;
        }
        return fileProfileTypeModel;
    }
    async Task openFileProfileOpenPathLink(DocumentsModel documentModel)
    {
        var url = NavigationManager.BaseUri.ToString() + "fileprofiletype/" + documentModel.FileProfileTypeSessionId + "/" + documentModel.SessionID;
        await jsRuntime.InvokeVoidAsync("window.open", url, "_blank");
    }
    void onShare()
    {
        PopupShareDocuments = true;
    }
    void onUploadDynamicForm()
    {
        if (_selectedItems != null && _selectedItems.DynamicFormSessionId != null)
        {
            NavigationManager.NavigateTo($"fileprofiletype/uploadDynamicForm/" + MainSessionId + "/" + _selectedItems.DynamicFormSessionId);
        }
    }
    void OnCheckedAllValueChanged(bool radioValue)
    {
        CheckedAll = radioValue;
        if (fileProfileTypeDocuments != null && fileProfileTypeDocuments.Count() > 0)
        {
            fileProfileTypeDocuments.ForEach(s =>
            {
                // if (s.FilterProfileTypeId > 0)
                // {
                s.Checked = radioValue;
                // }
            });
        }
    }
    void OnFileProfilteMoveDocuments()
    {
        _MoveDocList = new List<DocumentsModel>();
        if (fileProfileTypeDocuments != null && fileProfileTypeDocuments.Count() > 0)
        {
            _MoveDocList = fileProfileTypeDocuments.Where(w => w.Checked == true).Select(s => new DocumentsModel { SessionID = s.SessionID, DocumentID = s.DocumentID, FilterProfileTypeId = s.FilterProfileTypeId }).ToList();
            if (_MoveDocList.Count() > 0)
            {
                IsMoveDocumentsOpen = true;
            }
            else
            {
                toastService.ShowToast("Must Select Document", AC.SD.Core.Services.ToastLevel.Error);
            }
        }

    }
    protected void SelectionMoveChanged(TreeViewNodeEventArgs e)
    {
        MoveFileprofiletypeId = null;
        if (e.NodeInfo?.DataItem != null)
        {
            var nodeName = e.NodeInfo.DataItem as DocumentsModel;
            if (nodeName != null)
            {
                var fileType = fileProfileTypeDocumentsAll.Where(w => w.SessionID == MainSessionId).FirstOrDefault();
                MoveFileprofiletypeId = nodeName.FileProfileTypeId;
                _MoveDocList = fileProfileTypeDocuments.Where(w => w.Checked == true).Select(s => new DocumentsModel { SessionID = s.SessionID, DocumentID = s.DocumentID, FilterProfileTypeId = s.FilterProfileTypeId, Type = s.Type, FileProfileTypeId = s.FileProfileTypeId }).ToList();
                if (_MoveDocList.Count() > 0)
                {
                    MoveDocumentName = "From <b>" + fileType?.FileName + "</b> To <b>" + nodeName.FileName + "</b>";
                    MoveDocumentPopup = true;
                }
                else
                {
                    toastService.ShowToast("Must Select Document", AC.SD.Core.Services.ToastLevel.Error);
                }
            }
        }
        IsMoveDocumentsOpen = false;
        StateHasChanged();
    }
    async Task onMoveToFileProfileTypeUpdateInfo()
    {
        var res = await Mediator.Send(new MoveToFileProfileTypeUpdateInfo(_MoveDocList, MoveFileprofiletypeId));
        if (res > 0)
        {
            toastService.ShowToast("Documents Moved Successfully", AC.SD.Core.Services.ToastLevel.Success);
            MoveDocumentPopup = false;
            await loadFileProfileTypeAllDatas();
            await loadFileProfileData();

        }
    }
    void PopupMoveDocumentClosed()
    {
        MoveDocumentPopup = false;
    }
    void EulaPopupMoveDocumentClosed()
    {
        MoveDocumentPopup = false;
    }
    void onMissingUploadFileProfileType()
    {
        MissingUploadFileProfileTypePopup = true;
    }
    public void Dispose()
    {
        System.GC.Collect();
        GC.SuppressFinalize(this);
    }
}
