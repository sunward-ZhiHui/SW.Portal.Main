@page "/generalPage"
@using Application.Queries;
@using MediatR;
@using global::Core.Entities;
@inject IMediator Mediator

<style>
    * {
        box-sizing: border-box;
    }

    body {
        font-family: Arial, Helvetica, sans-serif;
    }

    /* Float four columns side by side */
    .column {
        float: left;
        width: 25%;
        padding: 0 5px;
    }

    .row {
        margin: 0 -5px;
    }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
        }

    /* Responsive columns */
 .media screen and (max-width: 600px) {
   .column
    {
        margin-top: 10px;
        width: 100%;
        display: block;
       
    }

 }

    /* Style the counter cards */
    .card {
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        padding: 16px;
        text-align: center;
        background-color:white;
        color: Black;
    }

    .fa {
        font-size: 50px;
        float: left;
        margin-top: 10px;
    }
</style>






@* <div class="card w-100 tooltips" style="margin-bottom:10px;">
    <div class="card-body p-0 tooltiptops"> *@
<div class="col-md-12" style="padding:10px;">
    <div class="row">
     
           <div class="col-md-3" >
            <div class="card">
              <p><i class="fa fa-user"></i>
                  <h3>@_EmailCount</h3>
                  <p>Partners</p>
                    </p>
              </div>  
 
           </div>
 

 
           <div class="col-md-3">
            <div class="card">
              <p><i class="fa fa-check"></i>
                            <h3>@_EmailCount</h3>
                        <p>Projects</p>
              </p>
            </div>
   
               </div>
  

              <div class="col-md-3">
                <div class="card">
                  <p><i class="fa fa-smile"></i>
                                <h3>@_EmailCount</h3>
                            <p>Happy Clients</p>
                  </p>

                </div>

              </div>
 
  
           <div class="col-md-3">
                    <div class="card">
              <p><i class="fa fa-coffee"></i>
                            <h3>@_EmailCount</h3>
                        <p>Meetings</p>
              </p>
                    </div>
            </div>
       
      </div>
    
</div>


<div class="col-md-12" style="padding:10px;">
    <div class="row">
        <div class="col-md-3">


            <div style="height: 440px">
                    <DxPieChart Data="@_types"
                                Diameter="diameter" Height="50%" Width="100%"
                                InnerDiameter="innerDiameter"
                                T="EmailTopics"
                            SeriesClick="OnSeriesClick">
                        <DxPieChartSeries T="EmailTopics"
                                          TArgument="long"
                                          TValue="double"
                                          ValueField="si => si.ID"
                                          ArgumentField="si => si.TopicFrom"
                                          SummaryMethod="Enumerable.Sum">
                            <DxChartSeriesLabel Visible="showLabels"
                                                Position="labelPosition"
                                                ValueFormat="ChartElementFormat.Thousands(1)">
                                <DxChartSeriesLabelConnector Visible="false" />
                            </DxChartSeriesLabel>
                        </DxPieChartSeries>
                        <DxChartTooltip Enabled="true"
                                        Position="RelativePosition.Outside">
                            <div style="margin: 0.75rem">
                                <div class="fw-bold">@context.Point.Argument</div>
                                <div>Sales: @($"${context.Point.Value:#,0.}")</div>
                            </div>
                        </DxChartTooltip>
                        <DxChartTitle Text="Email Counts">
                            <DxChartSubTitle Text="" />
                        </DxChartTitle>
                        <DxChartLegend HorizontalAlignment="HorizontalAlignment.Center"
                                       VerticalAlignment="VerticalEdge.Bottom"
                                       Orientation="Orientation.Horizontal"
                                       AllowToggleSeries="true"
                                       Position="RelativePosition.Outside" />
                    </DxPieChart>

                </div>
            </div>
       


        <div class="col-md-3">
           

                <div style="width: 100%; height: 100%">
                    <DxPieChart Data="@_types" Height="50%" Width="100%"
                                Diameter="diameter"
                                InnerDiameter="innerDiameter"
                                T="EmailTopics"
                            SeriesClick="OnSeriesClick">
                        <DxPieChartSeries T="EmailTopics"
                                          TArgument="long"
                                          TValue="double"
                                          ValueField="si => si.ID"
                                          ArgumentField="si => si.TopicFrom"
                                          SummaryMethod="Enumerable.Sum">
                            <DxChartSeriesLabel Visible="showLabels"
                                                Position="labelPosition"
                                                ValueFormat="ChartElementFormat.Thousands(1)">
                                <DxChartSeriesLabelConnector Visible="false" />
                            </DxChartSeriesLabel>
                        </DxPieChartSeries>
                        <DxChartTooltip Enabled="true"
                                        Position="RelativePosition.Outside">
                            <div style="margin: 0.75rem">
                                <div class="fw-bold">@context.Point.Argument</div>
                                <div>Sales: @($"${context.Point.Value:#,0.}")</div>
                            </div>
                        </DxChartTooltip>
                        <DxChartTitle Text="Email Counts">
                            <DxChartSubTitle Text="" />
                        </DxChartTitle>
                        <DxChartLegend HorizontalAlignment="HorizontalAlignment.Center"
                                       VerticalAlignment="VerticalEdge.Bottom"
                                       Orientation="Orientation.Horizontal" AllowToggleSeries="true"
                                       Position="RelativePosition.Outside" />
                    </DxPieChart>
                </div>
            
        </div>


        <div class="col-md-3">
           

                <div style=" height: 100%">
                    <DxPieChart Data="@_types"
                                Diameter="diameter" Height="50%" Width="100%"
                                InnerDiameter="innerDiameter"
                                T="EmailTopics"
                            SeriesClick="OnSeriesClick">
                        <DxPieChartSeries T="EmailTopics"
                                          TArgument="long"
                                          TValue="double"
                                          ValueField="si => si.ID"
                                          ArgumentField="si => si.TopicFrom"
                                          SummaryMethod="Enumerable.Sum">
                            <DxChartSeriesLabel Visible="showLabels"
                                                Position="labelPosition"
                                                ValueFormat="ChartElementFormat.Thousands(1)">
                                <DxChartSeriesLabelConnector Visible="false" />
                            </DxChartSeriesLabel>
                        </DxPieChartSeries>
                        <DxChartTooltip Enabled="true"
                                        Position="RelativePosition.Outside">
                            <div style="margin: 0.75rem">
                                <div class="fw-bold">@context.Point.Argument</div>
                                <div>Sales: @($"${context.Point.Value:#,0.}")</div>
                            </div>
                        </DxChartTooltip>
                        <DxChartTitle Text="Email Counts">
                            <DxChartSubTitle Text="" />
                        </DxChartTitle>
                        <DxChartLegend HorizontalAlignment="HorizontalAlignment.Center"
                                       VerticalAlignment="VerticalEdge.Bottom"
                                       Orientation="Orientation.Horizontal"
                                       AllowToggleSeries="true"
                                       Position="RelativePosition.Outside" />
                    </DxPieChart>

                </div>
           
        </div>


        <div class="col-md-3">
          

                <div style=" height:  100%">
                    <DxPieChart Data="@_types"
                                Diameter="diameter" Height="50%" Width="100%"
                                InnerDiameter="innerDiameter"
                                T="EmailTopics"
                            SeriesClick="OnSeriesClick">
                        <DxPieChartSeries T="EmailTopics"
                                          TArgument="long"
                                          TValue="double"
                                          ValueField="si => si.ID"
                                          ArgumentField="si => si.TopicFrom"
                                          SummaryMethod="Enumerable.Sum">
                            <DxChartSeriesLabel Visible="showLabels"
                                                Position="labelPosition"
                                                ValueFormat="ChartElementFormat.Thousands(1)">
                                <DxChartSeriesLabelConnector Visible="false" />
                            </DxChartSeriesLabel>
                        </DxPieChartSeries>
                        <DxChartTooltip Enabled="true"
                                        Position="RelativePosition.Outside">
                            <div style="margin: 0.75rem">
                                <div class="fw-bold">@context.Point.Argument</div>
                                <div>Sales: @($"${context.Point.Value:#,0.}")</div>
                            </div>
                        </DxChartTooltip>
                        <DxChartTitle Text="Email Counts">
                            <DxChartSubTitle Text="" />
                        </DxChartTitle>
                        <DxChartLegend HorizontalAlignment="HorizontalAlignment.Center"
                                       VerticalAlignment="VerticalEdge.Bottom"
                                       Orientation="Orientation.Horizontal"
                                       AllowToggleSeries="true"
                                       Position="RelativePosition.Outside" />
                    </DxPieChart>

                </div>
           
        </div>


    </div>
</div>

<DxPopup @bind-Visible="@ChartPopUp"
         ShowFooter="true"
         HeaderText="CRT"
         
         Width="500px">
    <BodyContentTemplate>
        <p>
            Do you want to delete
        </p>
    </BodyContentTemplate>
    <FooterContentTemplate Context="Context">
        <DxButton style="margin-right: 10px;" RenderStyle="ButtonRenderStyle.Primary" Text="Close" Click="ClosePopup" />
      
    </FooterContentTemplate>
</DxPopup>

@code {
    bool ChartPopUp { get; set; } = false;
    IEnumerable<EmailTopics>? _types;
    long _EmailCount;
    double? diameter = null;
    double innerDiameter = 0;
    bool showLabels = true;
    RelativePosition labelPosition = RelativePosition.Inside;
    protected override async Task OnInitializedAsync()
    {
        _types = await Mediator.Send(new GetEmailDasboard());
        var lst = await Mediator.Send(new GetAllCount());
        _EmailCount = lst[0].EmailCount;
    }
    void OnSeriesClick(PieChartSeriesClickEventArgs seriesArgs)
    {
        var lst = seriesArgs;
        ChartPopUp = true;
    }
       
    
    void ClosePopup()
    {
        ChartPopUp = false;
    }
}
