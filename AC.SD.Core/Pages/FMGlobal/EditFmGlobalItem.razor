@using Application.Command.FmGlobals;
@using Application.Commands;
@using Application.Queries;
@using MediatR
@using global::Core.EntityModels;
@using global::Core.Entities;
@using global::Core.Entities.Views;
@using global::Core.Repositories.Query;
@inject IMediator Mediator
@using DevExpress.Export
@using Application.Response;
@using System.ComponentModel.DataAnnotations;
@inject IJSRuntime JSRuntime;
@using System.Reflection;
@inject AC.SD.Core.Services.ToastService toastService
@inject ILocalStorageService<ApplicationUser> _localStorageService
@inject NavigationManager NavigationManager
@page "/FmGlobal/EditFmGlobalItem"
@page "/FmGlobal/EditFmGlobalItem/{SessionIds:guid}"
@page "/FmGlobal/EditFmGlobalItem/{SessionIds:guid}/{SessionLineIds:guid}"
<style scoped>

    #customers {
        /* font-family: Arial, Helvetica, sans-serif;
                                                                                    border-collapse: collapse;*/
        width: 100%;
    }

        #customers td, #customers th {
            border: 1px solid #ddd;
            padding: 8px;
        }

        #customers tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        #customers tr:hover {
            background-color: #ddd;
        }

        #customers th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            font-weight: bold;
        }
</style>
<div class="card" style="margin-bottom:10px; margin-left:-12px; margin-right:-12px;">
    <div class="card-body p-0">
        <div class="row">
            <div class="">
                <DxMenu CollapseItemsToHamburgerMenu="true"
                        CollapseItemToIconMode="MenuCollapseItemToIconMode.Sequentially"
                        DisplayMode="MenuDisplayMode.Desktop">
                    <Items>
                        <DxMenuItem Text="Back" IconCssClass="fa fa-reply" Click="@backUrl" />
                        <DxMenuItem Text="Released" IconCssClass="fa fa-paper-plane" Click="@ClickReleased" Enabled="@IsRelease" />
                    </Items>
                </DxMenu>
            </div>
            <div class="save_hover" style="@buttonCss">
                <button type="submit" form="@MyID" disabled="@loading" class="btnSubmitForm" onclick="@onsubmitClick">
                    @if (loading)
                    {
                        <span class="spinner-border spinner-border-sm mr-1"></span>
                    }
                    <i class="fa fa-save"></i>
                    Save
                </button>
            </div>

        </div>
    </div>
</div>
<div class="">
    <div class="row align-items-start" style="border: 1px solid #d5d4d4;">
        <div class="cw-480" style="margin-top:10px;">
            <EditForm Model="@Data" id="@MyID" Context="EditFormContext" OnValidSubmit="@HandleValidSubmit">
                <DxFormLayout CssClass="w-100">
                    <DataAnnotationsValidator />
                    <DxFormLayoutItem Caption="User Name" ColSpanMd="6">
                        <DxTextBox @bind-Text="@Data.AddedBy" ShowValidationIcon="true" Enabled=false />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="Date" ColSpanMd="6">
                        <DxDateEdit NullText="Date" @bind-Date="@Data.AddedDate" Enabled="@IsRelease" />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="Company" ColSpanMd="6">
                        <DxComboBox Data="@_plantItems"
                                    NullText="Select Company..."
                                    ListRenderMode="ListRenderMode.Virtual"
                                    SearchMode="ListSearchMode.AutoSearch"
                                    SearchFilterCondition="ListSearchFilterCondition.Contains"
                                    TextFieldName="PlantCode"
                                    ValueFieldName="PlantID"
                                    Enabled="@IsRelease"
                                    ClearButtonDisplayMode="DataEditorClearButtonDisplayMode.Auto"
                                     ShowValidationIcon="true"
                                    Value="@CurrentPlant"
                                    ValueExpression="@(() => CurrentPlant )"
                                    ValueChanged="@((ViewPlants viewPlantsmaster) => SelectedItemPlantChanged(viewPlantsmaster))">
                            <Columns>
                                <DxListEditorColumn FieldName="@nameof(ViewPlants.PlantCode)"
                                                    Caption="Company Name"
                                                    Width="180px" />
                                <DxListEditorColumn FieldName="@nameof(ViewPlants.Description)"
                                                    Caption="Description" />
                                <DxListEditorColumn FieldName="@nameof(ViewPlants.NavCompanyName)"
                                                    Caption="Nav Company" />
                            </Columns>
                        </DxComboBox>
                        <DxSpinEdit @bind-Value="@Data.CompanyId" ShowValidationIcon="true" style="display:none;" />
                        <ValidationMessage For="@(() => Data.CompanyId)" />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="Expected Shipment Date" ColSpanMd="6">
                        <DxDateEdit NullText="Select a Date" @bind-Date="@Data.ExpectedShipmentDate" Enabled="@IsRelease" />
                        <ValidationMessage For="@(() => Data.ExpectedShipmentDate)" />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="PO No" ColSpanMd="6">
                        <DxTextBox @bind-Text="@Data.Pono" ShowValidationIcon="true" Enabled="@IsRelease" />
                        <ValidationMessage For="@(() => Data.Pono)" />
                    </DxFormLayoutItem>

                    <DxFormLayoutItem Caption="Location From" ColSpanMd="6">
                        <DxComboBox Data="@_AllICTMasterFrom"
                                    NullText="Select Location From..."
                                    ListRenderMode="ListRenderMode.Virtual"
                                    SearchMode="ListSearchMode.AutoSearch"
                                    SearchFilterCondition="ListSearchFilterCondition.Contains"
                                    TextFieldName="Name"
                                    ValueFieldName="IctmasterId"
                                    Enabled="@IsRelease"
                                    ClearButtonDisplayMode="DataEditorClearButtonDisplayMode.Auto"
                                    Value="@CurrentFrom"
                                    ValueExpression="@(() => CurrentFrom )"
                                    ShowValidationIcon="true"
                                    ValueChanged="@((ViewIctmaster viewIctmaster) => SelectedFromItemChanged(viewIctmaster,"Add",0))">
                            <Columns>

                                <DxListEditorColumn FieldName="@nameof(ViewIctmaster.Name)"
                                                    Caption="Location" />
                                <DxListEditorColumn FieldName="@nameof(ViewIctmaster.Site)"
                                                    Caption="Site" />
                                <DxListEditorColumn FieldName="@nameof(ViewIctmaster.ParentName)"
                                                    Caption="Zone" />
                                <DxListEditorColumn FieldName="@nameof(ViewIctmaster.Description)"
                                                    Caption="Description" />
                            </Columns>
                        </DxComboBox>
                        <DxSpinEdit @bind-Value="@Data.LocationFromId" ShowValidationIcon="true" style="display:none;" />
                        <ValidationMessage For="@(() => Data.LocationFromId)" />
                    </DxFormLayoutItem>

                    <DxFormLayoutItem Caption="Location To " ColSpanMd="6">
                        <DxComboBox Data="@_AllICTMasterTo"
                                    NullText="Select Location To..."
                                    ListRenderMode="ListRenderMode.Virtual"
                                    SearchMode="ListSearchMode.AutoSearch"
                                    SearchFilterCondition="ListSearchFilterCondition.Contains"
                                    TextFieldName="Name"
                                    ValueFieldName="IctmasterId"
                                    Enabled="@IsRelease"
                                    ClearButtonDisplayMode="DataEditorClearButtonDisplayMode.Auto"
                                    ShowValidationIcon="true"
                                    Value="@CurrentTo"
                                    ValueExpression="@(() => CurrentTo )"
                                    ValueChanged="@((ViewIctmaster viewIctmaster) => SelectedToItemChanged(viewIctmaster))">
                            <DxListEditorColumn FieldName="@nameof(ViewIctmaster.Name)"
                                                Caption="Location" />
                            <DxListEditorColumn FieldName="@nameof(ViewIctmaster.Site)"
                                                Caption="Site" />
                            <DxListEditorColumn FieldName="@nameof(ViewIctmaster.ParentName)"
                                                Caption="Zone" />
                            <DxListEditorColumn FieldName="@nameof(ViewIctmaster.Description)"
                                                Caption="Description" />
                        </DxComboBox>
                        <DxSpinEdit @bind-Value="@Data.LocationToId" ShowValidationIcon="true" style="display:none;" />
                        <ValidationMessage For="@(() => Data.LocationToId)" />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="Customer" ColSpanMd="6">
                        <DxComboBox Data="@_AllSoCustomer"
                                    NullText="Select Customer..."
                                    ListRenderMode="ListRenderMode.Virtual"
                                    SearchMode="ListSearchMode.AutoSearch"
                                    SearchFilterCondition="ListSearchFilterCondition.Contains"
                                    TextFieldName="CustomerName"
                                    ValueFieldName="SoCustomerId"
                                    EditFormat="{0}-{1}"
                                    Value="@CurrentCustomer"
                                    ValueExpression="@(() => CurrentCustomer )"
                                    ValueChanged="@((SoCustomer soCustomer) => SelectedItemChanged(soCustomer))" ShowValidationIcon="true">
                            <Columns>
                                <DxListEditorColumn FieldName="@nameof(SoCustomer.CustomerName)"
                                                    Caption="Customer Name"
                                                    Width="180px" />
                                <DxListEditorColumn FieldName="@nameof(SoCustomer.ShipCode)"
                                                    Caption="Ship Code" />
                                <DxListEditorColumn FieldName="@nameof(SoCustomer.AssignToRep)"
                                                    Caption="AssignTo Rep" />
                            </Columns>
                            <Buttons>
                                <DxEditorButton IconCssClass="fa fa-eye" Id=@($"flyout-overview-target-container-customer-info")
                                                Tooltip="Pricing Info"
                                                Click="@(_ => OnButtonCustomerClick())" />
                            </Buttons>
                        </DxComboBox>
                        <DxSpinEdit @bind-Value="@Data.SoCustomerId" ShowValidationIcon="true" style="display:none;" />
                        <ValidationMessage For="@(() => Data.SoCustomerId)" />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="Shipped By" ColSpanMd="6">
                        <DxTextBox @bind-Text="@Data.ShippedBy" ShowValidationIcon="true" Enabled="@IsRelease" />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="Status" ColSpanMd="6">
                        <DxComboBox Data="@_statusListItems"
                                    NullText="Select Status..."
                                    SearchMode="ListSearchMode.AutoSearch"
                                    SearchFilterCondition="ListSearchFilterCondition.Contains"
                                    TextFieldName="Value"
                                    ValueFieldName="ApplicationMasterDetailID"
                                    Value="@CurrentStatus"
                                    ValueExpression="@(() => CurrentStatus )"
                                    Enabled="@IsRelease"
                                    ClearButtonDisplayMode="DataEditorClearButtonDisplayMode.Auto"
                                    ValueChanged="@((View_ApplicationMasterDetail applicationMasteModel) => SelectedStatusItemChanged(applicationMasteModel))"
                                    ShowValidationIcon="true">
                        </DxComboBox>
                        <DxSpinEdit @bind-Value="@Data.FmglobalStausId" ShowValidationIcon="true" style="display:none;" />
                        <ValidationMessage For="@(() => Data.FmglobalStausId)" />
                    </DxFormLayoutItem>

                </DxFormLayout>
            </EditForm>

            <div class="row align-items-end" style="border-top: 1px solid #d5d4d4; margin-top:10px;">
                <div class="cw-480 ch-220" style="margin-top:10px;">
                    <DxFormLayout CssClass="w-100">
                        <DxTabs @bind-ActiveTabIndex="@ActiveSubTabIndex" TabClick="OnTabClick">
                            <DxTabPage Text="Pallet Entry">
                                <div style="padding: 10px;border: 1px solid #d5d4d4; border-top: none"><FmGlobalLines @ref=RefFmGlobalLine FmglobalId=@FmglobalId></FmGlobalLines></div>
                            </DxTabPage>
                            <DxTabPage Text="Pallet Item Entry" Enabled="@childTabEnabled">
                                <FmGlobalLineItems @ref="refFmGlobalLineItems"></FmGlobalLineItems>
                            </DxTabPage>
                            <DxTabPage Text="Address">
                                <FMGlobalAddress _salesOrderItems="@_fmglobalItem"></FMGlobalAddress>
                            </DxTabPage>
                        </DxTabs>
                    </DxFormLayout>
                </div>
            </div>

        </div>
    </div>
</div>

<DxPopup @bind-Visible="@MessageVisible"
         HeaderText="@MessageHeader"
         BodyText="@MessageBody" />

<DxFlyout @bind-IsOpen=IsCustomerOpen
          PositionTarget=@($"#flyout-overview-target-container-customer-info")
          RestrictionTarget="#Navigation-Flyout-Customization"
          AnimationType="FlyoutAnimationType.Fade"
          PreventCloseOnPositionTargetClick="true"
          FooterVisible="true"
          FooterCssClass="custom-flyout-footer"
          Width="max(25vw, 550px)"
          CloseOnOutsideClick=false
          Position=@(FlyoutPosition.BottomStart | FlyoutPosition.TopStart)>
    <BodyContentTemplate Context="PopupContext">
        <div class="custom-flyout-body" style="width:100%">

            <table style="width:100%" id="customers">
                @if (@soCustomer1.SoCustomerId > 0)
                {
                    <tr>
                        <th>Name</th>
                        <td>@soCustomer1.CustomerName</td>
                    </tr>
                    <tr>
                        <th>Ship Code</th>
                        <td>@soCustomer1.ShipCode</td>
                    </tr>
                    <tr>
                        <th>Assign To Rep</th>
                        <td>@soCustomer1.AssignToRep</td>
                    </tr>
                    <tr>
                        <th>Address1</th>
                        <td>@soCustomer1.Address1</td>
                    </tr>
                    <tr>
                        <th>Address2</th>
                        <td>@soCustomer1.Address2</td>
                    </tr>
                    <tr>
                        <th>State Code</th>
                        <td>@soCustomer1.StateCode</td>
                    </tr>
                    <tr>
                        <th>City</th>
                        <td>@soCustomer1.City</td>
                    </tr>
                    <tr>
                        <th>PostCode</th>
                        <td>@soCustomer1.PostCode</td>
                    </tr>
                    <tr>
                        <th>Channel</th>
                        <td>@soCustomer1.Channel</td>
                    </tr>
                }
                else
                {
                    <tr><td colspan="2">No Records Found.</td></tr>
                }
            </table>

        </div>
    </BodyContentTemplate>
    <FooterContentTemplate>
        <div class="w-100">
            <div class="custom-flyout-footer">

                <DxButton CssClass="popup-button" RenderStyle="ButtonRenderStyle.Primary" Text="Close" Click=@(()=> IsCustomerOpen = false) />
            </div>
        </div>
    </FooterContentTemplate>
</DxFlyout>
@code {
    View_ApplicationMasterDetail CurrentStatus{ get; set; }
    ViewPlants CurrentPlant { get; set; }
    SoCustomer CurrentCustomer { get; set; }
    ViewIctmaster CurrentFrom { get; set; }
    ViewIctmaster CurrentTo { get; set; }
    public long? FmglobalId { get; set; }
    FmGlobalLines? RefFmGlobalLine { get; set; }
    FmGlobalLineItems? refFmGlobalLineItems { get; set; }
    [Parameter]
    public Guid? SessionIds { get; set; }
    [Parameter]
    public Guid? SessionLineIds { get; set; }
    bool IsRelease { get; set; } = true;
    public int ActiveTabIndex { get; set; } = 0;
    bool childTabEnabled { get; set; } = false;
    string buttonCss = "float: left; margin-top: -41px; line-height: 38px; margin-left: 254px; z-index: 9999; width:100px;";
    private bool loading;
    private string MyID = "myid";
    long? EmployeeIds { get; set; }
    bool EditEnabledTab { get; set; } = false;
    public int ActiveSubTabIndex { get; set; } = 0;
    ViewFmglobalLine viewFmglobalLine = new ViewFmglobalLine();
    ViewFmglobal _fmglobalItem = new ViewFmglobal();
    public Guid? BackSessionId1 { get; set; }
    public Guid? BackSessionId2 { get; set; }
    private List<ViewPlants>? _plantItems;
    private List<View_ApplicationMasterDetail> _statusListItems;

    ViewFmglobal Data = new ViewFmglobal();
    private List<ViewIctmaster>? _AllICTMasterFrom;
    private List<ViewIctmaster>? _AllICTMasterTo;
    public ApplicationUser applicationUser { get; private set; }
    bool MessageVisible { get; set; }
    string MessageHeader = "";
    string MessageBody = "";
    private List<SoCustomer>? _AllSoCustomer;
    bool IsCustomerOpen { get; set; } = false;
    SoCustomer soCustomer1 = new SoCustomer();
    protected override async Task OnInitializedAsync()
    {
        childTabEnabled = true;
        applicationUser = await _localStorageService.GetItem<ApplicationUser>("user");
        Data.ExpectedShipmentDate = DateTime.Now;
        Data.AddedDate = DateTime.Now;
        Data.AddedBy = applicationUser.UserName;
        // _AllSoCustomer = await Mediator.Send(new GetSoCustomerByTypeQuery("Customer"));
        _statusListItems = await Mediator.Send(new GetAllApplicationMasterDetailQuery(345));
        _plantItems = await Mediator.Send(new GetAllPlantQuery());
        if (SessionIds != null && SessionLineIds != null)
        {
            childTabEnabled = true;
            ActiveSubTabIndex = 1;

            StateHasChanged();
            _fmglobalItem = await Mediator.Send(new GetAllFmGlobalBySessionQuery(SessionIds));
            viewFmglobalLine = await Mediator.Send(new GetAllFmGlobalLineBySessionQuery(SessionLineIds));
            await loadData();
            await refFmGlobalLineItems.loadData(viewFmglobalLine, _fmglobalItem.CompanyId, IsRelease);

        }
        else
        {
            await loadData();
        }
    }
    void OnButtonCustomerClick()
    {
        IsCustomerOpen = true;
    }

    async Task SelectedFromItemChanged(ViewIctmaster fromId, string? type, long? toId)
    {
        if (type == "Add")
        {
            CurrentTo = null; Data.LocationToId = null;
            CurrentFrom = null;
            Data.LocationFromId = null;
            _AllICTMasterTo = new List<ViewIctmaster>();
        }
        if (fromId != null && fromId.IctmasterId > 0)
        {
            CurrentFrom = fromId;
            Data.LocationFromId = fromId.IctmasterId;
            _AllICTMasterTo = await Mediator.Send(new GetIctMasterLocationByCompanyQuery(572, _fmglobalItem.CompanyId));
            _AllICTMasterTo = _AllICTMasterTo.Where(w => w.IctmasterId != fromId.IctmasterId).ToList();
            StateHasChanged();
        }
    }
    void SelectedItemChanged(SoCustomer soCustomer)
    {
        CurrentCustomer = null;
        if (soCustomer != null)
        {
            CurrentCustomer = soCustomer;
            Data.SoCustomerId = soCustomer.SoCustomerId;
            soCustomer1 = soCustomer;
        }
        else
        {
            Data.SoCustomerId = null;
            soCustomer1 = new SoCustomer();
        }
    }
    async Task ClickReleased()
    {
        var releasedSatausId = _statusListItems.FirstOrDefault(a => a.Value.ToLower() == "released")?.ApplicationMasterDetailID;
        Data.FmglobalStatus = "Released";
        Data.FmglobalStausId = releasedSatausId;
        await HandleValidSubmit();
    }
    void SelectedToItemChanged(ViewIctmaster fromId)
    {
        CurrentTo = null;
        Data.LocationToId = null;
        if (fromId != null && fromId.IctmasterId > 0)
        {
            CurrentTo = fromId;
            Data.LocationToId = fromId.IctmasterId;
        }
    }
    async Task SelectedItemPlantChanged(ViewPlants companyId)
    {

        CurrentPlant = null; Data.CompanyId = null; CurrentFrom = null; Data.LocationFromId = null; CurrentTo = null; Data.LocationToId = null;
        if (companyId != null && companyId.PlantID > 0)
        {
            CurrentPlant = companyId;
            Data.CompanyId = companyId.PlantID;
            _AllICTMasterFrom = await Mediator.Send(new GetIctMasterLocationByCompanyQuery(572, companyId.PlantID));

        }
        StateHasChanged();
    }
    async void SelectedStatusItemChanged(View_ApplicationMasterDetail applicationMasterChildModel)
    {
        CurrentStatus = null;
        Data.FmglobalStatus = null; Data.FmglobalStausId = null;
        if (applicationMasterChildModel != null)
        {
            Data.FmglobalStausId = applicationMasterChildModel.ApplicationMasterDetailID;
            CurrentStatus = applicationMasterChildModel;
            Data.FmglobalStatus = applicationMasterChildModel.Value;
        }
    }
    async Task OnTabClick(TabClickEventArgs e)
    {
        if (e.TabIndex == 0)
        {
            NavigationManager.NavigateTo("FmGlobal/EditFmGlobal/" + SessionIds + "");
        }
        if (e.TabIndex == 2)
        {
            childTabEnabled = false;
            StateHasChanged();
        }
    }
    void BackEdit(Guid? SessionId1, Guid? SessionId2)
    {
        childTabEnabled = true;
        if (SessionId1 != null && SessionId2 != null)
        {
            BackSessionId1 = SessionId1;
            BackSessionId2 = SessionId2;
        }
    }
    
    public async Task loadData()
    {
        if (SessionIds != null)
        {
            await loadLineData(SessionIds);
            if (_fmglobalItem != null)
            {
                FmglobalId = _fmglobalItem.FmglobalId;
                Data.CompanyId = _fmglobalItem.CompanyId;
                Data.FmglobalId = _fmglobalItem.FmglobalId;
                Data.AddedBy = _fmglobalItem.AddedBy;
                Data.AddedDate = _fmglobalItem.AddedDate;
                Data.ExpectedShipmentDate = _fmglobalItem.ExpectedShipmentDate;
                Data.Pono = _fmglobalItem.Pono;
                Data.LocationFromId = _fmglobalItem.LocationFromId;
                Data.LocationToId = _fmglobalItem.LocationToId;
                Data.SoCustomerId = _fmglobalItem.SoCustomerId;
                Data.SoCustomerShipingAddressId = _fmglobalItem.SoCustomerShipingAddressId;
                Data.ShippedBy = _fmglobalItem.ShippedBy;
                Data.FmglobalStatus = _fmglobalItem.FmglobalStatus;
                if (_fmglobalItem.FmglobalId > 0)
                {
                    Data.FmglobalStausId = _fmglobalItem.FmglobalStausId;
                }
                else
                {
                    var StatusId = _statusListItems.FirstOrDefault(a => a.Value.ToLower() == "open")?.ApplicationMasterDetailID;
                    Data.FmglobalStausId = StatusId;
                }
                Data.SessionId = _fmglobalItem.SessionId;
                if (_fmglobalItem.SoCustomerId > 0)
                {
                    var soCustomers = await Mediator.Send(new GetAllSoCustomerByID(_fmglobalItem.SoCustomerId));
                    if (soCustomers != null)
                    {
                        soCustomer1 = soCustomers;
                    }
                }
                if (_fmglobalItem.FmglobalStatus.ToLower() == "released")
                {
                    buttonCss = "display:none;";
                    IsRelease = false;
                    if (soCustomer1 != null)
                    {
                        _AllSoCustomer = new List<SoCustomer>();
                        _AllSoCustomer.Add(soCustomer1);
                    }
                }
                else
                {
                    _AllSoCustomer = await Mediator.Send(new GetSoCustomerByTypeQuery("Customer"));
                }
                CurrentCustomer = _AllSoCustomer != null && _fmglobalItem.SoCustomerId > 0 ? _AllSoCustomer.FirstOrDefault(f => f.SoCustomerId == _fmglobalItem.SoCustomerId) : null;
                StateHasChanged();
                var plantData = _plantItems != null && _fmglobalItem.CompanyId > 0 ? _plantItems.FirstOrDefault(f => f.PlantID == _fmglobalItem.CompanyId) : null;
                await SelectedItemPlantChanged(plantData);
                _AllICTMasterTo = await Mediator.Send(new GetIctMasterLocationByCompanyQuery(572, _fmglobalItem.CompanyId));
                var locationData = _AllICTMasterFrom != null && _fmglobalItem.LocationFromId > 0 ? _AllICTMasterFrom.FirstOrDefault(f => f.IctmasterId == _fmglobalItem.LocationFromId) : null;
                await SelectedFromItemChanged(locationData, "Edit", _fmglobalItem.LocationToId);
                Data.LocationToId = _fmglobalItem.LocationToId;
                CurrentTo = _AllICTMasterTo != null && _fmglobalItem.LocationToId > 0 ? _AllICTMasterTo.FirstOrDefault(f => f.IctmasterId == _fmglobalItem.LocationToId) : null;
            }
        }
    }
    async Task loadLineData(Guid? SessionIds)
    {
        _fmglobalItem = await Mediator.Send(new GetAllFmGlobalBySessionQuery(SessionIds));
        await RefFmGlobalLine.loadData(_fmglobalItem);
    }
    void backUrl()
    {
        NavigationManager.NavigateTo("FmGlobal");
    }
    void ResetForm()
    {

        FmglobalId = -1;
        ActiveSubTabIndex = 0;
        NavigationManager.NavigateTo("FmGlobal/AddFmGlobal");
    }

    void onsubmitClick()
    {
        ActiveSubTabIndex = 0;
    }
    async Task HandleValidSubmit()
    {
        loading = true;
        if (Data.FmglobalId > 0)
        {
            var editModel = new Fmglobal();
            var createReq = new EditFmGlobalCommand
                {
                    CompanyId = Data.CompanyId,
                    FmglobalId = Data.FmglobalId.Value,
                    Pono = Data.Pono,
                    ExpectedShipmentDate = Data.ExpectedShipmentDate,
                    LocationFromId = Data.LocationFromId,
                    LocationToId = Data.LocationToId,
                    FmglobalStausId = Data.FmglobalStausId,
                    AddedByUserId = applicationUser.UserID,
                    AddedDate = DateTime.Now,
                    ModifiedByUserId = applicationUser.UserID,
                    ModifiedDate = DateTime.Now,
                    SessionId = Data.SessionId,
                    StatusCodeId = 1,
                    FmglobalStaus = _statusListItems.FirstOrDefault(a => a.ApplicationMasterDetailID == Data.FmglobalStausId)?.Value,
                    SoCustomerId = Data.SoCustomerId,
                    SoCustomerShipingAddressId = Data.SoCustomerShipingAddressId,
                    ShippedBy = Data.ShippedBy,
                };

            await Mediator.Send(createReq);
            toastService.ShowToast("Record updated Successfully", AC.SD.Core.Services.ToastLevel.Success);
            loading = false;
            if (Data.FmglobalStatus.ToLower() == "released")
            {
                NavigationManager.NavigateTo("FmGlobal/EditFmGlobal/" + SessionIds);
            }
            else
            {
                await loadData();
            }
            StateHasChanged();
        }
    }

    private async void onShowPopupMessage(string headerText, string bodyText)
    {
        MessageVisible = true;
        MessageBody = bodyText;
        MessageHeader = headerText;
        StateHasChanged();
    }
    void HandleInvalidSubmit()
    {
    }
    void Grid_CustomizeElement(GridCustomizeElementEventArgs e)
    {
        if (e.ElementType == GridElementType.DataRow && e.VisibleIndex % 2 == 1)
        {
            e.CssClass = "alt-item";
        }
    }
}
