@page "/firebase"
@using Microsoft.JSInterop
@inject IJSRuntime JSRuntime;
@using FirebaseAdmin.Messaging;

<button @onclick="InitializeFirebase">Initialize Firebase</button>


@code {
   // private IJSRuntime JSRuntime { get; set; }

    private async Task InitializeFirebase()
    {
        try
        {
            await JSRuntime.InvokeVoidAsync("eval", await System.IO.File.ReadAllTextAsync("_content/AC.SD.Core/js/example.js"));
            await JSRuntime.InvokeVoidAsync("initializeFirebaseMessaging");
        }
        catch (Exception ex)
        {
            Console.WriteLine("Error loading JavaScript file: " + ex.Message);
        }
    }

    protected override async Task OnInitializedAsync()
    {
       await JSRuntime.InvokeVoidAsync("registerServiceWorker");

       // await JSRuntime.InvokeVoidAsync("initializeFirebaseMessaging");
       // await JSRuntime.InvokeVoidAsync("requestNotificationPermission");
    }

    //public FirebaseMessagingComponent(IJSRuntime jsRuntime)
    //{
    //    JSRuntime = jsRuntime;
    //}

    private async Task RequestNotificationPermission()
    {
        await JSRuntime.InvokeVoidAsync("initializeFirebaseMessaging");
        await JSRuntime.InvokeVoidAsync("requestNotificationPermission");
    }
}
