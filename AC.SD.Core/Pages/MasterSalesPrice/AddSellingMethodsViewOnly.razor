@using Application.Command.SalesOrderMasterPricingLineSellingMethods;
@using Application.Command.SalesOrderMasterPricingLine;
@using Application.Command.SoSalesOrderLine;
@using Application.Commands;
@using Application.Queries;
@using Application.Response;
@using MediatR
@using global::Core.Entities;
@using global::Core.Entities.Views;
@inject IMediator Mediator
@using DevExpress.Export
@using global::Core.Repositories.Query;
@inject IJSRuntime jsRuntime;
@inject AC.SD.Core.Services.ToastService toastService
@inject ILocalStorageService<ApplicationUser> _localStorageService



<DxLoadingPanel @bind-Visible="PanelVisible"
                IsContentBlocked="true"
                ApplyBackgroundShading="true"
                IndicatorAreaVisible="false"
                Text="Fetching Data...">

    <DxGrid @ref="SMGrid" Data="@_addIitemPriceLineSellingMethods" CssClass="ch-360">
        <Columns>
            <DxGridDataColumn FieldName="SalesOrderMasterPricingLineId" Visible="false" />
            @if (sellingMethodsName == "tier")
            {
                <DxGridDataColumn FieldName="TierFromQty" Caption="Tier Qty">
                    <CellDisplayTemplate>
                        @{
                            var item = (SalesOrderMasterPricingLineSellingMethod)context.DataItem;
                        }
                        @(item.TierFromQty + (item.TierToQty > 0 ? ("-" + item.TierToQty) : " - No Limit Qty"))
                    </CellDisplayTemplate>
                </DxGridDataColumn>
                <DxGridDataColumn FieldName="TierPrice" />
            }
            else
            {
                <DxGridDataColumn FieldName="BounsQty" SortIndex="0" SortOrder="GridColumnSortOrder.Ascending">
                    <CellDisplayTemplate>
                        @{
                            var item = (SalesOrderMasterPricingLineSellingMethod)context.DataItem;
                        }
                        @(item.BounsQty + (item.BounsToQty > 0 ? ("-" + item.BounsToQty) : " - No Limit Qty"))
                    </CellDisplayTemplate>
                </DxGridDataColumn>
                <DxGridDataColumn FieldName="BounsFocQty" Caption="Bouns Foc Qty" />
            }

            <DxGridCommandColumn Width="160px" Visible="false" />
        </Columns>
        <TotalSummary>
            <DxGridSummaryItem SummaryType="GridSummaryItemType.Count" FieldName="SalesOrderMasterPricingLineSellingMethodId" />
        </TotalSummary>
    </DxGrid>
</DxLoadingPanel>


@code {
    bool PanelVisible { get; set; }
    [Parameter]
    public View_SalesOrderMasterPricingLineByItem? Items { get; set; }
    public List<SalesOrderMasterPricingLineSellingMethod>? _addIitemPriceLineSellingMethods { get; set; }
    IGrid? SMGrid { get; set; }
    string sellingMethodsName { get; set; }
    protected override async Task OnInitializedAsync()
    {
        if (Items.SellingMethodName != null)
        {
            PanelVisible = true;
            sellingMethodsName = Items.SellingMethodName.ToLower();
            _addIitemPriceLineSellingMethods = await Mediator.Send(new GetAllSOMPricingLineSellingMethodQuery(Items.SalesOrderMasterPricingLineId, sellingMethodsName));
            PanelVisible = false;
            StateHasChanged();
        }
    }

}
