@page "/SyrupScheduleGantt"
@using Syncfusion.Blazor
@using Syncfusion.Blazor.Gantt
@using global::Core.Repositories.Query
@using static global::Core.EntityModels.SyrupReportDtos
@inject IStockInformationMasterQueryRepository StockQueryRepo
@inject NavigationManager NavigationManager

<style>
    /* Container class used in the SfGantt: gantt-halfhour-grid */
    .gantt-halfhour-grid .e-gantt-chart {
        /*
               Two repeating gradients:
               - faint line every half-hour (60px)
               - stronger line every hour (120px)
               Adjust 60px/120px if you change TimelineUnitSize.
            */
        background-image: repeating-linear-gradient( to right, rgba(0,0,0,0.04) 0px, rgba(0,0,0,0.04) 1px, transparent 1px, transparent 60px ), repeating-linear-gradient( to right, rgba(0,0,0,0.09) 0px, rgba(0,0,0,0.09) 1px, transparent 1px, transparent 120px );
        background-position: left top;
        background-repeat: repeat-y;
        background-size: auto 100%;
    }

        /* Slight tweak to ensure the chart content overlays grid cleanly */
        .gantt-halfhour-grid .e-gantt-chart .e-chart-row {
            background: transparent; /* keep the repeating-grid visible */
        }

    /* If header misaligns slightly depending on Syncfusion version, try this */
    .gantt-halfhour-grid .e-gantt-timeline {
        position: relative;
        z-index: 3;
    }

</style>
<style scoped>
    .e-yscroll, .e-chart-scroll-container {
        scrollbar-width: thin;
    }
</style>
<div class="col-lg-12 control-section">
    <div class="content-wrapper">
        <div class="row">
            <SfGantt TValue="TaskData"
                     DataSource="@Tasks"
                     Height="80vh"
                     Width="100%"
                     DurationUnit="DurationUnit.Minute"
                     HighlightWeekends="false"
                     ProjectStartDate="@ProjectStartDate"
                     ProjectEndDate="@ProjectEndDate"
                     TimelineSettings="@TimelineSettings"
                     DayWorkingTime="@DayWorkingTimes"
                     TaskbarHeight="20"
                     RowHeight="38"
                     CssClass="gantt-halfhour-grid"
                     TreeColumnIndex="1">

                <GanttTaskFields Id="TaskId"
                                 Name="TaskName"
                                 StartDate="StartDate"
                                 EndDate="EndDate"
                                 Progress="Progress"
                                 ParentID="ParentId"
                                 Dependency="Predecessor">
                </GanttTaskFields>

                <GanttColumns>
                    <GanttColumn Field="TaskId" HeaderText="ID" Width="70"></GanttColumn>
                    <GanttColumn Field="TaskName" HeaderText="Task Name" Width="260"></GanttColumn>
                </GanttColumns>
            </SfGantt>
        </div>
    </div>
</div>

@code {
    
    private DateTime ProjectStartDate { get; set; } = new DateTime(2021, 4, 2, 8, 0, 0);
    private DateTime ProjectEndDate { get; set; } = new DateTime(2021, 4, 2, 20, 0, 0);
    private IReadOnlyList<TaskData> Tasks { get; set; } = Array.Empty<TaskData>();    
    private GanttTimelineSettings TimelineSettings = new()
    {
        TimelineViewMode = TimelineViewMode.Hour,
        TimelineUnitSize = 120, 
        TopTier = new GanttTimelineTierSettings
        {
            Unit = TimelineViewMode.Day,
            Format = "ddd, dd MMM"
        },
        BottomTier = new GanttTimelineTierSettings
        {
            Unit = TimelineViewMode.Hour,            
            Format = "HH:mm"
        }
    };
    
    private List<GanttDayWorkingTime> DayWorkingTimes = new()
    {
        new GanttDayWorkingTime { From = 8, To = 20 }
    };

    protected override async Task OnInitializedAsync()
    {
        string profileNo = "MC-0054";        
        DateTime productionDay = DateTime.Today; 
        TimeSpan shiftStart = TimeSpan.FromHours(8);
        TimeSpan shiftEnd = TimeSpan.FromHours(20);
        
        ProjectStartDate = productionDay.Date + shiftStart;
        ProjectEndDate = productionDay.Date + shiftEnd;

        await Task.Delay(2000); 
        var readOnly = await StockQueryRepo.GetProductionGanttAsyncList(profileNo, productionDay, shiftStart);
        Tasks = readOnly.ToList();
        
    }
   
}
