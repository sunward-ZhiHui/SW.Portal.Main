@using System.Collections
@using System.Text.RegularExpressions
@using global::Core.EntityModels
@using Application.Queries;
@using MediatR
@inject IMediator Mediator
<DxLoadingPanel @bind-Visible="PanelVisible"
                IsContentBlocked="true"
                ApplyBackgroundShading="true"
                IndicatorAreaVisible="false"
                Text="Fetching Data...">
    <div class="col-lg-12 control-section">
        <div class="content-wrapper tt1">
            <div class="table-container">
                <table>
                    <thead>
                        <tr class="group-header">
                            <td colspan="11">Generic Code: @_selectedItems?.MethodCode</td>
                        </tr>
                        <tr>
                            <th>Item No</th>
                            <th>No of ticket - whole no</th>
                            <th>split - Do not need</th>
                            <th>Split after add whole ticket </th>
                            <th>Batch Size</th>
                            <th>Pack</th>
                            <th>Stock</th>
                            <th>Stock in whole no</th>
                            <th>Balance in stock</th>
                            <th>Recommended Stock factor</th>
                            <th>Balance stock in bulk</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (_simulationItems?.Any() == true)
                        {
                            foreach (var item in _simulationItems)
                            {
                                <tr>
                                    <td>@item.ItemNo</td>
                                    <td>@(item.NoOfTicketWholeNo.HasValue? Math.Round(item.NoOfTicketWholeNo.Value, 2): null)</td>
                                    <td>@(item.FinalSplitTicket1.HasValue? Math.Round(item.FinalSplitTicket1.Value, 2): null)</td>
                                    <td>@(item.SplitAfterAddWholeTicket.HasValue? Math.Round(item.SplitAfterAddWholeTicket.Value, 2): null)</td>
                                    <td>@item.BatchSizeValue</td>
                                    <td>@item.PackSize</td>
                                    <td>@(item.StockValue.HasValue? Math.Round(item.StockValue.Value, 2): null)</td>
                                    <td>@(item.StockInWholeNo.HasValue? Math.Round(item.StockInWholeNo.Value, 2): null)</td>
                                    <td>@(item.BalanceInStock.HasValue? Math.Round(item.BalanceInStock.Value, 2): null)</td>
                                    <td>@(item.RecommendedStockFactor.HasValue? Math.Round(item.RecommendedStockFactor.Value, 2): null)</td>
                                    <td>@(item.BalanceStockInBulk.HasValue? Math.Round(item.BalanceStockInBulk.Value, 2): null)</td>
                                </tr>
                            }
                            <tr>
                                <td colspan="9"></td>
                                <td>Final Balance Qty</td>
                                <td>@(tickectCalItemModel?.FinalBalanceQty != null ? Math.Round(tickectCalItemModel.FinalBalanceQty.Value, 2) : (decimal?)null)</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</DxLoadingPanel>
@code {

    [Parameter]
    public IEnumerable _simulationItem2 { get; set; }
    [Parameter]
    public string? MonthName { get; set; }
    [Parameter]
    public decimal? MonthData { get; set; }
    [Parameter]
    public string? MonthType { get; set; }
    [Parameter]
    public INPCalendarPivotModel _selectedItems { get; set; }
    [Parameter]
    public TickectCalItemModel tickectCalItemModel { get; set; }
    IGrid Grid { get; set; }
    bool PanelVisible { get; set; } = true;
    private List<INPCalendarPivotModel> _AllsimulationItems = new List<INPCalendarPivotModel>();
    private IEnumerable<INPCalendarPivotModel> _simulationItems = new List<INPCalendarPivotModel>();
    protected override async Task OnInitializedAsync()
    {

    }
    protected override async Task OnParametersSetAsync()
    {
        await LoadData();
    }
    public async Task LoadData()
    {
        if (_simulationItem2 != null)
        {
            _AllsimulationItems = _simulationItem2.Cast<INPCalendarPivotModel>().ToList();
            _simulationItems = new List<INPCalendarPivotModel>();
            _simulationItems = _AllsimulationItems.Where(w => w.MethodCodeId == _selectedItems.MethodCodeId).ToList();
        }
        PanelVisible = false;
    }
    private void Grid_CustomizeElement(GridCustomizeElementEventArgs e)
    {
        if (e.ElementType == GridElementType.DataRow && e.VisibleIndex % 2 == 1)
        {
            e.CssClass = "alt-item";
        }
    }
}
