@implements IDisposable
@inject DemoConfiguration Configuration
@inject NavigationManager NavigationManager

<DemoScriptLoader @ref=@navPanelHelper Src="_content/AC.SD.Core/lib/page-nav.js">
</DemoScriptLoader>

@code {
    DemoScriptLoader navPanelHelper;

    public bool Visible { get; set; }
    public string HeaderStateCssClass { get; set; } = "collapse";

    protected override void OnInitialized() {
        //NavigationManager.LocationChanged += OnLocationChanged;        
    }

    protected override async Task OnAfterRenderAsync(bool firstRender) {
        await navPanelHelper.InvokeVoidAsync("DemoPageNavPanel.addDemoAnchorIntersectionObserver");
    }

    string GetItemCssClass(int itemIndex) {
        if(itemIndex == 0) {
            var uriFragment = NavigationManager.ToAbsoluteUri(NavigationManager.Uri).Fragment.Replace("#", "");
            if(string.IsNullOrEmpty(uriFragment))
                return "nav-target";
        }
        return "";
    }

    

    void OnLocationChanged(object sender, LocationChangedEventArgs args) {
        HeaderStateCssClass = "collapse";        
        InvokeAsync(StateHasChanged);
    }
   

    public void Dispose() {
        //NavigationManager.LocationChanged -= OnLocationChanged;
    }
}
